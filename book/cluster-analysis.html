<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Cluster Analysis | An R Companion for Introduction to Data Mining</title>
<meta name="author" content="Michael Hahsler">
<meta name="description" content="This chapter introduces cluster analysis using K-means, hierarchical clustering and DBSCAN. We will discuss how to choose the number of clusters and how to evaluate the quality clusterings. In...">
<meta name="generator" content="bookdown 0.44 with bs4_book()">
<meta property="og:title" content="Chapter 7 Cluster Analysis | An R Companion for Introduction to Data Mining">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="This chapter introduces cluster analysis using K-means, hierarchical clustering and DBSCAN. We will discuss how to choose the number of clusters and how to evaluate the quality clusterings. In...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Cluster Analysis | An R Companion for Introduction to Data Mining">
<meta name="twitter:description" content="This chapter introduces cluster analysis using K-means, hierarchical clustering and DBSCAN. We will discuss how to choose the number of clusters and how to evaluate the quality clusterings. In...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><link href="libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><link href="libs/nouislider/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider/jquery.nouislider.min.js"></script><link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize/selectize.min.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An R Companion for Introduction to Data Mining</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="" href="classification-basic-concepts.html"><span class="header-section-number">3</span> Classification: Basic Concepts</a></li>
<li><a class="" href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></li>
<li><a class="" href="association-analysis-basic-concepts.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts</a></li>
<li><a class="" href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></li>
<li><a class="active" href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="data-exploration-and-visualization.html"><span class="header-section-number">A</span> Data Exploration and Visualization</a></li>
<li><a class="" href="appendix_regression.html"><span class="header-section-number">B</span> Regression</a></li>
<li><a class="" href="appendix_logistic_regression.html"><span class="header-section-number">C</span> Logistic Regression</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cluster-analysis" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Cluster Analysis<a class="anchor" aria-label="anchor" href="#cluster-analysis"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter introduces cluster analysis using K-means, hierarchical clustering
and DBSCAN. We will discuss how to choose the number of clusters and how
to evaluate the quality clusterings. In addition, we will introduce more
clustering algorithms and how clustering is influenced by outliers.</p>
<p>The corresponding chapter of
the data mining textbook is available online:
<a href="https://mhahsler.github.io/Introduction_to_Data_Mining_R_Examples/DM_chapters/ch7_clustering.pdf">Chapter 7: Cluster Analysis: Basic Concepts and Algorithms.</a></p>
<div id="packages-used-in-this-chapter-5" class="section level3 unnumbered">
<h3>Packages Used in this Chapter<a class="anchor" aria-label="anchor" href="#packages-used-in-this-chapter-5"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cluster"</span>, <span class="st">"dbscan"</span>, <span class="st">"e1071"</span>, <span class="st">"factoextra"</span>, <span class="st">"fpc"</span>, </span>
<span>          <span class="st">"GGally"</span>, <span class="st">"kernlab"</span>, <span class="st">"mclust"</span>, <span class="st">"mlbench"</span>, <span class="st">"scatterpie"</span>, </span>
<span>          <span class="st">"seriation"</span>, <span class="st">"tidyverse"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">pkgs_install</span> <span class="op">&lt;-</span> <span class="va">pkgs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span></span></code></pre></div>
<p>The packages used for this chapter are:</p>
<ul>
<li>
<em>cluster</em> <span class="citation">(<a href="references.html#ref-R-cluster">Maechler et al. 2025</a>)</span>
</li>
<li>
<em>dbscan</em> <span class="citation">(<a href="references.html#ref-R-dbscan">Hahsler and Piekenbrock 2025</a>)</span>
</li>
<li>
<em>e1071</em> <span class="citation">(<a href="references.html#ref-R-e1071">Meyer et al. 2024</a>)</span>
</li>
<li>
<em>factoextra</em> <span class="citation">(<a href="references.html#ref-R-factoextra">Kassambara and Mundt 2020</a>)</span>
</li>
<li>
<em>fpc</em> <span class="citation">(<a href="references.html#ref-R-fpc">Hennig 2024</a>)</span>
</li>
<li>
<em>GGally</em> <span class="citation">(<a href="references.html#ref-R-GGally">Schloerke et al. 2025</a>)</span>
</li>
<li>
<em>kernlab</em> <span class="citation">(<a href="references.html#ref-R-kernlab">Karatzoglou, Smola, and Hornik 2024</a>)</span>
</li>
<li>
<em>mclust</em> <span class="citation">(<a href="references.html#ref-R-mclust">Fraley, Raftery, and Scrucca 2024</a>)</span>
</li>
<li>
<em>mlbench</em> <span class="citation">(<a href="references.html#ref-R-mlbench">Leisch and Dimitriadou 2024</a>)</span>
</li>
<li>
<em>scatterpie</em> <span class="citation">(<a href="references.html#ref-R-scatterpie">Yu 2025</a>)</span>
</li>
<li>
<em>seriation</em> <span class="citation">(<a href="references.html#ref-R-seriation">Hahsler, Buchta, and Hornik 2025</a>)</span>
</li>
<li>
<em>tidyverse</em> <span class="citation">(<a href="references.html#ref-R-tidyverse">Wickham 2023b</a>)</span>
</li>
</ul>
</div>
<div id="overview" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Cluster_analysis">Cluster analysis or clustering</a>
is the task of grouping a set of objects in such a way that objects in the same group (called a cluster) are more similar (in some sense) to each other than to those in other groups (clusters).</p>
<p>Clustering is also called unsupervised learning, because it tries to directly learns the structure of the data
and does not rely on the availability of a correct answer or class label as supervised learning does.
Clustering is often used for exploratory analysis or to preprocess data by grouping.</p>
<p>You can read the free sample chapter from the textbook <span class="citation">(<a href="references.html#ref-Tan2005">Tan, Steinbach, and Kumar 2005</a>)</span>:
<a href="https://mhahsler.github.io/Introduction_to_Data_Mining_R_Examples/DM_chapters/ch7_clustering.pdf">Chapter 7. Cluster Analysis: Basic Concepts and
Algorithms</a></p>
<div id="data-preparation" class="section level3" number="7.1.1">
<h3>
<span class="header-section-number">7.1.1</span> Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>We will use here a small and very clean toy dataset called Ruspini which is
included in the R package <strong>cluster</strong>.</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ruspini</span>, package <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code></pre></div>
<p>The Ruspini data set, consisting of 75 points in four groups that is
popular for illustrating clustering techniques. It is a very simple data
set with well separated clusters. The original dataset has the points
ordered by group. We can shuffle the data (rows) using <code>sample_frac</code>
which samples by default 100%.</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">ruspini</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ruspini</span></span>
<span><span class="co">## # A tibble: 75 × 2</span></span>
<span><span class="co">##        x     y</span></span>
<span><span class="co">##    &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">##  1    44   149</span></span>
<span><span class="co">##  2    13    49</span></span>
<span><span class="co">##  3     5    63</span></span>
<span><span class="co">##  4    36    72</span></span>
<span><span class="co">##  5    31    60</span></span>
<span><span class="co">##  6    66    23</span></span>
<span><span class="co">##  7    34   141</span></span>
<span><span class="co">##  8    97   122</span></span>
<span><span class="co">##  9    86   132</span></span>
<span><span class="co">## 10   101   115</span></span>
<span><span class="co">## # ℹ 65 more rows</span></span></code></pre></div>
</div>
<div id="data-cleaning" class="section level3" number="7.1.2">
<h3>
<span class="header-section-number">7.1.2</span> Data cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-286-1.png" width="672"></div>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ruspini</span><span class="op">)</span></span>
<span><span class="co">##        x               y        </span></span>
<span><span class="co">##  Min.   :  4.0   Min.   :  4.0  </span></span>
<span><span class="co">##  1st Qu.: 31.5   1st Qu.: 56.5  </span></span>
<span><span class="co">##  Median : 52.0   Median : 96.0  </span></span>
<span><span class="co">##  Mean   : 54.9   Mean   : 92.0  </span></span>
<span><span class="co">##  3rd Qu.: 76.5   3rd Qu.:141.5  </span></span>
<span><span class="co">##  Max.   :117.0   Max.   :156.0</span></span></code></pre></div>
<p>For most clustering algorithms it is necessary to handle missing values
and outliers (e.g., remove the observations). For details see Section
“Outlier removal” below. This data set has not missing values or strong
outlier and looks like it has some very clear groups.i</p>
</div>
<div id="scale-data" class="section level3" number="7.1.3">
<h3>
<span class="header-section-number">7.1.3</span> Scale data<a class="anchor" aria-label="anchor" href="#scale-data"><i class="fas fa-link"></i></a>
</h3>
<p>Clustering algorithms use distances and the variables with the largest
number range will dominate distance calculation. The summary above shows
that this is not an issue for the Ruspini dataset with both, x and y,
being roughly between 0 and 150. Most data analysts will still scale
each column in the data to zero mean and unit standard deviation
(<a href="https://en.wikipedia.org/wiki/Standard_score">z-scores</a>).</p>
<p><em>Note:</em> The standard <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> function scales a whole data
matrix so we implement a function for a single vector and apply it to
all numeric columns.</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## I use this till tidyverse implements a scale function</span></span>
<span><span class="va">scale_numeric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, </span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_scaled</span> <span class="op">&lt;-</span> <span class="va">ruspini</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scale_numeric</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span></span>
<span><span class="co">##        x                 y          </span></span>
<span><span class="co">##  Min.   :-1.6681   Min.   :-1.8074  </span></span>
<span><span class="co">##  1st Qu.:-0.7665   1st Qu.:-0.7295  </span></span>
<span><span class="co">##  Median :-0.0944   Median : 0.0816  </span></span>
<span><span class="co">##  Mean   : 0.0000   Mean   : 0.0000  </span></span>
<span><span class="co">##  3rd Qu.: 0.7088   3rd Qu.: 1.0158  </span></span>
<span><span class="co">##  Max.   : 2.0366   Max.   : 1.3136</span></span></code></pre></div>
<p>After scaling, most z-scores will fall in the range <span class="math inline">\([-3,3]\)</span> (z-scores
are measured in standard deviations from the mean), where <span class="math inline">\(0\)</span> means
average.</p>
</div>
</div>
<div id="k-means" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> K-means<a class="anchor" aria-label="anchor" href="#k-means"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means</a> implicitly
assumes Euclidean distances. We use <span class="math inline">\(k = 4\)</span> clusters and run the
algorithm 10 times with random initialized centroids. The best result is
returned.</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="fl">4</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">km</span></span>
<span><span class="co">## K-means clustering with 4 clusters of sizes 20, 23, 17, 15</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cluster means:</span></span>
<span><span class="co">##         x       y</span></span>
<span><span class="co">## 1 -1.1386 -0.5560</span></span>
<span><span class="co">## 2 -0.3595  1.1091</span></span>
<span><span class="co">## 3  1.4194  0.4693</span></span>
<span><span class="co">## 4  0.4607 -1.4912</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Clustering vector:</span></span>
<span><span class="co">##  [1] 2 1 1 1 1 4 2 3 3 3 3 4 2 3 2 2 1 1 3 3 1 4 1 4 2 4 3 3</span></span>
<span><span class="co">## [29] 4 4 3 2 2 1 1 2 1 2 2 1 3 2 4 4 2 3 2 2 4 2 1 3 1 3 1 2</span></span>
<span><span class="co">## [57] 3 3 1 1 4 4 2 1 4 2 2 1 2 2 1 4 3 4 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Within cluster sum of squares by cluster:</span></span>
<span><span class="co">## [1] 2.705 2.659 3.641 1.082</span></span>
<span><span class="co">##  (between_SS / total_SS =  93.2 %)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Available components:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [1] "cluster"      "centers"      "totss"       </span></span>
<span><span class="co">## [4] "withinss"     "tot.withinss" "betweenss"   </span></span>
<span><span class="co">## [7] "size"         "iter"         "ifault"</span></span></code></pre></div>
<p><code>km</code> is an R object implemented as a list.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">km</span><span class="op">)</span></span>
<span><span class="co">## List of 9</span></span>
<span><span class="co">##  $ cluster     : int [1:75] 2 1 1 1 1 4 2 3 3 3 ...</span></span>
<span><span class="co">##  $ centers     : num [1:4, 1:2] -1.139 -0.36 1.419 0.461 -0.556 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4] "1" "2" "3" "4"</span></span>
<span><span class="co">##   .. ..$ : chr [1:2] "x" "y"</span></span>
<span><span class="co">##  $ totss       : num 148</span></span>
<span><span class="co">##  $ withinss    : num [1:4] 2.71 2.66 3.64 1.08</span></span>
<span><span class="co">##  $ tot.withinss: num 10.1</span></span>
<span><span class="co">##  $ betweenss   : num 138</span></span>
<span><span class="co">##  $ size        : int [1:4] 20 23 17 15</span></span>
<span><span class="co">##  $ iter        : int 3</span></span>
<span><span class="co">##  $ ifault      : int 0</span></span>
<span><span class="co">##  - attr(*, "class")= chr "kmeans"</span></span></code></pre></div>
<p>The clustering vector is just a list element
containing the cluster assignment for each data row and can be accessed
using <code>km$cluster</code>. I add the cluster assignment as a column to the
original dataset (I make it a factor since it represents a nominal label).</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_clustered</span> <span class="op">&lt;-</span> <span class="va">ruspini</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ruspini_clustered</span></span>
<span><span class="co">## # A tibble: 75 × 3</span></span>
<span><span class="co">##        x     y cluster</span></span>
<span><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;fct&gt;  </span></span>
<span><span class="co">##  1    44   149 2      </span></span>
<span><span class="co">##  2    13    49 1      </span></span>
<span><span class="co">##  3     5    63 1      </span></span>
<span><span class="co">##  4    36    72 1      </span></span>
<span><span class="co">##  5    31    60 1      </span></span>
<span><span class="co">##  6    66    23 4      </span></span>
<span><span class="co">##  7    34   141 2      </span></span>
<span><span class="co">##  8    97   122 3      </span></span>
<span><span class="co">##  9    86   132 3      </span></span>
<span><span class="co">## 10   101   115 3      </span></span>
<span><span class="co">## # ℹ 65 more rows</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_clustered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-291-1.png" width="672"></div>
<p>Add the centroids to the plot. The centroids are scaled, so we need to unscale them
to plot them over the original data. The second <code>geom_points</code> uses
not the original data but specifies the centroids as its dataset.</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unscale</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">original_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Function needs matching columns!"</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">original_data</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, <span class="va">sd</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>             byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">original_data</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>           byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="va">km</span><span class="op">$</span><span class="va">centers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu">unscale</span><span class="op">(</span>original_data <span class="op">=</span> <span class="va">ruspini</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="va">centroids</span></span>
<span><span class="co">## # A tibble: 4 × 3</span></span>
<span><span class="co">##   cluster     x     y</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 1        20.2  65.0</span></span>
<span><span class="co">## 2 2        43.9 146. </span></span>
<span><span class="co">## 3 3        98.2 115. </span></span>
<span><span class="co">## 4 4        68.9  19.4</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_clustered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, </span>
<span>             shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-292-1.png" width="672"></div>
<p>The <code>factoextra</code> package provides also a good visualization with object labels
and ellipses for clusters.</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra">factoextra</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">km</span>, data <span class="op">=</span> <span class="va">ruspini_scaled</span>, centroids <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>             repel <span class="op">=</span> <span class="cn">TRUE</span>, ellipse.type <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-293-1.png" width="672"></div>
<div id="inspect-clusters" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Inspect Clusters<a class="anchor" aria-label="anchor" href="#inspect-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>We inspect the clusters created by the 4-cluster k-means solution. The
following code can be adapted to be used for other clustering methods.</p>
<p>Inspect the centroids with horizontal bar charts organized by cluster.
To group the plots by cluster, we have to change the data format to the
“long”-format using a pivot operation. I use colors to match the
clusters in the scatter plots.</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">centroids</span>, </span>
<span>                    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, </span>
<span>                    names_to <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span>,</span>
<span>  <span class="co">#aes(x = feature, y = value, fill = cluster)) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">feature</span>, fill <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-294-1.png" width="672"></div>
</div>
<div id="extract-a-single-cluster" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Extract a Single Cluster<a class="anchor" aria-label="anchor" href="#extract-a-single-cluster"><i class="fas fa-link"></i></a>
</h3>
<p>You need is to filter the rows corresponding to the cluster index. The
next example calculates summary statistics and then plots all data
points of cluster 1.</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster1</span> <span class="op">&lt;-</span> <span class="va">ruspini_clustered</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cluster1</span></span>
<span><span class="co">## # A tibble: 20 × 3</span></span>
<span><span class="co">##        x     y cluster</span></span>
<span><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;fct&gt;  </span></span>
<span><span class="co">##  1    13    49 1      </span></span>
<span><span class="co">##  2     5    63 1      </span></span>
<span><span class="co">##  3    36    72 1      </span></span>
<span><span class="co">##  4    31    60 1      </span></span>
<span><span class="co">##  5    27    72 1      </span></span>
<span><span class="co">##  6     9    77 1      </span></span>
<span><span class="co">##  7    28    76 1      </span></span>
<span><span class="co">##  8    24    58 1      </span></span>
<span><span class="co">##  9    27    55 1      </span></span>
<span><span class="co">## 10    18    61 1      </span></span>
<span><span class="co">## 11    15    75 1      </span></span>
<span><span class="co">## 12    13    69 1      </span></span>
<span><span class="co">## 13    12    88 1      </span></span>
<span><span class="co">## 14    10    59 1      </span></span>
<span><span class="co">## 15    19    65 1      </span></span>
<span><span class="co">## 16    32    61 1      </span></span>
<span><span class="co">## 17    22    74 1      </span></span>
<span><span class="co">## 18     4    53 1      </span></span>
<span><span class="co">## 19    28    60 1      </span></span>
<span><span class="co">## 20    30    52 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cluster1</span><span class="op">)</span></span>
<span><span class="co">##        x              y        cluster</span></span>
<span><span class="co">##  Min.   : 4.0   Min.   :49.0   1:20   </span></span>
<span><span class="co">##  1st Qu.:12.8   1st Qu.:58.8   2: 0   </span></span>
<span><span class="co">##  Median :20.5   Median :62.0   3: 0   </span></span>
<span><span class="co">##  Mean   :20.1   Mean   :65.0   4: 0   </span></span>
<span><span class="co">##  3rd Qu.:28.0   3rd Qu.:72.5          </span></span>
<span><span class="co">##  Max.   :36.0   Max.   :88.0</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">160</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-295-1.png" width="672"></div>
<p>What happens if we try to cluster with 8 centers?</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ruspini_scaled</span>,</span>
<span>  centroids <span class="op">=</span> <span class="cn">TRUE</span>,  geom <span class="op">=</span> <span class="st">"point"</span>, ellipse.type <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="co">## Too few points to calculate an ellipse</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-296-1.png" width="672"></div>
</div>
</div>
<div id="agglomerative-hierarchical-clustering" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Agglomerative Hierarchical Clustering<a class="anchor" aria-label="anchor" href="#agglomerative-hierarchical-clustering"><i class="fas fa-link"></i></a>
</h2>
<p>Hierarchical clustering starts with a distance matrix. <code><a href="https://rdrr.io/r/stats/dist.html">dist()</a></code> defaults
to <code>method = "euclidean"</code>.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Distance matrices become very large
quickly (the space complexity is <span class="math inline">\(O(n^2)\)</span> where <span class="math inline">\(n\)</span> is the number if
data points). It is only possible to calculate and store the matrix for
small to medium data sets (maybe a few hundred thousand data points) in main
memory. If your data is too large then you can use sampling to reduce the
number of points to cluster.</li>
<li>The data needs to be scaled since we compute distances.</li>
</ul>
<div id="creating-a-dendrogram" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Creating a Dendrogram<a class="anchor" aria-label="anchor" href="#creating-a-dendrogram"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/stats/hclust.html">hclust()</a></code> implements <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">agglomerative hierarchical
clustering</a>.
The linkage function defines how the distance between two clusters (sets of points)
is calculated. We specify the complete-link method where the distance between two groups
is measured by the distance between the two farthest apart points in the two groups.</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">d</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span></code></pre></div>
<p>Hierarchical clustering does not return cluster assignments but a
dendrogram object which shows how the objects on the x-axis are successively joined together
when going up along the y-axis. The y-axis represents the distance at which groups of points
are joined together. The standard plot function displays the dendrogram.</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hc</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-299-1.png" width="672"></div>
<p>The package <code>factoextra</code> provides a ggplot function to plot dendrograms.</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">hc</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-300-1.png" width="672"></div>
<p>More plotting options for dendrograms, including plotting parts of large
dendrograms can be found <a href="https://rpubs.com/gaston/dendrograms">here.</a></p>
</div>
<div id="extracting-a-partitional-clustering" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Extracting a Partitional Clustering<a class="anchor" aria-label="anchor" href="#extracting-a-partitional-clustering"><i class="fas fa-link"></i></a>
</h3>
<p>Partitional clusterings with cluster assignments can be extracted from a dendrogram
by cutting the dendrogram horizontally using <code><a href="https://rdrr.io/r/stats/cutree.html">cutree()</a></code>. Here we cut it into four parts
and add the cluster id to the data.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">cluster_complete</span> <span class="op">&lt;-</span> <span class="va">ruspini_scaled</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cluster_complete</span></span>
<span><span class="co">## # A tibble: 75 × 3</span></span>
<span><span class="co">##         x      y cluster</span></span>
<span><span class="co">##     &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span><span class="co">##  1 -0.357  1.17  1      </span></span>
<span><span class="co">##  2 -1.37  -0.883 2      </span></span>
<span><span class="co">##  3 -1.64  -0.596 2      </span></span>
<span><span class="co">##  4 -0.619 -0.411 2      </span></span>
<span><span class="co">##  5 -0.783 -0.658 2      </span></span>
<span><span class="co">##  6  0.365 -1.42  3      </span></span>
<span><span class="co">##  7 -0.685  1.01  1      </span></span>
<span><span class="co">##  8  1.38   0.615 4      </span></span>
<span><span class="co">##  9  1.02   0.821 4      </span></span>
<span><span class="co">## 10  1.51   0.472 4      </span></span>
<span><span class="co">## # ℹ 65 more rows</span></span></code></pre></div>
<p>The 4 different clusters can be shown in the dendrogram using different colors.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-302-1.png" width="672"></div>
<p>We can also color in the scatterplot.</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cluster_complete</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-303-1.png" width="672"></div>
<p>The package <code>factoextra</code> provides an alternative visualization. Since it needs
a partition object as the first argument, we create one as a simple list.</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ruspini_scaled</span>, </span>
<span>                  cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-304-1.png" width="672"></div>
<p>Here are the results if we use the single-link method to join clusters.
Single-link measures the distance between two groups by the
by the distance between the two closest points from the two groups.</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">d</span>, method <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">hc_single</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-305-1.png" width="672"></div>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ruspini_scaled</span>, </span>
<span>                  cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc_single</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-305-2.png" width="672"></div>
<p>The most important difference between complete-link and single-link is that
complete-link prefers globular clusters and single-link shows chaining
(see the staircase pattern in the dendrogram).</p>
</div>
</div>
<div id="dbscan" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> DBSCAN<a class="anchor" aria-label="anchor" href="#dbscan"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/DBSCAN">DBSCAN</a> stands for “Density-Based
Spatial Clustering of Applications with Noise.” It groups together
points that are closely packed together and treats points in low-density
regions as outliers. DBSCAN is implemented in package <code>dbscan</code>.</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/dbscan">dbscan</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dbscan'</span></span>
<span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     as.dendrogram</span></span></code></pre></div>
<div id="dbscan-parameters" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> DBSCAN Parameters<a class="anchor" aria-label="anchor" href="#dbscan-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>DBSCAN has two parameters
that interact with each other. Changing one typically
means that the other one also has to be adjusted.</p>
<p><code>minPts</code> defines how many points are needed in the epsilon
neighborhood to make a point a core point for a cluster. It is often chosen
as a smoothing parameter, where larger values smooth the density estimation more
but also ignore smaller structures with less then minPts.</p>
<p><code>eps</code> is the radius of the epsilon neighborhood around a point in which the
number of points is counted.</p>
<p>Users typically first select minPts. We use here <code>minPts = 4</code>.
To decide on epsilon, the knee in the kNN distance plot is often used.
All points are sorted by their kNN distance. The idea is that points with
a low kNN distance are located in a dense area which should become a cluster.
Points with a large kNN distance are in a low density area and most
likely represent outliers and noise.</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/kNNdist.html">kNNdistplot</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, minPts <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">.32</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-307-1.png" width="672"></div>
<p>Note that minPts contains the point itself, while the k-nearest neighbor
distance calculation does not.
The plot uses therefor <code>k = minPts - 1</code>.</p>
<p>The knee is visible around <code>eps = .32</code> (shown by the manually added red line).
The points to the left of the intersection of the
k-nearest neighbor distance line and the red line are the points that will be
core points during clustering at the specified parameters.</p>
</div>
<div id="cluster-using-dbscan" class="section level3" number="7.4.2">
<h3>
<span class="header-section-number">7.4.2</span> Cluster using DBSCAN<a class="anchor" aria-label="anchor" href="#cluster-using-dbscan"><i class="fas fa-link"></i></a>
</h3>
<p>Clustering with <code><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html">dbscan()</a></code> returns a dbscan object.</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html">dbscan</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, eps <span class="op">=</span> <span class="fl">.32</span>, minPts <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">db</span></span>
<span><span class="co">## DBSCAN clustering for 75 objects.</span></span>
<span><span class="co">## Parameters: eps = 0.32, minPts = 4</span></span>
<span><span class="co">## Using euclidean distances and borderpoints = TRUE</span></span>
<span><span class="co">## The clustering contains 4 cluster(s) and 5 noise points.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  0  1  2  3  4 </span></span>
<span><span class="co">##  5 23 20 15 12 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Available fields: cluster, eps, minPts, metric,</span></span>
<span><span class="co">##                   borderPoints</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span><span class="co">## List of 5</span></span>
<span><span class="co">##  $ cluster     : int [1:75] 1 2 2 2 2 3 1 4 0 4 ...</span></span>
<span><span class="co">##  $ eps         : num 0.32</span></span>
<span><span class="co">##  $ minPts      : num 4</span></span>
<span><span class="co">##  $ metric      : chr "euclidean"</span></span>
<span><span class="co">##  $ borderPoints: logi TRUE</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:2] "dbscan_fast" "dbscan"</span></span></code></pre></div>
<p>The <code>cluster</code> element is the cluster assignment with cluster labels. The
special cluster label <code>0</code> means that the point is noise and not assigned to a
cluster.</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-309-1.png" width="672"></div>
<p>DBSCAN found 5 noise points. <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster()</a></code> can be
used to create a ggplot visualization.</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">db</span>, <span class="va">ruspini_scaled</span>, geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-310-1.png" width="672"></div>
<p>Different values for <code>minPts</code> and <code>eps</code> can lead to vastly different clusterings.
Often, a misspecification leads to all points being noise points or a single cluster.
Also, if the clusters are not well separated, then DBSCAN has a hard
time splitting them.</p>
</div>
</div>
<div id="cluster-evaluation" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Cluster Evaluation<a class="anchor" aria-label="anchor" href="#cluster-evaluation"><i class="fas fa-link"></i></a>
</h2>
<div id="unsupervised-cluster-evaluation" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Unsupervised Cluster Evaluation<a class="anchor" aria-label="anchor" href="#unsupervised-cluster-evaluation"><i class="fas fa-link"></i></a>
</h3>
<p>This is also often called internal cluster evaluation since it does not use
extra external labels.</p>
<p>We will evaluate the k-means clustering from above.</p>
<div id="visual-methods" class="section level4" number="7.5.1.1">
<h4>
<span class="header-section-number">7.5.1.1</span> Visual Methods<a class="anchor" aria-label="anchor" href="#visual-methods"><i class="fas fa-link"></i></a>
</h4>
<p>For data in 2 dimensions, a scatter plot will show if the clusters look right.</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-311-1.png" width="672">
For data with more dimensions or with columns containing nominal/ordinal data,
we cannot look at the scatter plot. However, we can visualize a reordered similarity/dissimilarity
matrix.</div>
<p>First, we calculate a distance matrix and
inspect the distance matrix between the first 5 objects.</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">as.matrix</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">##       1      2      3      4      5</span></span>
<span><span class="co">## 1 0.000 2.2910 2.1801 1.6026 1.8765</span></span>
<span><span class="co">## 2 2.291 0.0000 0.3891 0.8897 0.6319</span></span>
<span><span class="co">## 3 2.180 0.3891 0.0000 1.0330 0.8546</span></span>
<span><span class="co">## 4 1.603 0.8897 1.0330 0.0000 0.2959</span></span>
<span><span class="co">## 5 1.876 0.6319 0.8546 0.2959 0.0000</span></span></code></pre></div>
<p>Matrix visualizations with reordering are provided in package <code>seriation</code>.
Matrix visualization creates
a false-color image where each value in the matrix as a pixel with the color representing the value.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/seriation">seriation</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'seriation'</span></span>
<span><span class="co">## The following object is masked from 'package:lattice':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     panel.lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/pimage.html">pimage</a></span><span class="op">(</span><span class="va">d</span>, main <span class="op">=</span> <span class="st">"Unordered"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-313-1.png" width="672"></div>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/pimage.html">pimage</a></span><span class="op">(</span><span class="va">d</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Reordered by cluster"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-313-2.png" width="672">
Remember, the rows and columns in the matrix represent the objects (rows of the original
data).
The reordered distance matrix has the objects ordered by cluster (all points in cluster 1 followed
by all points in cluster 2, and so on).
The matrix visualization shows a clear block structure indicating that the points within
each cluster are close together (low distance), while the other clusters are farther away.</div>
<p>An advanced version of this plot is called a dissimilarity plot. It reorders rows and
columns based on cluster labels and adds lines for cluster borders. It also
presents average distance values above the diagonal to make the structure between clusters
easier to evaluate.</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/dissplot.html">dissplot</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-314-1.png" width="672"></div>
</div>
<div id="evaluation-metrics" class="section level4" number="7.5.1.2">
<h4>
<span class="header-section-number">7.5.1.2</span> Evaluation Metrics<a class="anchor" aria-label="anchor" href="#evaluation-metrics"><i class="fas fa-link"></i></a>
</h4>
<p>The two most popular quality metrics are the within-cluster sum of
squares (WCSS) used as the optimization objective by
<a href="https://en.wikipedia.org/wiki/K-means_clustering"><span class="math inline">\(k\)</span>-means</a> and the
<a href="https://en.wikipedia.org/wiki/Silhouette_(clustering)">average silhouette
width</a>. Look at
<code>within.cluster.ss</code> and <code>avg.silwidth</code> below.</p>
<p>A comprehensive set of evaluation metric is calculated by <code>cluster.stats()</code> in
package <code>fpc</code>.</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(fpc)</span></span>
<span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## $n</span></span>
<span><span class="co">## [1] 75</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cluster.number</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cluster.size</span></span>
<span><span class="co">## [1] 20 23 17 15</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $min.cluster.size</span></span>
<span><span class="co">## [1] 15</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $noisen</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $diameter</span></span>
<span><span class="co">## [1] 1.1193 1.1591 1.4627 0.8359</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $average.distance</span></span>
<span><span class="co">## [1] 0.4824 0.4286 0.5806 0.3564</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $median.distance</span></span>
<span><span class="co">## [1] 0.4492 0.3934 0.5024 0.3380</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $separation</span></span>
<span><span class="co">## [1] 1.1577 0.7676 0.7676 1.1577</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $average.toother</span></span>
<span><span class="co">## [1] 2.157 2.149 2.293 2.308</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $separation.matrix</span></span>
<span><span class="co">##       [,1]   [,2]   [,3]  [,4]</span></span>
<span><span class="co">## [1,] 0.000 1.2199 1.3397 1.158</span></span>
<span><span class="co">## [2,] 1.220 0.0000 0.7676 1.958</span></span>
<span><span class="co">## [3,] 1.340 0.7676 0.0000 1.308</span></span>
<span><span class="co">## [4,] 1.158 1.9577 1.3084 0.000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ave.between.matrix</span></span>
<span><span class="co">##       [,1]  [,2]  [,3]  [,4]</span></span>
<span><span class="co">## [1,] 0.000 1.887 2.772 1.874</span></span>
<span><span class="co">## [2,] 1.887 0.000 1.925 2.750</span></span>
<span><span class="co">## [3,] 2.772 1.925 0.000 2.220</span></span>
<span><span class="co">## [4,] 1.874 2.750 2.220 0.000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $average.between</span></span>
<span><span class="co">## [1] 2.219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $average.within</span></span>
<span><span class="co">## [1] 0.463</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $n.between</span></span>
<span><span class="co">## [1] 2091</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $n.within</span></span>
<span><span class="co">## [1] 684</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $max.diameter</span></span>
<span><span class="co">## [1] 1.463</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $min.separation</span></span>
<span><span class="co">## [1] 0.7676</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $within.cluster.ss</span></span>
<span><span class="co">## [1] 10.09</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $clus.avg.silwidths</span></span>
<span><span class="co">##      1      2      3      4 </span></span>
<span><span class="co">## 0.7211 0.7455 0.6813 0.8074 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg.silwidth</span></span>
<span><span class="co">## [1] 0.7368</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $g2</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $g3</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $pearsongamma</span></span>
<span><span class="co">## [1] 0.8416</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $dunn</span></span>
<span><span class="co">## [1] 0.5248</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $dunn2</span></span>
<span><span class="co">## [1] 3.228</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $entropy</span></span>
<span><span class="co">## [1] 1.373</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $wb.ratio</span></span>
<span><span class="co">## [1] 0.2086</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ch</span></span>
<span><span class="co">## [1] 323.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cwidegap</span></span>
<span><span class="co">## [1] 0.2612 0.3153 0.4150 0.2352</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $widestgap</span></span>
<span><span class="co">## [1] 0.415</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sindex</span></span>
<span><span class="co">## [1] 0.8583</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $corrected.rand</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vi</span></span>
<span><span class="co">## NULL</span></span></code></pre></div>
<p>Some notes about the code:</p>
<ul>
<li>I do not load the package <code>fpc</code> using <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> since it would mask the <code><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html">dbscan()</a></code> function in package <code>dbscan</code>. Instead I use the namespace operator <code>::</code>.</li>
<li>The clustering (second argument below) has to be supplied as a vector
of integers (cluster IDs) and cannot be a factor (to make sure, we can use <code><a href="https://rdrr.io/r/base/integer.html">as.integer()</a></code>).</li>
</ul>
<p>Most metrics are easy to identify by their name. Some important metrics are:</p>
<ul>
<li>
<code>cluster.size</code>: vector of cluster sizes</li>
<li>
<code>within.cluster.ss</code>: within clusters sum of squares (k-means objective function).</li>
<li>
<code>avg.silwidth</code>: average silhouette width</li>
<li>
<code>pearsongamma</code>: correlation between the distances and a 0-1-vector cluster incidence matrix.</li>
</ul>
<p>Some numbers are <code>NULL</code>. These are measures only available for supervised evaluation.
Read the man page for <code>cluster.stats()</code> for an explanation of all the available indices.</p>
<p>We can compare different clusterings.</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    km_4 <span class="op">=</span> <span class="va">km</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>    hc_compl_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    hc_compl_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    hc_single_5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc_single</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"within.cluster.ss"</span>, </span>
<span>                                <span class="st">"avg.silwidth"</span>, </span>
<span>                                <span class="st">"pearsongamma"</span>, </span>
<span>                                <span class="st">"dunn"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">##                   km_4   hc_compl_4 hc_compl_5 hc_single_5</span></span>
<span><span class="co">## within.cluster.ss 10.09  10.09      8.314      7.791      </span></span>
<span><span class="co">## avg.silwidth      0.7368 0.7368     0.6642     0.6886     </span></span>
<span><span class="co">## pearsongamma      0.8416 0.8416     0.8042     0.816      </span></span>
<span><span class="co">## dunn              0.5248 0.5248     0.1988     0.358</span></span></code></pre></div>
<p>With 4 clusters, k-means and hierarchical clustering produce
exactly the same clustering. While the two different hierarchical methods with
5 clusters produce a smaller WCSS, they are actually worse given all three other
measures.</p>
<p>Next, we look at the silhouette using a
silhouette plot.</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'cluster'</span></span>
<span><span class="co">## The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     ruspini</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-317-1.png" width="672"></div>
<p><strong>Note:</strong> The silhouette plot does not show correctly in R Studio if you
have too many objects (bars are missing). I will work when you open a
new plotting device with <code>windows()</code>, <code><a href="https://rdrr.io/r/grDevices/x11.html">x11()</a></code> or <code><a href="https://rdrr.io/r/grDevices/quartz.html">quartz()</a></code>.</p>
<p>ggplot visualization using <code>factoextra</code></p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_silhouette.html">fviz_silhouette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   cluster size ave.sil.width</span></span>
<span><span class="co">## 1       1   20          0.72</span></span>
<span><span class="co">## 2       2   23          0.75</span></span>
<span><span class="co">## 3       3   17          0.68</span></span>
<span><span class="co">## 4       4   15          0.81</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-318-1.png" width="672"></div>
</div>
</div>
<div id="determining-the-correct-number-of-clusters" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> Determining the Correct Number of Clusters<a class="anchor" aria-label="anchor" href="#determining-the-correct-number-of-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>The user needs to specify the number of clusters for most clustering algorithms.
<a href="https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set">Determining the number of clusters in a data set</a>
is therefor an important task before we can cluster data. We will apply different methods
to the scaled Ruspini data set.</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-319-1.png" width="672"></div>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We will use different methods and try 1-10 clusters.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">ks</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span></span></code></pre></div>
<div id="elbow-method-within-cluster-sum-of-squares" class="section level4" number="7.5.2.1">
<h4>
<span class="header-section-number">7.5.2.1</span> Elbow Method: Within-Cluster Sum of Squares<a class="anchor" aria-label="anchor" href="#elbow-method-within-cluster-sum-of-squares"><i class="fas fa-link"></i></a>
</h4>
<p>A method often used for k-means is to calculate the within-cluster sum of squares for different numbers of
clusters and look for the <a href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)">knee or
elbow</a> in the
plot. We use <code>nstart = 5</code> to restart k-means 5 times and return the best
solution.</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WCSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="va">k</span>, nstart <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">tot.withinss</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">WCSS</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">WCSS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-320-1.png" width="672"></div>
</div>
<div id="average-silhouette-width" class="section level4" number="7.5.2.2">
<h4>
<span class="header-section-number">7.5.2.2</span> Average Silhouette Width<a class="anchor" aria-label="anchor" href="#average-silhouette-width"><i class="fas fa-link"></i></a>
</h4>
<p>Another popular method (often preferred for clustering methods starting with a distance matrix)
is to plot the average silhouette width for different numbers of clusters and
look for the maximum in the plot.</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ASW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ks</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, </span>
<span>                            centers <span class="op">=</span> <span class="va">k</span>, </span>
<span>                            nstart <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">$</span><span class="va">avg.silwidth</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_k</span> <span class="op">&lt;-</span> <span class="va">ks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">ASW</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">best_k</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">ASW</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">ASW</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">best_k</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-321-1.png" width="672"></div>
</div>
<div id="similarity-matrix-visualization" class="section level4" number="7.5.2.3">
<h4>
<span class="header-section-number">7.5.2.3</span> Similarity Matrix Visualization<a class="anchor" aria-label="anchor" href="#similarity-matrix-visualization"><i class="fas fa-link"></i></a>
</h4>
<p>We can visualize a similarity matrix reordered by cluster labels to visually determine if the number of clusters is
a good fit for the data.
Package <code>seriation</code> provides a dissimilarity plot to make this easy.</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/dissplot.html">ggdissplot</a></span><span class="op">(</span><span class="va">d</span>, labels <span class="op">=</span> <span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, </span>
<span>         options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"k-means with k=4"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-322-1.png" width="672"></div>
<p>The plot reorders rows and
columns based on cluster labels and adds lines for cluster borders. It also
presents average distance values above the diagonal to make the structure between clusters
easier to evaluate. Above, we see a clear structure with
the four clusters.</p>
<p>Next, we look at two examples wherethe number of clusters
was misspecified.</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/dissplot.html">ggdissplot</a></span><span class="op">(</span><span class="va">d</span>, </span>
<span>         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="fl">3</span>, nstart <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-323-1.png" width="672"></div>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/dissplot.html">ggdissplot</a></span><span class="op">(</span><span class="va">d</span>, </span>
<span>         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="fl">9</span>, nstart <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-323-2.png" width="672">
In the example with 3 clusters, we see that the plot
shows two separated triangles for the largest cluster
indicating that it contains two separate structures which should be their own clusters. For the example with
9 clusters, the plot tries to rearrange the clusters into
four larger blocks indicating that the number of clusters
shoulsd be 4.</div>
</div>
<div id="dunn-index" class="section level4" number="7.5.2.4">
<h4>
<span class="header-section-number">7.5.2.4</span> Dunn Index<a class="anchor" aria-label="anchor" href="#dunn-index"><i class="fas fa-link"></i></a>
</h4>
<p>The <a href="https://en.wikipedia.org/wiki/Dunn_index">Dunn index</a> is another
internal measure given by the smallest separation between clusters scaled by
the largest cluster diameter.</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, centers <span class="op">=</span> <span class="va">k</span>, </span>
<span>                            nstart <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">$</span><span class="va">dunn</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_k</span> <span class="op">&lt;-</span> <span class="va">ks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">DI</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">DI</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">DI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">best_k</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-324-1.png" width="672"></div>
</div>
<div id="gap-statistic" class="section level4" number="7.5.2.5">
<h4>
<span class="header-section-number">7.5.2.5</span> Gap Statistic<a class="anchor" aria-label="anchor" href="#gap-statistic"><i class="fas fa-link"></i></a>
</h4>
<p>The <a href="https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set#The_gap_statistics">Gap statistic</a>Compares the change in within-cluster dispersion with that expected from
a null model (see <code><a href="https://rdrr.io/pkg/cluster/man/clusGap.html">clusGap()</a></code>). The default method is to choose the
smallest k such that its value Gap(k) is not more than 1 standard error
away from the first local maximum.</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/clusGap.html">clusGap</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, </span>
<span>             FUN <span class="op">=</span> <span class="va">kmeans</span>,  </span>
<span>             nstart <span class="op">=</span> <span class="fl">10</span>, </span>
<span>             K.max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">k</span></span>
<span><span class="co">## Clustering Gap statistic ["clusGap"] from call:</span></span>
<span><span class="co">## clusGap(x = ruspini_scaled, FUNcluster = kmeans, K.max = 10, nstart = 10)</span></span>
<span><span class="co">## B=100 simulated reference sets, k = 1..10; spaceH0="scaledPCA"</span></span>
<span><span class="co">##  --&gt; Number of clusters (method 'firstSEmax', SE.factor=1): 4</span></span>
<span><span class="co">##        logW E.logW      gap  SE.sim</span></span>
<span><span class="co">##  [1,] 3.498  3.464 -0.03387 0.03824</span></span>
<span><span class="co">##  [2,] 3.074  3.151  0.07724 0.03605</span></span>
<span><span class="co">##  [3,] 2.678  2.903  0.22549 0.03861</span></span>
<span><span class="co">##  [4,] 2.106  2.712  0.60533 0.03793</span></span>
<span><span class="co">##  [5,] 1.987  2.574  0.58708 0.03599</span></span>
<span><span class="co">##  [6,] 1.864  2.456  0.59181 0.03442</span></span>
<span><span class="co">##  [7,] 1.732  2.352  0.61966 0.03577</span></span>
<span><span class="co">##  [8,] 1.660  2.257  0.59679 0.03758</span></span>
<span><span class="co">##  [9,] 1.612  2.168  0.55592 0.04024</span></span>
<span><span class="co">## [10,] 1.563  2.090  0.52667 0.04291</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-325-1.png" width="672"></div>
<p>There have been many other methods and indices proposed to determine the
number of clusters. See, e.g., package
<a href="https://cran.r-project.org/package=NbClust">NbClust</a>.</p>
</div>
</div>
<div id="clustering-tendency" class="section level3" number="7.5.3">
<h3>
<span class="header-section-number">7.5.3</span> Clustering Tendency<a class="anchor" aria-label="anchor" href="#clustering-tendency"><i class="fas fa-link"></i></a>
</h3>
<p>Most clustering algorithms will always produce a clustering, even if the
data does not contain a cluster structure. It is typically good to check
cluster tendency before attempting to cluster the data.</p>
<p>We use again the smiley data.</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mlbench</span><span class="op">)</span></span>
<span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.smiley.html">mlbench.smiley</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, sd1 <span class="op">=</span> <span class="fl">0.1</span>, sd2 <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span></span></code></pre></div>
<div id="scatter-plots" class="section level4" number="7.5.3.1">
<h4>
<span class="header-section-number">7.5.3.1</span> Scatter plots<a class="anchor" aria-label="anchor" href="#scatter-plots"><i class="fas fa-link"></i></a>
</h4>
<p>The first step is visual inspection using scatter plots.</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">shapes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-327-1.png" width="672"></div>
<p>Cluster tendency is typically indicated by several separated point
clouds. Often an appropriate number of clusters can also be visually
obtained by counting the number of point clouds. We see four clusters,
but the mouth is not convex/spherical and thus will pose a problems to
algorithms like k-means.</p>
<p>If the data has more than two features then you can use a pairs plot
(scatterplot matrix) or look at a scatterplot of the first two principal
components using PCA.</p>
</div>
<div id="visual-analysis-for-cluster-tendency-assessment-vat" class="section level4" number="7.5.3.2">
<h4>
<span class="header-section-number">7.5.3.2</span> Visual Analysis for Cluster Tendency Assessment (VAT)<a class="anchor" aria-label="anchor" href="#visual-analysis-for-cluster-tendency-assessment-vat"><i class="fas fa-link"></i></a>
</h4>
<p>VAT reorders the objects to show potential clustering tendency as a
block structure (dark blocks along the main diagonal). We scale the data
before using Euclidean distance.</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/seriation">seriation</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/VAT.html">ggVAT</a></span><span class="op">(</span><span class="va">d_shapes</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-328-1.png" width="672"></div>
<p>iVAT uses the largest distances for all possible paths between two
objects instead of the direct distances to make the block structure
better visible.</p>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/VAT.html">ggiVAT</a></span><span class="op">(</span><span class="va">d_shapes</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-329-1.png" width="672"></div>
</div>
<div id="hopkins-statistic" class="section level4" number="7.5.3.3">
<h4>
<span class="header-section-number">7.5.3.3</span> Hopkins statistic<a class="anchor" aria-label="anchor" href="#hopkins-statistic"><i class="fas fa-link"></i></a>
</h4>
<p><code>factoextra</code> can also create a VAT plot and calculate the <a href="https://en.wikipedia.org/wiki/Hopkins_statistic">Hopkins
statistic</a> to assess
clustering tendency. For the Hopkins statistic, a sample of size <span class="math inline">\(n\)</span> is
drawn from the data and then compares the nearest neighbor distribution
with a simulated dataset drawn from a random uniform distribution (see
<a href="https://www.datanovia.com/en/lessons/assessing-clustering-tendency/#statistical-methods">detailed
explanation</a>).
A values &gt;.5 indicates usually a clustering tendency.</p>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/get_clust_tendency.html">get_clust_tendency</a></span><span class="op">(</span><span class="va">shapes</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">## $hopkins_stat</span></span>
<span><span class="co">## [1] 0.9498</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $plot</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-330-1.png" width="672"></div>
<p>Both plots show a strong cluster structure with 4 clusters.</p>
</div>
<div id="data-without-clustering-tendency" class="section level4" number="7.5.3.4">
<h4>
<span class="header-section-number">7.5.3.4</span> Data Without Clustering Tendency<a class="anchor" aria-label="anchor" href="#data-without-clustering-tendency"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data_random</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-331-1.png" width="672"></div>
<p>No point clouds are visible, just noise.</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">data_random</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/VAT.html">ggVAT</a></span><span class="op">(</span><span class="va">d_random</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-332-1.png" width="672"></div>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/seriation/man/VAT.html">ggiVAT</a></span><span class="op">(</span><span class="va">d_random</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-332-2.png" width="672"></div>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/get_clust_tendency.html">get_clust_tendency</a></span><span class="op">(</span><span class="va">data_random</span>, n <span class="op">=</span> <span class="fl">10</span>, graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## $hopkins_stat</span></span>
<span><span class="co">## [1] 0.4642</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $plot</span></span>
<span><span class="co">## NULL</span></span></code></pre></div>
<p>There is very little clustering structure visible indicating low
clustering tendency and clustering should not be performed on this data.
However, k-means can be used to partition the data into <span class="math inline">\(k\)</span> regions of
roughly equivalent size. This can be used as a data-driven
discretization of the space.</p>
</div>
<div id="k-means-on-data-without-clustering-tendency" class="section level4" number="7.5.3.5">
<h4>
<span class="header-section-number">7.5.3.5</span> k-means on Data Without Clustering Tendency<a class="anchor" aria-label="anchor" href="#k-means-on-data-without-clustering-tendency"><i class="fas fa-link"></i></a>
</h4>
<p>What happens if we perform k-means on data that has no inherent
clustering structure?</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">data_random</span>, centers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">random_clustered</span><span class="op">&lt;-</span> <span class="va">data_random</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">random_clustered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-333-1.png" width="672"></div>
<p>k-means discretizes the space into similarly sized regions.</p>
</div>
</div>
<div id="supervised-cluster-evaluation" class="section level3" number="7.5.4">
<h3>
<span class="header-section-number">7.5.4</span> Supervised Cluster Evaluation<a class="anchor" aria-label="anchor" href="#supervised-cluster-evaluation"><i class="fas fa-link"></i></a>
</h3>
<p>Also called external cluster validation since it uses ground truth information.
That is, the
user has an idea how the data should be grouped. This could be a known
class label not provided to the clustering algorithm.</p>
<p>We use an artificial data set with known groups.</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mlbench</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.smiley.html">mlbench.smiley</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, sd1 <span class="op">=</span> <span class="fl">0.1</span>, sd2 <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-334-1.png" width="672"></div>
<p>First, we prepare the data and hide the known class label which we will used
for evaluation after clustering.</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="va">shapes</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="va">shapes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">shapes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-335-1.png" width="672"></div>
<p>Find optimal number of Clusters for k-means</p>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ks</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">20</span></span></code></pre></div>
<p>Use within sum of squares (look for the knee)</p>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WCSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">shapes</span>, centers <span class="op">=</span> <span class="va">k</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">tot.withinss</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">WCSS</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">WCSS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-337-1.png" width="672"></div>
<p>Looks like it could be 7 clusters?</p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">shapes</span>, centers <span class="op">=</span> <span class="fl">7</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">shapes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-338-1.png" width="672"></div>
<p>The mouth is an issue for k-means. We could use hierarchical clustering with single-linkage because of the mouth is
non-convex and chaining may help.</p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span></span>
<span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">d</span>, method <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span></span></code></pre></div>
<p>Find optimal number of clusters</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ASW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ks</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">avg.silwidth</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">ASW</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">ks</span>, <span class="va">ASW</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-340-1.png" width="672"></div>
<p>The maximum is clearly at 4 clusters.</p>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hc_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hc</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">shapes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">hc_4</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-341-1.png" width="672"></div>
<p>Compare with ground truth with the <a href="https://en.wikipedia.org/wiki/Rand_index#Adjusted_Rand_index">adjusted Rand index
(ARI, also
corrected Rand index)</a>,
the <a href="https://en.wikipedia.org/wiki/Variation_of_information">variation of information (VI)
index</a>,
<a href="https://en.wikipedia.org/wiki/Mutual_information">mutual information (MI)</a>,
<a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)">entropy</a>
and
<a href="https://en.wikipedia.org/wiki/Cluster_analysis#External_evaluation">purity</a>.</p>
<p><code>cluster_stats()</code> computes ARI and VI as comparative measures. I define
functions for the purity and the entropy of a clustering given the ground truth here:</p>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">purity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cluster</span>, <span class="va">truth</span>, <span class="va">show_table</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Cluster vector and ground truth vectors are not of the same length!"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># tabulate</span></span>
<span>  <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">show_table</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># find majority class</span></span>
<span>  <span class="va">majority</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">majority</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">entropy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cluster</span>, <span class="va">truth</span>, <span class="va">show_table</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Cluster vector and ground truth vectors are not of the same length!"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># calculate membership probability of cluster to class</span></span>
<span>  <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colSums</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span>, <span class="st">"/"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">show_table</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># calculate cluster entropy</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">p</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">rowSums</a></span><span class="op">(</span><span class="va">e</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># weighted sum over clusters</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">w</span> <span class="op">*</span> <span class="va">e</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We calculate the measures and add for comparison two random “clusterings” with
4 and 6 clusters.</p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/arules/man/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">random_6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/arules/man/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  truth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">truth</span>, </span>
<span>                              <span class="va">truth</span>, compareonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    purity <span class="op">=</span> <span class="fu">purity</span><span class="op">(</span><span class="va">truth</span>, <span class="va">truth</span><span class="op">)</span>,</span>
<span>    entropy <span class="op">=</span> <span class="fu">entropy</span><span class="op">(</span><span class="va">truth</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  </span>
<span>  kmeans_7 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, </span>
<span>                              <span class="va">truth</span>, compareonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    purity <span class="op">=</span> <span class="fu">purity</span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">truth</span><span class="op">)</span>,</span>
<span>    entropy <span class="op">=</span> <span class="fu">entropy</span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  hc_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">hc_4</span>, </span>
<span>                              <span class="va">truth</span>, compareonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    purity <span class="op">=</span> <span class="fu">purity</span><span class="op">(</span><span class="va">hc_4</span>, <span class="va">truth</span><span class="op">)</span>,</span>
<span>    entropy <span class="op">=</span> <span class="fu">entropy</span><span class="op">(</span><span class="va">hc_4</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  random_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">random_4</span>, </span>
<span>                              <span class="va">truth</span>, compareonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    purity <span class="op">=</span> <span class="fu">purity</span><span class="op">(</span><span class="va">random_4</span>, <span class="va">truth</span><span class="op">)</span>,</span>
<span>    entropy <span class="op">=</span> <span class="fu">entropy</span><span class="op">(</span><span class="va">random_4</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  random_6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">fpc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">cluster.stats</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">random_6</span>, </span>
<span>                              <span class="va">truth</span>, compareonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    purity <span class="op">=</span> <span class="fu">purity</span><span class="op">(</span><span class="va">random_6</span>, <span class="va">truth</span><span class="op">)</span>,</span>
<span>    entropy <span class="op">=</span> <span class="fu">entropy</span><span class="op">(</span><span class="va">random_6</span>, <span class="va">truth</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">r</span></span>
<span><span class="co">##          corrected.rand     vi purity entropy</span></span>
<span><span class="co">## truth          1.000000 0.0000  1.000  0.0000</span></span>
<span><span class="co">## kmeans_7       0.638229 0.5709  1.000  0.2088</span></span>
<span><span class="co">## hc_4           1.000000 0.0000  1.000  0.0000</span></span>
<span><span class="co">## random_4      -0.003235 2.6832  0.418  1.9895</span></span>
<span><span class="co">## random_6      -0.002125 3.0763  0.418  1.7129</span></span></code></pre></div>
<p>Notes:</p>
<ul>
<li>Comparing the ground truth to itself produces perfect scores.</li>
<li>Hierarchical clustering found the perfect clustering.</li>
<li>Entropy and purity are heavily impacted by the number of clusters
(more clusters improve the metric) and the fact that the mouth has 41.8%
of all the data points becoming automatically the majority class for purity.</li>
<li>The adjusted rand index shows clearly that the random clusterings
have no relationship with the ground truth (very close to 0). This
is a very helpful property and explains why the ARI is the most popular
measure.</li>
</ul>
<p>Read the manual page for <code><a href="https://rdrr.io/pkg/fpc/man/cluster.stats.html">fpc::cluster.stats()</a></code> for an explanation of all the available indices.</p>
</div>
</div>
<div id="more-clustering-algorithms" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> More Clustering Algorithms*<a class="anchor" aria-label="anchor" href="#more-clustering-algorithms"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Note:</strong> Some of these methods are covered in Chapter 8 of the textbook.</p>
<div id="partitioning-around-medoids-pam" class="section level3" number="7.6.1">
<h3>
<span class="header-section-number">7.6.1</span> Partitioning Around Medoids (PAM)<a class="anchor" aria-label="anchor" href="#partitioning-around-medoids-pam"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/K-medoids">PAM</a> tries to solve the
<span class="math inline">\(k\)</span>-medoids problem. The problem is similar to <span class="math inline">\(k\)</span>-means, but uses
medoids instead of centroids to represent clusters. Like hierarchical
clustering, it typically works with a precomputed distance matrix. An
advantage is that you can use any distance metric not just Euclidean
distances. <strong>Note:</strong> The medoid is the most central data point in the
middle of the cluster. PAM is a lot more computationally expensive compared to
k-means.</p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/">cluster</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">##  'dist' num [1:2775] 2.29 2.18 1.6 1.88 2.69 ...</span></span>
<span><span class="co">##  - attr(*, "Size")= int 75</span></span>
<span><span class="co">##  - attr(*, "Diag")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "Upper")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "method")= chr "Euclidean"</span></span>
<span><span class="co">##  - attr(*, "call")= language dist(x = ruspini_scaled)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/pam.html">pam</a></span><span class="op">(</span><span class="va">d</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">p</span></span>
<span><span class="co">## Medoids:</span></span>
<span><span class="co">##      ID   </span></span>
<span><span class="co">## [1,]  1  1</span></span>
<span><span class="co">## [2,] 55 55</span></span>
<span><span class="co">## [3,] 22 22</span></span>
<span><span class="co">## [4,] 19 19</span></span>
<span><span class="co">## Clustering vector:</span></span>
<span><span class="co">##  [1] 1 2 2 2 2 3 1 4 4 4 4 3 1 4 1 1 2 2 4 4 2 3 2 3 1 3 4 4</span></span>
<span><span class="co">## [29] 3 3 4 1 1 2 2 1 2 1 1 2 4 1 3 3 1 4 1 1 3 1 2 4 2 4 2 1</span></span>
<span><span class="co">## [57] 4 4 2 2 3 3 1 2 3 1 1 2 1 1 2 3 4 3 1</span></span>
<span><span class="co">## Objective function:</span></span>
<span><span class="co">##  build   swap </span></span>
<span><span class="co">## 0.4423 0.3187 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Available components:</span></span>
<span><span class="co">## [1] "medoids"    "id.med"     "clustering" "objective" </span></span>
<span><span class="co">## [5] "isolation"  "clusinfo"   "silinfo"    "diss"      </span></span>
<span><span class="co">## [9] "call"</span></span></code></pre></div>
<p>Extract the clustering and medoids for visualization.</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_clustered</span> <span class="op">&lt;-</span> <span class="va">ruspini_scaled</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">medoids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">medoids</span>, <span class="op">]</span>, </span>
<span>                     rownames <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="va">medoids</span></span>
<span><span class="co">## # A tibble: 4 × 3</span></span>
<span><span class="co">##   cluster      x      y</span></span>
<span><span class="co">##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">## 1 1       -0.357  1.17 </span></span>
<span><span class="co">## 2 2       -1.18  -0.555</span></span>
<span><span class="co">## 3 3        0.463 -1.46 </span></span>
<span><span class="co">## 4 4        1.45   0.554</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_clustered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">medoids</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, </span>
<span>             shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-345-1.png" width="672"></div>
<p>Alternative visualization using <code><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster()</a></code>.</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## __Note:__ `fviz_cluster` needs the original data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ruspini_scaled</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>             ellipse.type <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-346-1.png" width="672"></div>
</div>
<div id="gaussian-mixture-models" class="section level3" number="7.6.2">
<h3>
<span class="header-section-number">7.6.2</span> Gaussian Mixture Models<a class="anchor" aria-label="anchor" href="#gaussian-mixture-models"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/">mclust</a></span><span class="op">)</span></span>
<span><span class="co">## Package 'mclust' version 6.1.1</span></span>
<span><span class="co">## Type 'citation("mclust")' for citing this R package in publications.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'mclust'</span></span>
<span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     map</span></span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Mixture_model#Multivariate_Gaussian_mixture_model">Gaussian mixture
models</a>
assume that the data set is the result of drawing data from a set of
Gaussian distributions where each distribution represents a cluster.
Estimation algorithms try to identify the location parameters of the
distributions and thus can be used to find clusters. <code><a href="https://mclust-org.github.io/mclust/reference/Mclust.html">Mclust()</a></code> uses
Bayesian Information Criterion (BIC) to find the number of clusters
(model selection). BIC uses the likelihood and a penalty term to guard
against overfitting.</p>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/Mclust.html">Mclust</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## Gaussian finite mixture model fitted by EM algorithm </span></span>
<span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mclust EEI (diagonal, equal volume and shape) model with 5</span></span>
<span><span class="co">## components: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  log-likelihood  n df    BIC    ICL</span></span>
<span><span class="co">##          -91.26 75 16 -251.6 -251.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Clustering table:</span></span>
<span><span class="co">##  1  2  3  4  5 </span></span>
<span><span class="co">## 23 20 15 14  3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m</span>, what <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-348-1.png" width="672"></div>
<p>Rerun with a fixed number of 4 clusters</p>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/Mclust.html">Mclust</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, G<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## Gaussian finite mixture model fitted by EM algorithm </span></span>
<span><span class="co">## ---------------------------------------------------- </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mclust EEI (diagonal, equal volume and shape) model with 4</span></span>
<span><span class="co">## components: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  log-likelihood  n df    BIC    ICL</span></span>
<span><span class="co">##          -101.6 75 13 -259.3 -259.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Clustering table:</span></span>
<span><span class="co">##  1  2  3  4 </span></span>
<span><span class="co">## 23 20 15 17</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m</span>, what <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-349-1.png" width="672"></div>
</div>
<div id="spectral-clustering" class="section level3" number="7.6.3">
<h3>
<span class="header-section-number">7.6.3</span> Spectral Clustering<a class="anchor" aria-label="anchor" href="#spectral-clustering"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Spectral_clustering">Spectral clustering</a>
works by embedding the data points of the partitioning problem into the
subspace of the k largest eigenvectors of a normalized affinity/kernel
matrix. Then uses a simple clustering method like k-means.</p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'kernlab'</span></span>
<span><span class="co">## The following object is masked from 'package:arulesSequences':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     size</span></span>
<span><span class="co">## The following object is masked from 'package:scales':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     alpha</span></span>
<span><span class="co">## The following object is masked from 'package:arules':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     size</span></span>
<span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     cross</span></span>
<span><span class="co">## The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     alpha</span></span>
<span><span class="va">cluster_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/specc.html">specc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">as.matrix</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span>, centers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">cluster_spec</span></span>
<span><span class="co">## Spectral Clustering object of class "specc" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Cluster memberships: </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## 4 3 3 3 3 2 4 1 1 1 1 2 4 1 4 4 3 3 1 1 3 2 3 2 4 2 1 1 2 2 1 4 4 3 3 4 3 4 4 3 1 4 2 2 4 1 4 4 2 4 3 1 3 1 3 4 1 1 3 3 2 2 4 3 2 4 4 3 4 4 3 2 1 2 4 </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Gaussian Radial Basis kernel function. </span></span>
<span><span class="co">##  Hyperparameter : sigma =  20.8835033729148 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Centers:  </span></span>
<span><span class="co">##         [,1]    [,2]</span></span>
<span><span class="co">## [1,]  1.4194  0.4693</span></span>
<span><span class="co">## [2,]  0.4607 -1.4912</span></span>
<span><span class="co">## [3,] -1.1386 -0.5560</span></span>
<span><span class="co">## [4,] -0.3595  1.1091</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cluster size:  </span></span>
<span><span class="co">## [1] 17 15 20 23</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Within-cluster sum of squares:  </span></span>
<span><span class="co">## [1] 18.93 54.85 11.34 45.48</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled</span> <span class="op">|&gt;</span> </span>
<span>         <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster_spec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-350-1.png" width="672"></div>
</div>
<div id="deep-clustering-methods" class="section level3" number="7.6.4">
<h3>
<span class="header-section-number">7.6.4</span> Deep Clustering Methods<a class="anchor" aria-label="anchor" href="#deep-clustering-methods"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://arxiv.org/pdf/2210.04142">Deep clustering</a> is often used for high-dimensional data.
It uses a deep autoencoder to learn a cluster-friendly representation
of the data before applying a standard clustering algorithm (e.g., k-means)
on the embedded data.
The autoencoder
is typically implemented using <a href="https://keras3.posit.co/">keras</a>
and the autoencoder’s loss function is modified to include
the clustering loss which will make the embedding more clusterable.</p>
</div>
<div id="fuzzy-c-means-clustering" class="section level3" number="7.6.5">
<h3>
<span class="header-section-number">7.6.5</span> Fuzzy C-Means Clustering<a class="anchor" aria-label="anchor" href="#fuzzy-c-means-clustering"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Fuzzy_clustering">fuzzy clustering</a>
version of the k-means clustering problem. Each data point has a degree
of membership to for each cluster.</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"e1071"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'e1071'</span></span>
<span><span class="co">## The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     element</span></span>
<span><span class="va">cluster_cmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/e1071/man/cmeans.html">cmeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">as.matrix</a></span><span class="op">(</span><span class="va">ruspini_scaled</span><span class="op">)</span>, centers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">cluster_cmeans</span></span>
<span><span class="co">## Fuzzy c-means clustering with 4 clusters</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cluster centers:</span></span>
<span><span class="co">##         x       y</span></span>
<span><span class="co">## 1 -1.1371 -0.5550</span></span>
<span><span class="co">## 2 -0.3763  1.1143</span></span>
<span><span class="co">## 3  0.4552 -1.4760</span></span>
<span><span class="co">## 4  1.5048  0.5161</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Memberships:</span></span>
<span><span class="co">##               1         2         3         4</span></span>
<span><span class="co">##  [1,] 0.0009643 9.977e-01 0.0004512 8.879e-04</span></span>
<span><span class="co">##  [2,] 0.9148680 3.002e-02 0.0405062 1.461e-02</span></span>
<span><span class="co">##  [3,] 0.8877281 4.917e-02 0.0431101 1.999e-02</span></span>
<span><span class="co">##  [4,] 0.7683893 9.312e-02 0.0971203 4.137e-02</span></span>
<span><span class="co">##  [5,] 0.8900960 3.663e-02 0.0549604 1.831e-02</span></span>
<span><span class="co">##  [6,] 0.0038612 1.664e-03 0.9921767 2.298e-03</span></span>
<span><span class="co">##  [7,] 0.0376056 9.294e-01 0.0133136 1.973e-02</span></span>
<span><span class="co">##  [8,] 0.0032212 7.444e-03 0.0047479 9.846e-01</span></span>
<span><span class="co">##  [9,] 0.0394179 1.267e-01 0.0461290 7.877e-01</span></span>
<span><span class="co">## [10,] 0.0002500 5.072e-04 0.0004110 9.988e-01</span></span>
<span><span class="co">## [11,] 0.0075741 1.388e-02 0.0135387 9.650e-01</span></span>
<span><span class="co">## [12,] 0.0254632 9.526e-03 0.9531429 1.187e-02</span></span>
<span><span class="co">## [13,] 0.0419832 9.187e-01 0.0155189 2.380e-02</span></span>
<span><span class="co">## [14,] 0.1075095 1.739e-01 0.1773899 5.412e-01</span></span>
<span><span class="co">## [15,] 0.0483850 9.103e-01 0.0168055 2.448e-02</span></span>
<span><span class="co">## [16,] 0.0371539 9.245e-01 0.0146294 2.371e-02</span></span>
<span><span class="co">## [17,] 0.9426524 2.538e-02 0.0220711 9.896e-03</span></span>
<span><span class="co">## [18,] 0.8953110 5.308e-02 0.0336348 1.798e-02</span></span>
<span><span class="co">## [19,] 0.0006092 1.324e-03 0.0009436 9.971e-01</span></span>
<span><span class="co">## [20,] 0.0106794 1.929e-02 0.0192355 9.508e-01</span></span>
<span><span class="co">## [21,] 0.9045073 4.507e-02 0.0339770 1.645e-02</span></span>
<span><span class="co">## [22,] 0.0001096 5.052e-05 0.9997656 7.424e-05</span></span>
<span><span class="co">## [23,] 0.9731699 9.545e-03 0.0127747 4.511e-03</span></span>
<span><span class="co">## [24,] 0.0030791 1.396e-03 0.9934965 2.029e-03</span></span>
<span><span class="co">## [25,] 0.0713882 7.016e-01 0.0509709 1.760e-01</span></span>
<span><span class="co">## [26,] 0.0205931 1.087e-02 0.9503616 1.818e-02</span></span>
<span><span class="co">## [27,] 0.0392620 9.618e-02 0.0536215 8.109e-01</span></span>
<span><span class="co">## [28,] 0.1283082 2.177e-01 0.1837576 4.703e-01</span></span>
<span><span class="co">## [29,] 0.0249349 1.136e-02 0.9472520 1.646e-02</span></span>
<span><span class="co">## [30,] 0.0384838 2.343e-02 0.8921802 4.591e-02</span></span>
<span><span class="co">## [31,] 0.0130801 2.683e-02 0.0205434 9.395e-01</span></span>
<span><span class="co">## [32,] 0.0033849 9.924e-01 0.0014973 2.767e-03</span></span>
<span><span class="co">## [33,] 0.0151633 9.597e-01 0.0078901 1.728e-02</span></span>
<span><span class="co">## [34,] 0.9302684 2.248e-02 0.0358179 1.143e-02</span></span>
<span><span class="co">## [35,] 0.9920941 3.143e-03 0.0034030 1.360e-03</span></span>
<span><span class="co">## [36,] 0.0112519 9.693e-01 0.0059278 1.354e-02</span></span>
<span><span class="co">## [37,] 0.9540725 2.256e-02 0.0155206 7.844e-03</span></span>
<span><span class="co">## [38,] 0.0920675 7.514e-01 0.0519053 1.047e-01</span></span>
<span><span class="co">## [39,] 0.0758512 8.622e-01 0.0256682 3.625e-02</span></span>
<span><span class="co">## [40,] 0.9626044 1.710e-02 0.0138101 6.486e-03</span></span>
<span><span class="co">## [41,] 0.0058692 1.130e-02 0.0099614 9.729e-01</span></span>
<span><span class="co">## [42,] 0.0204611 9.395e-01 0.0114699 2.852e-02</span></span>
<span><span class="co">## [43,] 0.0241504 1.011e-02 0.9523623 1.337e-02</span></span>
<span><span class="co">## [44,] 0.0173389 9.017e-03 0.9591007 1.454e-02</span></span>
<span><span class="co">## [45,] 0.0015600 9.964e-01 0.0007051 1.322e-03</span></span>
<span><span class="co">## [46,] 0.0184319 3.390e-02 0.0318375 9.158e-01</span></span>
<span><span class="co">## [47,] 0.0120649 9.754e-01 0.0047499 7.761e-03</span></span>
<span><span class="co">## [48,] 0.0333622 8.915e-01 0.0199935 5.510e-02</span></span>
<span><span class="co">## [49,] 0.0498123 1.727e-02 0.9125422 2.038e-02</span></span>
<span><span class="co">## [50,] 0.0672233 7.551e-01 0.0448213 1.329e-01</span></span>
<span><span class="co">## [51,] 0.8288352 9.817e-02 0.0452768 2.771e-02</span></span>
<span><span class="co">## [52,] 0.0061528 1.483e-02 0.0087249 9.703e-01</span></span>
<span><span class="co">## [53,] 0.9343415 2.687e-02 0.0272619 1.153e-02</span></span>
<span><span class="co">## [54,] 0.0011602 2.456e-03 0.0018406 9.945e-01</span></span>
<span><span class="co">## [55,] 0.9989320 4.474e-04 0.0004367 1.839e-04</span></span>
<span><span class="co">## [56,] 0.0044839 9.885e-01 0.0022374 4.752e-03</span></span>
<span><span class="co">## [57,] 0.0034560 8.073e-03 0.0050417 9.834e-01</span></span>
<span><span class="co">## [58,] 0.0229230 4.091e-02 0.0405213 8.956e-01</span></span>
<span><span class="co">## [59,] 0.8727657 4.260e-02 0.0633412 2.130e-02</span></span>
<span><span class="co">## [60,] 0.9712833 1.357e-02 0.0102381 4.907e-03</span></span>
<span><span class="co">## [61,] 0.0287389 1.083e-02 0.9470184 1.341e-02</span></span>
<span><span class="co">## [62,] 0.0203875 1.111e-02 0.9492342 1.926e-02</span></span>
<span><span class="co">## [63,] 0.0256390 9.467e-01 0.0103553 1.729e-02</span></span>
<span><span class="co">## [64,] 0.8604239 5.522e-02 0.0593849 2.497e-02</span></span>
<span><span class="co">## [65,] 0.0082410 3.347e-03 0.9839900 4.423e-03</span></span>
<span><span class="co">## [66,] 0.0114703 9.753e-01 0.0048169 8.408e-03</span></span>
<span><span class="co">## [67,] 0.0103266 9.787e-01 0.0041349 6.878e-03</span></span>
<span><span class="co">## [68,] 0.9397726 2.104e-02 0.0290836 1.010e-02</span></span>
<span><span class="co">## [69,] 0.0095409 9.763e-01 0.0046348 9.540e-03</span></span>
<span><span class="co">## [70,] 0.0046268 9.889e-01 0.0021822 4.269e-03</span></span>
<span><span class="co">## [71,] 0.8665154 3.837e-02 0.0740308 2.108e-02</span></span>
<span><span class="co">## [72,] 0.0183428 1.016e-02 0.9537438 1.775e-02</span></span>
<span><span class="co">## [73,] 0.0654674 1.100e-01 0.1188607 7.056e-01</span></span>
<span><span class="co">## [74,] 0.0031669 1.347e-03 0.9936326 1.853e-03</span></span>
<span><span class="co">## [75,] 0.0247839 9.272e-01 0.0139396 3.405e-02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Closest hard clustering:</span></span>
<span><span class="co">##  [1] 2 1 1 1 1 3 2 4 4 4 4 3 2 4 2 2 1 1 4 4 1 3 1 3 2 3 4 4</span></span>
<span><span class="co">## [29] 3 3 4 2 2 1 1 2 1 2 2 1 4 2 3 3 2 4 2 2 3 2 1 4 1 4 1 2</span></span>
<span><span class="co">## [57] 4 4 1 1 3 3 2 1 3 2 2 1 2 2 1 3 4 3 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Available components:</span></span>
<span><span class="co">## [1] "centers"     "size"        "cluster"     "membership" </span></span>
<span><span class="co">## [5] "iter"        "withinerror" "call"</span></span></code></pre></div>
<p>Plot membership (shown as small pie charts)</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"scatterpie"</span><span class="op">)</span></span>
<span><span class="co">## scatterpie v0.2.6 Learn more at https://yulab-smu.top/</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scatterpie/man/geom-scatterpie.html">geom_scatterpie</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ruspini_scaled</span>, <span class="va">cluster_cmeans</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cluster_cmeans</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span>, </span>
<span>    legend_name <span class="op">=</span> <span class="st">"Membership"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-352-1.png" width="672"></div>
</div>
</div>
<div id="scale-issues-in-clustering" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Scale Issues in Clustering*<a class="anchor" aria-label="anchor" href="#scale-issues-in-clustering"><i class="fas fa-link"></i></a>
</h2>
<p>To demonstrate this issue, I will use the unscaled Ruspini dataset and assume that
we measure x in millimeters and y in meters. I do this by multiplying x by 1000.</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_scale_issue</span> <span class="op">&lt;-</span> <span class="va">ruspini</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ruspini_scale_issue</span><span class="op">)</span></span>
<span><span class="co">##        x                y        </span></span>
<span><span class="co">##  Min.   :  4000   Min.   :  4.0  </span></span>
<span><span class="co">##  1st Qu.: 31500   1st Qu.: 56.5  </span></span>
<span><span class="co">##  Median : 52000   Median : 96.0  </span></span>
<span><span class="co">##  Mean   : 54880   Mean   : 92.0  </span></span>
<span><span class="co">##  3rd Qu.: 76500   3rd Qu.:141.5  </span></span>
<span><span class="co">##  Max.   :117000   Max.   :156.0</span></span></code></pre></div>
<p>If we cluster the data now, then the algorithm fails!</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scale_issue</span>, centers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_clustered</span> <span class="op">&lt;-</span> <span class="va">ruspini_scale_issue</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_clustered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-355-1.png" width="672"></div>
<p>The clusters form vertical bands across the whole plot.
The reason is that the large numeric differences for the x-axis
overpower the relatively small differences in the y-axis when distances are
calculated. This issue can be avoided by scaling all variables first.</p>
</div>
<div id="outliers-in-clustering" class="section level2" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Outliers in Clustering*<a class="anchor" aria-label="anchor" href="#outliers-in-clustering"><i class="fas fa-link"></i></a>
</h2>
<p>Most clustering algorithms perform complete assignment (i.e., all data
points need to be assigned to a cluster). Outliers will affect the
clustering.</p>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/dbscan">dbscan</a></span><span class="op">)</span></span></code></pre></div>
<p>To show this effect, we add a clear outlier with a very large <span class="math inline">\(x\)</span> value to the Ruspini dataset.</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_outlier</span> <span class="op">&lt;-</span> <span class="va">ruspini</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_case</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">10000</span>, y<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_outlier</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-357-1.png" width="672"></div>
<p>The outlier presents a problem for k-means, even if we scale the data. Scaling data
with an outlier will make the direction of the outlier (in this case <span class="math inline">\(x\)</span>)
the most important.</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_scaled_outlier</span> <span class="op">&lt;-</span> <span class="va">ruspini_outlier</span> <span class="op">|&gt;</span> <span class="fu">scale_numeric</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled_outlier</span>, centers <span class="op">=</span> <span class="fl">4</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ruspini_scaled_outlier_km</span> <span class="op">&lt;-</span> <span class="va">ruspini_scaled_outlier</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">centers</span>, rownames <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled_outlier_km</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, </span>
<span>             shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-358-1.png" width="672"></div>
<p>Often, outliers become their own clusters.
It is tempting to deal with this issue
by adding additional clusters, one per outlier.
<strong>But this does not work!</strong></p>
<p>Here is the result with one additional cluster.</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled_outlier</span>, centers <span class="op">=</span> <span class="fl">5</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ruspini_scaled_outlier_km</span> <span class="op">&lt;-</span> <span class="va">ruspini_scaled_outlier</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">centers</span>, rownames <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled_outlier_km</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, </span>
<span>             shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-359-1.png" width="672"></div>
<p>Here it seems to work, but this only happens because the clusters in the
Ruspini dataset are nicely spread out over the <span class="math inline">\(y\)</span> axis. The outlier suppresses
the effect of variability in the <span class="math inline">\(x\)</span> direction. The top two clusters in the
following plot of the clustering without the outlier point
shows that the clustering just uses the <span class="math inline">\(y\)</span> axis to cut the data and completely
ignors <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled_outlier_km</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-360-1.png" width="672"></div>
<p><strong>So this does not work!</strong>
You need to identify and
remove outliers before scaling the data.
Methods to identify outliers are summary statistics, visual inspection,
and outlier scores like the Local Outlier Factor (LOF) discussed in the following
sections.</p>
<div id="visual-identification-of-outliers" class="section level3" number="7.8.1">
<h3>
<span class="header-section-number">7.8.1</span> Visual Identification of Outliers<a class="anchor" aria-label="anchor" href="#visual-identification-of-outliers"><i class="fas fa-link"></i></a>
</h3>
<p>Outliers can be identified using summary statistics, histograms,
scatterplots (pairs plots), and boxplots, etc. We use here a pairs plot
(the diagonal contains smoothed histograms). The outlier is visible as
the single separate point in the scatter plot and as the long tail of
the smoothed histogram for <code>x</code>. Remember, in scaled data, we expect most observations to
fall in the range <span class="math inline">\([-3,3]\)</span>.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggobi.github.io/ggally/">"GGally"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">ruspini_outlier</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-361-1.png" width="672"></div>
<p>The tope left panel in the plot shows that therw is an outlier in the x axis.
The x value of regular points is way less then 2500 and we can use this information
to identify outliers.
We can find the row number by</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">ruspini_outlier</span><span class="op">$</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">2500</span><span class="op">)</span></span>
<span><span class="co">## [1] 76</span></span></code></pre></div>
<p>and then manually remove it before scaling the data.</p>
</div>
<div id="local-outlier-factor" class="section level3" number="7.8.2">
<h3>
<span class="header-section-number">7.8.2</span> Local Outlier Factor<a class="anchor" aria-label="anchor" href="#local-outlier-factor"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Local_outlier_factor">Local Outlier
Factor (LOF)</a> is related
to concepts of DBSCAN can help to identify potential outliers.
LOF compares the density of a data point to its neighboring data points.
If a data point has a much lower density than its neighbors, it has a high LOF score and is considered an outlier.</p>
<p>It is useful to identify outliers and remove strong outliers
prior to clustering. A density based method to identify outlier is
<a href="https://en.wikipedia.org/wiki/Local_outlier_factor">LOF</a> (Local Outlier
Factor). It is related to dbscan and compares the density around a point
with the densities around its neighbors (you have to specify the
neighborhood size <span class="math inline">\(k\)</span>). The LOF value for a regular data point is 1. The
larger the LOF value gets, the more likely the point is an outlier.</p>
<p>To calculate
the LOF, a local neighborhood size (MinPts in DBSCAN) for density estimation
needs to be chosen. I use 10 here since I expect my clusters to have each more
than 10 points. Note that LOF uses distances, so we need to scale the data first.</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_outlier_scaled</span> <span class="op">&lt;-</span> <span class="va">ruspini_outlier</span> <span class="op">|&gt;</span> <span class="fu">scale_numeric</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lof</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/lof.html">lof</a></span><span class="op">(</span><span class="va">ruspini_outlier_scaled</span>, minPts<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">lof</span></span>
<span><span class="co">##  [1]  0.9286  1.3222  0.9521  1.1313  0.9664  1.0068  1.0342</span></span>
<span><span class="co">##  [8]  0.9541  1.3508  0.9915  1.0356  0.9313  0.9289  1.5467</span></span>
<span><span class="co">## [15]  1.0078  1.0820  1.1303  1.1708  0.9082  1.0356  1.1593</span></span>
<span><span class="co">## [22]  0.9838  1.0139  0.9313  1.0623  1.1230  0.9915  1.8401</span></span>
<span><span class="co">## [29]  1.6549  0.9828  1.1291  0.9570  1.0128  1.0483  0.9200</span></span>
<span><span class="co">## [36]  1.0299  1.1362  1.0523  0.9999  1.1179  1.0078  1.0289</span></span>
<span><span class="co">## [43]  1.2959  1.3537  1.0122  1.0080  1.0097  1.1418  1.0781</span></span>
<span><span class="co">## [50]  1.3697  1.2170  1.2333  0.9845  1.0081  1.0028  0.9289</span></span>
<span><span class="co">## [57]  1.0423  0.9915  0.9200  1.1800  1.0938  0.9468  1.0533</span></span>
<span><span class="co">## [64]  1.0159  0.9451  0.9567  1.0003  0.9667  1.2781  1.0128</span></span>
<span><span class="co">## [71]  1.0785  1.1230  1.8383  0.9626  0.9935 55.3714</span></span>
<span><span class="va">ruspini_outlier_scaled</span>  <span class="op">&lt;-</span> <span class="va">ruspini_outlier_scaled</span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>lof <span class="op">=</span> <span class="va">lof</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_outlier_scaled</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">lof</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"gray"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-363-1.png" width="672"></div>
<p>Plot the points sorted by increasing LOF and look for a knee.</p>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lof</span><span class="op">)</span><span class="op">)</span>, lof <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/arules/man/sort.html">sort</a></span><span class="op">(</span><span class="va">lof</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">lof</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-364-1.png" width="672"></div>
<p>We choose here a threshold above 2.</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_outlier_scaled</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>outlier <span class="op">=</span> <span class="va">lof</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">outlier</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-365-1.png" width="672"></div>
<p>You should analyze the found outliers. They are often interesting and important
data points.</p>
<p>To model the regular data, perform clustering on the regular data points
without outliers. Note that the data needs to be rescaled after the outlier
is removed. This will remove the scaling issues caused by the outlier.</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ruspini_scaled_clean</span> <span class="op">&lt;-</span> <span class="va">ruspini_outlier_scaled</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lof</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scale_numeric</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">ruspini_scaled_clean</span>, centers <span class="op">=</span> <span class="fl">4</span>, nstart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ruspini_scaled_clean_km</span> <span class="op">&lt;-</span> <span class="va">ruspini_scaled_clean</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">km</span><span class="op">$</span><span class="va">centers</span>, rownames <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ruspini_scaled_clean_km</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">centroids</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, </span>
<span>             shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-366-1.png" width="672"></div>
<p>You may have to repeat the identification, removal and rescaling steps several
times to find outliers of different scale.</p>
<p>There are many other outlier removal strategies available. See, e.g.,
package <a href="https://cran.r-project.org/package=outliers">outliers</a>.</p>
</div>
</div>
<div id="exercises-4" class="section level2" number="7.9">
<h2>
<span class="header-section-number">7.9</span> Exercises*<a class="anchor" aria-label="anchor" href="#exercises-4"><i class="fas fa-link"></i></a>
</h2>
<p>We will again use the Palmer penguin data for the exercises.</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   species island    bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Torgersen           39.1          18.7</span></span>
<span><span class="co">## 2 Adelie  Torgersen           39.5          17.4</span></span>
<span><span class="co">## 3 Adelie  Torgersen           40.3          18  </span></span>
<span><span class="co">## 4 Adelie  Torgersen           NA            NA  </span></span>
<span><span class="co">## 5 Adelie  Torgersen           36.7          19.3</span></span>
<span><span class="co">## 6 Adelie  Torgersen           39.3          20.6</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
<p>Create a R markdown file with the code and discussion for the following below.</p>
<ol style="list-style-type: decimal">
<li>What features do you use for clustering? What about missing values?
Discuss your answers. Do you need to scale the data before clustering? Why?</li>
<li>What distance measure do you use to reflect similarities between penguins?
See <a href="data.html#measures-of-similarity-and-dissimilarity">Measures of Similarity and Dissimilarity</a> in Chapter 2.</li>
<li>Apply k-means clustering. Use an appropriate method to determine the number
of clusters. Compare the clustering using unscaled data and
scaled data. What is the difference? Visualize and describe the results.</li>
<li>Apply hierarchical clustering.
Create a dendrogram and discuss what it means.</li>
<li>Apply DBSCAN. How do you choose the parameters? How well does it work?</li>
</ol>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></div>
<div class="next"><a href="data-exploration-and-visualization.html"><span class="header-section-number">A</span> Data Exploration and Visualization</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#cluster-analysis"><span class="header-section-number">7</span> Cluster Analysis</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#packages-used-in-this-chapter-5">Packages Used in this Chapter</a></li></ul>
</li>
<li>
<a class="nav-link" href="#overview"><span class="header-section-number">7.1</span> Overview</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-preparation"><span class="header-section-number">7.1.1</span> Data Preparation</a></li>
<li><a class="nav-link" href="#data-cleaning"><span class="header-section-number">7.1.2</span> Data cleaning</a></li>
<li><a class="nav-link" href="#scale-data"><span class="header-section-number">7.1.3</span> Scale data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#k-means"><span class="header-section-number">7.2</span> K-means</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inspect-clusters"><span class="header-section-number">7.2.1</span> Inspect Clusters</a></li>
<li><a class="nav-link" href="#extract-a-single-cluster"><span class="header-section-number">7.2.2</span> Extract a Single Cluster</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#agglomerative-hierarchical-clustering"><span class="header-section-number">7.3</span> Agglomerative Hierarchical Clustering</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-a-dendrogram"><span class="header-section-number">7.3.1</span> Creating a Dendrogram</a></li>
<li><a class="nav-link" href="#extracting-a-partitional-clustering"><span class="header-section-number">7.3.2</span> Extracting a Partitional Clustering</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dbscan"><span class="header-section-number">7.4</span> DBSCAN</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dbscan-parameters"><span class="header-section-number">7.4.1</span> DBSCAN Parameters</a></li>
<li><a class="nav-link" href="#cluster-using-dbscan"><span class="header-section-number">7.4.2</span> Cluster using DBSCAN</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#cluster-evaluation"><span class="header-section-number">7.5</span> Cluster Evaluation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#unsupervised-cluster-evaluation"><span class="header-section-number">7.5.1</span> Unsupervised Cluster Evaluation</a></li>
<li><a class="nav-link" href="#determining-the-correct-number-of-clusters"><span class="header-section-number">7.5.2</span> Determining the Correct Number of Clusters</a></li>
<li><a class="nav-link" href="#clustering-tendency"><span class="header-section-number">7.5.3</span> Clustering Tendency</a></li>
<li><a class="nav-link" href="#supervised-cluster-evaluation"><span class="header-section-number">7.5.4</span> Supervised Cluster Evaluation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#more-clustering-algorithms"><span class="header-section-number">7.6</span> More Clustering Algorithms*</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#partitioning-around-medoids-pam"><span class="header-section-number">7.6.1</span> Partitioning Around Medoids (PAM)</a></li>
<li><a class="nav-link" href="#gaussian-mixture-models"><span class="header-section-number">7.6.2</span> Gaussian Mixture Models</a></li>
<li><a class="nav-link" href="#spectral-clustering"><span class="header-section-number">7.6.3</span> Spectral Clustering</a></li>
<li><a class="nav-link" href="#deep-clustering-methods"><span class="header-section-number">7.6.4</span> Deep Clustering Methods</a></li>
<li><a class="nav-link" href="#fuzzy-c-means-clustering"><span class="header-section-number">7.6.5</span> Fuzzy C-Means Clustering</a></li>
</ul>
</li>
<li><a class="nav-link" href="#scale-issues-in-clustering"><span class="header-section-number">7.7</span> Scale Issues in Clustering*</a></li>
<li>
<a class="nav-link" href="#outliers-in-clustering"><span class="header-section-number">7.8</span> Outliers in Clustering*</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#visual-identification-of-outliers"><span class="header-section-number">7.8.1</span> Visual Identification of Outliers</a></li>
<li><a class="nav-link" href="#local-outlier-factor"><span class="header-section-number">7.8.2</span> Local Outlier Factor</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercises-4"><span class="header-section-number">7.9</span> Exercises*</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/blob/master/book_src/07_cluster_analysis.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/edit/master/book_src/07_cluster_analysis.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An R Companion for Introduction to Data Mining</strong>" was written by Michael Hahsler. It was last built on 2025-12-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
