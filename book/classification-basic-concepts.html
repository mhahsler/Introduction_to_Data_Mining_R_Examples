<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Classification: Basic Concepts | An R Companion for Introduction to Data Mining</title>
<meta name="author" content="Michael Hahsler">
<meta name="description" content="This chapter introduces decision trees for classification and discusses how models are built and evaluated. The corresponding chapter of the data mining textbook is available online: Chapter 3:...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 3 Classification: Basic Concepts | An R Companion for Introduction to Data Mining">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="This chapter introduces decision trees for classification and discusses how models are built and evaluated. The corresponding chapter of the data mining textbook is available online: Chapter 3:...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Classification: Basic Concepts | An R Companion for Introduction to Data Mining">
<meta name="twitter:description" content="This chapter introduces decision trees for classification and discusses how models are built and evaluated. The corresponding chapter of the data mining textbook is available online: Chapter 3:...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/accessible-code-block/empty-anchor.js"></script><link href="libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><link href="libs/nouislider/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider/jquery.nouislider.min.js"></script><link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize/selectize.min.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An R Companion for Introduction to Data Mining</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="active" href="classification-basic-concepts.html"><span class="header-section-number">3</span> Classification: Basic Concepts</a></li>
<li><a class="" href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></li>
<li><a class="" href="association-analysis-basic-concepts.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts</a></li>
<li><a class="" href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></li>
<li><a class="" href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">8</span> Regression*</a></li>
<li><a class="" href="logistic-regression-1.html"><span class="header-section-number">9</span> Logistic Regression*</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="classification-basic-concepts" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Classification: Basic Concepts<a class="anchor" aria-label="anchor" href="#classification-basic-concepts"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter introduces decision trees for classification and discusses
how models are built and evaluated.</p>
<p>The corresponding chapter of
the data mining textbook is available online:
<a href="https://www-users.cs.umn.edu/~kumar001/dmbook/ch3_classification.pdf">Chapter 3: Classification: Basic Concepts and Techniques.</a></p>
<div id="packages-used-in-this-chapter-1" class="section level3 unnumbered" number="">
<h3>Packages Used in this Chapter<a class="anchor" aria-label="anchor" href="#packages-used-in-this-chapter-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"caret"</span>, <span class="st">"FSelector"</span>, <span class="st">"lattice"</span>, <span class="st">"mlbench"</span>, </span>
<span>          <span class="st">"palmerpenguins"</span>, <span class="st">"party"</span>, <span class="st">"pROC"</span>, <span class="st">"rpart"</span>, </span>
<span>          <span class="st">"rpart.plot"</span>, <span class="st">"tidyverse"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkgs_install</span> <span class="op">&lt;-</span> <span class="va">pkgs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/pkg/arules/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span></span></code></pre></div>
<p>The packages used for this chapter are:</p>
<ul>
<li>
<em>caret</em> <span class="citation">(M. Kuhn <a href="references.html#ref-R-caret" role="doc-biblioref">2023</a>)</span>
</li>
<li>
<em>FSelector</em> <span class="citation">(Romanski, Kotthoff, and Schratz <a href="references.html#ref-R-FSelector" role="doc-biblioref">2023</a>)</span>
</li>
<li>
<em>lattice</em> <span class="citation">(Sarkar <a href="references.html#ref-R-lattice" role="doc-biblioref">2023</a>)</span>
</li>
<li>
<em>mlbench</em> <span class="citation">(Leisch and Dimitriadou <a href="references.html#ref-R-mlbench" role="doc-biblioref">2024</a>)</span>
</li>
<li>
<em>palmerpenguins</em> <span class="citation">(Horst, Hill, and Gorman <a href="references.html#ref-R-palmerpenguins" role="doc-biblioref">2022</a>)</span>
</li>
<li>
<em>party</em> <span class="citation">(Hothorn et al. <a href="references.html#ref-R-party" role="doc-biblioref">2024</a>)</span>
</li>
<li>
<em>pROC</em> <span class="citation">(Robin et al. <a href="references.html#ref-R-pROC" role="doc-biblioref">2023</a>)</span>
</li>
<li>
<em>rpart</em> <span class="citation">(Therneau and Atkinson <a href="references.html#ref-R-rpart" role="doc-biblioref">2023</a>)</span>
</li>
<li>
<em>rpart.plot</em> <span class="citation">(Milborrow <a href="references.html#ref-R-rpart.plot" role="doc-biblioref">2024</a>)</span>
</li>
<li>
<em>tidyverse</em> <span class="citation">(Wickham <a href="references.html#ref-R-tidyverse" role="doc-biblioref">2023</a><a href="references.html#ref-R-tidyverse" role="doc-biblioref">c</a>)</span>
</li>
</ul>
<p>In the examples in this book, we use the popular machine learning R package <a href="https://topepo.github.io/caret/"><code>caret</code></a>. It makes preparing
training sets, building classification (and regression) models and
evaluation easier. A great cheat sheet can be found
<a href="https://ugoproto.github.io/ugo_r_doc/pdf/caret.pdf">here</a>.</p>
<p>A newer R framework for machine learning
is <a href="https://www.tidymodels.org/"><code>tidymodels</code></a>, a set of packages that
integrate more naturally with tidyverse. Using tidymodels, or any other
framework (e.g., Python’s <a href="https://scikit-learn.org/">scikit-learn</a>) should
be relatively easy after
learning the concepts using caret.</p>
</div>
<div id="basic-concepts" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Basic Concepts<a class="anchor" aria-label="anchor" href="#basic-concepts"><i class="fas fa-link"></i></a>
</h2>
<p>Classification is a machine learning task with the goal to learn a predictive
function of the form</p>
<p><span class="math display">\[y = f(\mathbf{x}),\]</span></p>
<p>where <span class="math inline">\(\mathbf{x}\)</span> is called the attribute set and <span class="math inline">\(y\)</span> the class label. The attribute set
consists of feature which describe an object. These features can be measured using any scale
(i.e., nominal, interval, …). The class label is a nominal attribute. It it is a binary
attribute, then the problem is called a binary classification problem.</p>
<p>Classification learns the classification model from training data where both the features and
the correct class label are available. This is why it is called a <a href="https://en.wikipedia.org/wiki/Supervised_learning">supervised learning problem</a>.</p>
<p>A related supervised learning problem is <a href="https://en.wikipedia.org/wiki/Linear_regression">regression</a>,
where <span class="math inline">\(y\)</span> is a number instead of a label.
Linear regression is a very popular supervised learning model
which is taught in almost any introductory statistics course.
Code examples for regression are available in the extra Chapter
<a href="regression.html#regression">Regression*</a>.</p>
<p>This chapter will introduce decision trees, model evaluation and comparison, feature selection,
and then explore methods to handle the class imbalance problem.</p>
<p>You can read the free sample chapter from the textbook <span class="citation">(Tan, Steinbach, and Kumar <a href="references.html#ref-Tan2005" role="doc-biblioref">2005</a>)</span>:
<a href="https://www-users.cs.umn.edu/~kumar001/dmbook/ch3_classification.pdf">Chapter 3. Classification: Basic Concepts and
Techniques</a></p>
</div>
<div id="general-framework-for-classification" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> General Framework for Classification<a class="anchor" aria-label="anchor" href="#general-framework-for-classification"><i class="fas fa-link"></i></a>
</h2>
<p>Supervised learning has two steps:</p>
<ol style="list-style-type: decimal">
<li>Induction: Training a model on <strong>training data</strong> with known class labels.</li>
<li>Deduction: Predicting class labels for new data.</li>
</ol>
<p>We often test model by predicting the class for data where we know the
correct label. We test the model on <strong>test data</strong> with known labels
and can then calculate the error by comparing the prediction with the
known correct label.
It is tempting to measure how well the model has learned the
training data, by testing it on the training data. The error on the
training data is called <strong>resubstitution error.</strong> It does not
help us to find out if the model generalizes well to new data that
was not part of the training.</p>
<p>We typically want to
evaluate how well the model generalizes new data, so it is important that
the test data and the training data do not overlap. We call the
error on proper test data the <strong>generalization error.</strong></p>
<p>This chapter builds up the needed concepts.
A complete example of how to perform model selection and estimate
the generalization error is in the section <a href="classification-basic-concepts.html#hyperparameter-tuning">Hyperparameter Tuning</a>.</p>
<div id="the-zoo-dataset" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> The Zoo Dataset<a class="anchor" aria-label="anchor" href="#the-zoo-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>To demonstrate classification, we will use the Zoo dataset which is included in the R package
<strong>mlbench</strong> (you may have to install it). The Zoo dataset containing 17
(mostly logical) variables for 101 animals as a data frame with
17 columns (hair, feathers, eggs, milk, airborne, aquatic, predator,
toothed, backbone, breathes, venomous, fins, legs, tail, domestic,
catsize, type).
The first 16 columns represent the feature vector <span class="math inline">\(\mathbf{x}\)</span> and the last column
called type is the class label <span class="math inline">\(y\)</span>.
We convert the data frame into a tidyverse tibble
(optional).</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Zoo</span>, package<span class="op">=</span><span class="st">"mlbench"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Zoo</span><span class="op">)</span></span>
<span><span class="co">##           hair feathers  eggs  milk airborne aquatic</span></span>
<span><span class="co">## aardvark  TRUE    FALSE FALSE  TRUE    FALSE   FALSE</span></span>
<span><span class="co">## antelope  TRUE    FALSE FALSE  TRUE    FALSE   FALSE</span></span>
<span><span class="co">## bass     FALSE    FALSE  TRUE FALSE    FALSE    TRUE</span></span>
<span><span class="co">## bear      TRUE    FALSE FALSE  TRUE    FALSE   FALSE</span></span>
<span><span class="co">## boar      TRUE    FALSE FALSE  TRUE    FALSE   FALSE</span></span>
<span><span class="co">## buffalo   TRUE    FALSE FALSE  TRUE    FALSE   FALSE</span></span>
<span><span class="co">##          predator toothed backbone breathes venomous  fins</span></span>
<span><span class="co">## aardvark     TRUE    TRUE     TRUE     TRUE    FALSE FALSE</span></span>
<span><span class="co">## antelope    FALSE    TRUE     TRUE     TRUE    FALSE FALSE</span></span>
<span><span class="co">## bass         TRUE    TRUE     TRUE    FALSE    FALSE  TRUE</span></span>
<span><span class="co">## bear         TRUE    TRUE     TRUE     TRUE    FALSE FALSE</span></span>
<span><span class="co">## boar         TRUE    TRUE     TRUE     TRUE    FALSE FALSE</span></span>
<span><span class="co">## buffalo     FALSE    TRUE     TRUE     TRUE    FALSE FALSE</span></span>
<span><span class="co">##          legs  tail domestic catsize   type</span></span>
<span><span class="co">## aardvark    4 FALSE    FALSE    TRUE mammal</span></span>
<span><span class="co">## antelope    4  TRUE    FALSE    TRUE mammal</span></span>
<span><span class="co">## bass        0  TRUE    FALSE   FALSE   fish</span></span>
<span><span class="co">## bear        4 FALSE    FALSE    TRUE mammal</span></span>
<span><span class="co">## boar        4  TRUE    FALSE    TRUE mammal</span></span>
<span><span class="co">## buffalo     4  TRUE    FALSE    TRUE mammal</span></span></code></pre></div>
<p><em>Note:</em> data.frames in R can have row names. The Zoo data set uses the
animal name as the row names. tibbles from <code>tidyverse</code> do not support
row names. To keep the animal name you can add a column with the animal
name.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">Zoo</span>, rownames <span class="op">=</span> <span class="st">"animal"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 101 × 18</span></span>
<span><span class="co">##    animal   hair  feathers eggs  milk  airborne aquatic</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt;  </span></span>
<span><span class="co">##  1 aardvark TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  2 antelope TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  3 bass     FALSE FALSE    TRUE  FALSE FALSE    TRUE   </span></span>
<span><span class="co">##  4 bear     TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  5 boar     TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  6 buffalo  TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  7 calf     TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">##  8 carp     FALSE FALSE    TRUE  FALSE FALSE    TRUE   </span></span>
<span><span class="co">##  9 catfish  FALSE FALSE    TRUE  FALSE FALSE    TRUE   </span></span>
<span><span class="co">## 10 cavy     TRUE  FALSE    FALSE TRUE  FALSE    FALSE  </span></span>
<span><span class="co">## # ℹ 91 more rows</span></span>
<span><span class="co">## # ℹ 11 more variables: predator &lt;lgl&gt;, toothed &lt;lgl&gt;,</span></span>
<span><span class="co">## #   backbone &lt;lgl&gt;, breathes &lt;lgl&gt;, venomous &lt;lgl&gt;,</span></span>
<span><span class="co">## #   fins &lt;lgl&gt;, legs &lt;int&gt;, tail &lt;lgl&gt;, domestic &lt;lgl&gt;,</span></span>
<span><span class="co">## #   catsize &lt;lgl&gt;, type &lt;fct&gt;</span></span></code></pre></div>
<p>You will have to remove the animal column before learning a model! In
the following I use the data.frame.</p>
<p>I translate all the TRUE/FALSE values into factors (nominal). This is
often needed for building models. Always check <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to make sure
the data is ready for model learning.</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Zoo</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.logical</span><span class="op">)</span>, </span>
<span>         <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">factor</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Zoo</span><span class="op">)</span></span>
<span><span class="co">##     hair     feathers     eggs       milk     airborne </span></span>
<span><span class="co">##  TRUE :43   TRUE :20   TRUE :59   TRUE :41   TRUE :24  </span></span>
<span><span class="co">##  FALSE:58   FALSE:81   FALSE:42   FALSE:60   FALSE:77  </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##   aquatic    predator   toothed    backbone   breathes </span></span>
<span><span class="co">##  TRUE :36   TRUE :56   TRUE :61   TRUE :83   TRUE :80  </span></span>
<span><span class="co">##  FALSE:65   FALSE:45   FALSE:40   FALSE:18   FALSE:21  </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##                                                        </span></span>
<span><span class="co">##   venomous     fins         legs         tail     domestic </span></span>
<span><span class="co">##  TRUE : 8   TRUE :17   Min.   :0.00   TRUE :75   TRUE :13  </span></span>
<span><span class="co">##  FALSE:93   FALSE:84   1st Qu.:2.00   FALSE:26   FALSE:88  </span></span>
<span><span class="co">##                        Median :4.00                        </span></span>
<span><span class="co">##                        Mean   :2.84                        </span></span>
<span><span class="co">##                        3rd Qu.:4.00                        </span></span>
<span><span class="co">##                        Max.   :8.00                        </span></span>
<span><span class="co">##                                                            </span></span>
<span><span class="co">##   catsize              type   </span></span>
<span><span class="co">##  TRUE :44   mammal       :41  </span></span>
<span><span class="co">##  FALSE:57   bird         :20  </span></span>
<span><span class="co">##             reptile      : 5  </span></span>
<span><span class="co">##             fish         :13  </span></span>
<span><span class="co">##             amphibian    : 4  </span></span>
<span><span class="co">##             insect       : 8  </span></span>
<span><span class="co">##             mollusc.et.al:10</span></span></code></pre></div>
</div>
</div>
<div id="decision-tree-classifiers" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Decision Tree Classifiers<a class="anchor" aria-label="anchor" href="#decision-tree-classifiers"><i class="fas fa-link"></i></a>
</h2>
<p>We use here the recursive partitioning implementation which follows largely
CART and uses the Gini index to make
splitting decisions and early stopping (also called pre-pruning).</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span></code></pre></div>
<div id="create-tree" class="section level3" number="3.3.1">
<h3>
<span class="header-section-number">3.3.1</span> Create Tree<a class="anchor" aria-label="anchor" href="#create-tree"><i class="fas fa-link"></i></a>
</h3>
<p>We create first a tree with the default settings (see <code><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">? rpart.control</a></code>).</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_default</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="va">tree_default</span></span>
<span><span class="co">## n= 101 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">##       * denotes terminal node</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  1) root 101 60 mammal (0.41 0.2 0.05 0.13 0.04 0.079 0.099)  </span></span>
<span><span class="co">##    2) milk=TRUE 41  0 mammal (1 0 0 0 0 0 0) *</span></span>
<span><span class="co">##    3) milk=FALSE 60 40 bird (0 0.33 0.083 0.22 0.067 0.13 0.17)  </span></span>
<span><span class="co">##      6) feathers=TRUE 20  0 bird (0 1 0 0 0 0 0) *</span></span>
<span><span class="co">##      7) feathers=FALSE 40 27 fish (0 0 0.12 0.33 0.1 0.2 0.25)  </span></span>
<span><span class="co">##       14) fins=TRUE 13  0 fish (0 0 0 1 0 0 0) *</span></span>
<span><span class="co">##       15) fins=FALSE 27 17 mollusc.et.al (0 0 0.19 0 0.15 0.3 0.37)  </span></span>
<span><span class="co">##         30) backbone=TRUE 9  4 reptile (0 0 0.56 0 0.44 0 0) *</span></span>
<span><span class="co">##         31) backbone=FALSE 18  8 mollusc.et.al (0 0 0 0 0 0.44 0.56) *</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>
<code>|&gt;</code> supplies the data for <code>rpart</code>. Since <code>data</code> is not
the first argument of <code>rpart</code>, the syntax <code>data = _</code> is used to specify
where the data in <code>Zoo</code> goes. The call is equivalent to
<code>tree_default &lt;- rpart(type ~ ., data = Zoo)</code>.</li>
<li>The formula models the <code>type</code> variable by all other features represented by
a single period (<code>.</code>).</li>
<li>The class variable needs to be a factor to be recognized as nominal
or rpart will create a regression tree instead of a decision tree.
Use <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> on the column with the class label first, if necessary.</li>
</ul>
<p>We can plot the resulting decision tree.</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_default</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-134-1.png" width="672"></div>
<p><em>Note:</em> <code>extra=2</code> prints for each leaf node the number of correctly
classified objects from data and the total number of objects from the
training data falling into that node (correct/total).</p>
</div>
<div id="make-predictions-for-new-data" class="section level3" number="3.3.2">
<h3>
<span class="header-section-number">3.3.2</span> Make Predictions for New Data<a class="anchor" aria-label="anchor" href="#make-predictions-for-new-data"><i class="fas fa-link"></i></a>
</h3>
<p>I will make up my own animal: A lion with feathered wings.</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_animal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>hair <span class="op">=</span> <span class="cn">TRUE</span>, feathers <span class="op">=</span> <span class="cn">TRUE</span>, eggs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  milk <span class="op">=</span> <span class="cn">TRUE</span>, airborne <span class="op">=</span> <span class="cn">TRUE</span>, aquatic <span class="op">=</span> <span class="cn">FALSE</span>, predator <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  toothed <span class="op">=</span> <span class="cn">TRUE</span>, backbone <span class="op">=</span> <span class="cn">TRUE</span>, breathes <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  venomous <span class="op">=</span> <span class="cn">FALSE</span>, fins <span class="op">=</span> <span class="cn">FALSE</span>, legs <span class="op">=</span> <span class="fl">4</span>, tail <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  domestic <span class="op">=</span> <span class="cn">FALSE</span>, catsize <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>The data types need to match the original data so we
change the columns to be factors like in the training set.</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_animal</span> <span class="op">&lt;-</span> <span class="va">my_animal</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.logical</span><span class="op">)</span>, </span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_animal</span></span>
<span><span class="co">## # A tibble: 1 × 17</span></span>
<span><span class="co">##   hair  feathers eggs  milk  airborne aquatic predator</span></span>
<span><span class="co">##   &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;    &lt;fct&gt;   &lt;fct&gt;   </span></span>
<span><span class="co">## 1 TRUE  TRUE     FALSE TRUE  TRUE     FALSE   TRUE    </span></span>
<span><span class="co">## # ℹ 10 more variables: toothed &lt;fct&gt;, backbone &lt;fct&gt;,</span></span>
<span><span class="co">## #   breathes &lt;fct&gt;, venomous &lt;fct&gt;, fins &lt;fct&gt;, legs &lt;dbl&gt;,</span></span>
<span><span class="co">## #   tail &lt;fct&gt;, domestic &lt;fct&gt;, catsize &lt;fct&gt;, type &lt;fct&gt;</span></span></code></pre></div>
<p>Next, we make a prediction using the default tree</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_default</span> , <span class="va">my_animal</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="co">##      1 </span></span>
<span><span class="co">## mammal </span></span>
<span><span class="co">## 7 Levels: mammal bird reptile fish amphibian ... mollusc.et.al</span></span></code></pre></div>
</div>
<div id="manual-calculation-of-the-resubstitution-error" class="section level3" number="3.3.3">
<h3>
<span class="header-section-number">3.3.3</span> Manual Calculation of the Resubstitution Error<a class="anchor" aria-label="anchor" href="#manual-calculation-of-the-resubstitution-error"><i class="fas fa-link"></i></a>
</h3>
<p>We will calculate error of the model on the training data manually first,
so we see how it is calculated.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_default</span>, <span class="va">Zoo</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##          mammal bird reptile fish amphibian insect</span></span>
<span><span class="co">## aardvark      1    0       0    0         0      0</span></span>
<span><span class="co">## antelope      1    0       0    0         0      0</span></span>
<span><span class="co">## bass          0    0       0    1         0      0</span></span>
<span><span class="co">## bear          1    0       0    0         0      0</span></span>
<span><span class="co">## boar          1    0       0    0         0      0</span></span>
<span><span class="co">## buffalo       1    0       0    0         0      0</span></span>
<span><span class="co">##          mollusc.et.al</span></span>
<span><span class="co">## aardvark             0</span></span>
<span><span class="co">## antelope             0</span></span>
<span><span class="co">## bass                 0</span></span>
<span><span class="co">## bear                 0</span></span>
<span><span class="co">## boar                 0</span></span>
<span><span class="co">## buffalo              0</span></span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_default</span>, <span class="va">Zoo</span>, type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## aardvark antelope     bass     bear     boar  buffalo </span></span>
<span><span class="co">##   mammal   mammal     fish   mammal   mammal   mammal </span></span>
<span><span class="co">## 7 Levels: mammal bird reptile fish amphibian ... mollusc.et.al</span></span></code></pre></div>
<p>We can easily tabulate the true and predicted labels to create a
confusion matrix.</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confusion_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">Zoo</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">confusion_table</span></span>
<span><span class="co">##                pred</span></span>
<span><span class="co">## type            mammal bird reptile fish amphibian insect</span></span>
<span><span class="co">##   mammal            41    0       0    0         0      0</span></span>
<span><span class="co">##   bird               0   20       0    0         0      0</span></span>
<span><span class="co">##   reptile            0    0       5    0         0      0</span></span>
<span><span class="co">##   fish               0    0       0   13         0      0</span></span>
<span><span class="co">##   amphibian          0    0       4    0         0      0</span></span>
<span><span class="co">##   insect             0    0       0    0         0      0</span></span>
<span><span class="co">##   mollusc.et.al      0    0       0    0         0      0</span></span>
<span><span class="co">##                pred</span></span>
<span><span class="co">## type            mollusc.et.al</span></span>
<span><span class="co">##   mammal                    0</span></span>
<span><span class="co">##   bird                      0</span></span>
<span><span class="co">##   reptile                   0</span></span>
<span><span class="co">##   fish                      0</span></span>
<span><span class="co">##   amphibian                 0</span></span>
<span><span class="co">##   insect                    8</span></span>
<span><span class="co">##   mollusc.et.al            10</span></span></code></pre></div>
<p>The counts in the diagonal are correct predictions. Off-diagonal
counts represent errors (i.e., confusions).</p>
<p>We can summarize the confusion matrix using the accuracy measure.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="va">confusion_table</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">correct</span></span>
<span><span class="co">## [1] 89</span></span></code></pre></div>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error</span> <span class="op">&lt;-</span> <span class="va">confusion_table</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">correct</span></span>
<span><span class="va">error</span></span>
<span><span class="co">## [1] 12</span></span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="va">correct</span> <span class="op">/</span> <span class="op">(</span><span class="va">correct</span> <span class="op">+</span> <span class="va">error</span><span class="op">)</span></span>
<span><span class="va">accuracy</span></span>
<span><span class="co">## [1] 0.8812</span></span></code></pre></div>
<p>Here is the accuracy calculation as a simple function.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">truth</span>, <span class="va">prediction</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">truth</span>, <span class="va">prediction</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>, <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.8812</span></span></code></pre></div>
</div>
<div id="confusion-matrix-using-caret" class="section level3" number="3.3.4">
<h3>
<span class="header-section-number">3.3.4</span> Confusion Matrix using Caret<a class="anchor" aria-label="anchor" href="#confusion-matrix-using-caret"><i class="fas fa-link"></i></a>
</h3>
<p>The caret package provides a convenient way to create and
analyze a confusion table including many useful statistics.</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pred</span>, </span>
<span>                reference <span class="op">=</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mammal bird reptile fish amphibian insect</span></span>
<span><span class="co">##   mammal            41    0       0    0         0      0</span></span>
<span><span class="co">##   bird               0   20       0    0         0      0</span></span>
<span><span class="co">##   reptile            0    0       5    0         4      0</span></span>
<span><span class="co">##   fish               0    0       0   13         0      0</span></span>
<span><span class="co">##   amphibian          0    0       0    0         0      0</span></span>
<span><span class="co">##   insect             0    0       0    0         0      0</span></span>
<span><span class="co">##   mollusc.et.al      0    0       0    0         0      8</span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mollusc.et.al</span></span>
<span><span class="co">##   mammal                    0</span></span>
<span><span class="co">##   bird                      0</span></span>
<span><span class="co">##   reptile                   0</span></span>
<span><span class="co">##   fish                      0</span></span>
<span><span class="co">##   amphibian                 0</span></span>
<span><span class="co">##   insect                    0</span></span>
<span><span class="co">##   mollusc.et.al            10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.881         </span></span>
<span><span class="co">##                  95% CI : (0.802, 0.937)</span></span>
<span><span class="co">##     No Information Rate : 0.406         </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : &lt;2e-16        </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0.843         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: mammal Class: bird</span></span>
<span><span class="co">## Sensitivity                  1.000       1.000</span></span>
<span><span class="co">## Specificity                  1.000       1.000</span></span>
<span><span class="co">## Pos Pred Value               1.000       1.000</span></span>
<span><span class="co">## Neg Pred Value               1.000       1.000</span></span>
<span><span class="co">## Prevalence                   0.406       0.198</span></span>
<span><span class="co">## Detection Rate               0.406       0.198</span></span>
<span><span class="co">## Detection Prevalence         0.406       0.198</span></span>
<span><span class="co">## Balanced Accuracy            1.000       1.000</span></span>
<span><span class="co">##                      Class: reptile Class: fish</span></span>
<span><span class="co">## Sensitivity                  1.0000       1.000</span></span>
<span><span class="co">## Specificity                  0.9583       1.000</span></span>
<span><span class="co">## Pos Pred Value               0.5556       1.000</span></span>
<span><span class="co">## Neg Pred Value               1.0000       1.000</span></span>
<span><span class="co">## Prevalence                   0.0495       0.129</span></span>
<span><span class="co">## Detection Rate               0.0495       0.129</span></span>
<span><span class="co">## Detection Prevalence         0.0891       0.129</span></span>
<span><span class="co">## Balanced Accuracy            0.9792       1.000</span></span>
<span><span class="co">##                      Class: amphibian Class: insect</span></span>
<span><span class="co">## Sensitivity                    0.0000        0.0000</span></span>
<span><span class="co">## Specificity                    1.0000        1.0000</span></span>
<span><span class="co">## Pos Pred Value                    NaN           NaN</span></span>
<span><span class="co">## Neg Pred Value                 0.9604        0.9208</span></span>
<span><span class="co">## Prevalence                     0.0396        0.0792</span></span>
<span><span class="co">## Detection Rate                 0.0000        0.0000</span></span>
<span><span class="co">## Detection Prevalence           0.0000        0.0000</span></span>
<span><span class="co">## Balanced Accuracy              0.5000        0.5000</span></span>
<span><span class="co">##                      Class: mollusc.et.al</span></span>
<span><span class="co">## Sensitivity                         1.000</span></span>
<span><span class="co">## Specificity                         0.912</span></span>
<span><span class="co">## Pos Pred Value                      0.556</span></span>
<span><span class="co">## Neg Pred Value                      1.000</span></span>
<span><span class="co">## Prevalence                          0.099</span></span>
<span><span class="co">## Detection Rate                      0.099</span></span>
<span><span class="co">## Detection Prevalence                0.178</span></span>
<span><span class="co">## Balanced Accuracy                   0.956</span></span></code></pre></div>
<p><strong>Note:</strong> Calculating accuracy on the training data is not a good idea.
Keep on reading!</p>
</div>
</div>
<div id="model-overfitting" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Model Overfitting<a class="anchor" aria-label="anchor" href="#model-overfitting"><i class="fas fa-link"></i></a>
</h2>
<p>We are tempted to create the largest possible tree
to get the most accurate model. This can be achieved by
changing the algorithms hyperparameter (parameters that
change how the algorithm works). We
set the complexity parameter <code>cp</code> to 0 (split
even if it does not improve the tree) and we set the minimum number of
observations in a node needed to split to the smallest value of 2 (see:
<code><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">?rpart.control</a></code>). <em>Note:</em> This is not a good idea!
As we will see later, full trees overfit the training data!</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_full</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="va">_</span>, </span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">2</span>, cp <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_full</span>, extra <span class="op">=</span> <span class="fl">2</span>, </span>
<span>           roundint<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>           box.palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Gy"</span>, <span class="st">"Gn"</span>, <span class="st">"Bu"</span>, <span class="st">"Bn"</span>, </span>
<span>                              <span class="st">"Or"</span>, <span class="st">"Rd"</span>, <span class="st">"Pu"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-143-1.png" width="672"></div>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_full</span></span>
<span><span class="co">## n= 101 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">##       * denotes terminal node</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   1) root 101 60 mammal (0.41 0.2 0.05 0.13 0.04 0.079 0.099)  </span></span>
<span><span class="co">##     2) milk=TRUE 41  0 mammal (1 0 0 0 0 0 0) *</span></span>
<span><span class="co">##     3) milk=FALSE 60 40 bird (0 0.33 0.083 0.22 0.067 0.13 0.17)  </span></span>
<span><span class="co">##       6) feathers=TRUE 20  0 bird (0 1 0 0 0 0 0) *</span></span>
<span><span class="co">##       7) feathers=FALSE 40 27 fish (0 0 0.12 0.33 0.1 0.2 0.25)  </span></span>
<span><span class="co">##        14) fins=TRUE 13  0 fish (0 0 0 1 0 0 0) *</span></span>
<span><span class="co">##        15) fins=FALSE 27 17 mollusc.et.al (0 0 0.19 0 0.15 0.3 0.37)  </span></span>
<span><span class="co">##          30) backbone=TRUE 9  4 reptile (0 0 0.56 0 0.44 0 0)  </span></span>
<span><span class="co">##            60) aquatic=FALSE 4  0 reptile (0 0 1 0 0 0 0) *</span></span>
<span><span class="co">##            61) aquatic=TRUE 5  1 amphibian (0 0 0.2 0 0.8 0 0)  </span></span>
<span><span class="co">##             122) eggs=FALSE 1  0 reptile (0 0 1 0 0 0 0) *</span></span>
<span><span class="co">##             123) eggs=TRUE 4  0 amphibian (0 0 0 0 1 0 0) *</span></span>
<span><span class="co">##          31) backbone=FALSE 18  8 mollusc.et.al (0 0 0 0 0 0.44 0.56)  </span></span>
<span><span class="co">##            62) airborne=TRUE 6  0 insect (0 0 0 0 0 1 0) *</span></span>
<span><span class="co">##            63) airborne=FALSE 12  2 mollusc.et.al (0 0 0 0 0 0.17 0.83)  </span></span>
<span><span class="co">##             126) predator=FALSE 4  2 insect (0 0 0 0 0 0.5 0.5)  </span></span>
<span><span class="co">##               252) legs&gt;=3 2  0 insect (0 0 0 0 0 1 0) *</span></span>
<span><span class="co">##               253) legs&lt; 3 2  0 mollusc.et.al (0 0 0 0 0 0 1) *</span></span>
<span><span class="co">##             127) predator=TRUE 8  0 mollusc.et.al (0 0 0 0 0 0 1) *</span></span></code></pre></div>
<p>Error on the training set of the full tree</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_full</span>, <span class="va">Zoo</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>, <span class="va">pred_full</span><span class="op">)</span></span>
<span><span class="co">## [1] 1</span></span></code></pre></div>
<p>We see that the error is smaller then for the pruned tree. This,
however, does not mean that the model is better. It actually is overfitting
the training data (it just memorizes it) and has worse generalization
performance on new data. This effect
is called overfitting the training data and needs to be avoided.</p>
</div>
<div id="model-selection" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Model Selection<a class="anchor" aria-label="anchor" href="#model-selection"><i class="fas fa-link"></i></a>
</h2>
<p>We often can create many different models for a classification problem.
Above, we have created a decision tree using the default settings and also
a full tree. The question is: Which one should we use. This problem is called
model selection.</p>
<p>In order to select the model we need to split the training data into a
<strong>validation set</strong> and the training set that is actually used to train model.
The error rate on the validation set can then be used to choose
between several models.</p>
<p>Caret has model selection build into the <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> function. We will select
between the default complexity <code>cp = 0.01</code> and a full tree <code>cp = 0</code> (see <code>tuneGrid</code>).
<code>trControl</code> specified how the validation set is obtained. <code>LGOCV</code>
picks randomly the proportion <code>p</code> of data to train and uses the rest as
the validation set. To get a better estimate of the
error, this process is repeated <code>number</code> times and the errors are averaged.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>    data <span class="op">=</span> <span class="va">_</span> ,</span>
<span>    method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="co"># we have little data</span></span>
<span>    tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"LGOCV"</span>, </span>
<span>                             p <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>                             number <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    tuneLength <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 101 samples</span></span>
<span><span class="co">##  16 predictor</span></span>
<span><span class="co">##   7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Repeated Train/Test Splits Estimated (10 reps, 80%) </span></span>
<span><span class="co">## Summary of sample sizes: 83, 83, 83, 83, 83, 83, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   cp    Accuracy  Kappa </span></span>
<span><span class="co">##   0.00  0.9444    0.9232</span></span>
<span><span class="co">##   0.01  0.9389    0.9155</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using</span></span>
<span><span class="co">##  the largest value.</span></span>
<span><span class="co">## The final value used for the model was cp = 0.</span></span></code></pre></div>
<p>We see that in this case, the full tree model performs slightly better.
This is a result of the fact that we only have a very small dataset.</p>
</div>
<div id="model-evaluation" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Model Evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"><i class="fas fa-link"></i></a>
</h2>
<p>Models should be evaluated on a test set that has no overlap with the
training set. We typically split the data using random sampling.
To get reproducible results,
we set random number generator seed.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<div id="holdout-method" class="section level3" number="3.6.1">
<h3>
<span class="header-section-number">3.6.1</span> Holdout Method<a class="anchor" aria-label="anchor" href="#holdout-method"><i class="fas fa-link"></i></a>
</h3>
<p>Test data is not used in the model building process and set aside purely
for testing the model. Here, we partition data the 80% training and 20%
testing.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inTrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Zoo</span><span class="op">$</span><span class="va">type</span>, p <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">Zoo_train</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">inTrain</span><span class="op">)</span></span>
<span><span class="va">Zoo_test</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="va">inTrain</span><span class="op">)</span></span></code></pre></div>
<p>Now we can train on the test set and get the generalization error on the
test set.</p>
</div>
<div id="cross-validation" class="section level3" number="3.6.2">
<h3>
<span class="header-section-number">3.6.2</span> Cross-Validation<a class="anchor" aria-label="anchor" href="#cross-validation"><i class="fas fa-link"></i></a>
</h3>
<p>k-fold cross-validation splits the data randomly into <span class="math inline">\(k\)</span> folds. It then
holds one fold back for testing and trains on the other <span class="math inline">\(k-1\)</span> folds. This is
done with each fold and the resulting statistic (e.g., accuracy) is averaged.
This method uses the data more efficiently then the holdout method.</p>
<p>Cross validation can be directly used in <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> using
<code>trControl = trainControl(method = "cv", number = 10)</code>.
If no model selection is necessary then this will give the
generalization error.</p>
<p>Cross-validation runs are independent and can be done faster in
parallel. To enable multi-core support, <code>caret</code> uses the package
<code>foreach</code> and you need to load a <code>do</code> backend. For Linux, you can use
<code>doMC</code> with 4 cores. Windows needs different backend like <code>doParallel</code>
(see <code>caret</code> cheat sheet above).</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Linux backend</span></span>
<span><span class="co"># library(doMC)</span></span>
<span><span class="co"># registerDoMC(cores = 4)</span></span>
<span><span class="co"># getDoParWorkers()</span></span>
<span></span>
<span><span class="co">## Windows backend</span></span>
<span><span class="co"># library(doParallel)</span></span>
<span><span class="co"># cl &lt;- makeCluster(4, type="SOCK")</span></span>
<span><span class="co"># registerDoParallel(cl)</span></span></code></pre></div>
</div>
</div>
<div id="hyperparameter-tuning" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Hyperparameter Tuning<a class="anchor" aria-label="anchor" href="#hyperparameter-tuning"><i class="fas fa-link"></i></a>
</h2>
<p>Hyperparameters are parameters that change how a
training algorithm works. An example is the complexity parameter
<code>cp</code> for rpart decision trees. Tuning the hyperparameter means that
we want to perform model selection to pick the best setting.</p>
<p>We typically use the holdout method to create a test set and then use
cross validation using the training data for model selection. Let us use
80% for training and hold out 20% for testing.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inTrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Zoo</span><span class="op">$</span><span class="va">type</span>, p <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">Zoo_train</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">inTrain</span><span class="op">)</span></span>
<span><span class="va">Zoo_test</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="va">inTrain</span><span class="op">)</span></span></code></pre></div>
<p>The package <code>caret</code> combines training and validation for hyperparameter
tuning into the <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> function. It internally splits the
data into training and validation sets and thus will provide you with
error estimates for different hyperparameter settings. <code>trainControl</code> is
used to choose how testing is performed.</p>
<p>For rpart, train tries to tune the <code>cp</code> parameter (tree complexity)
using accuracy to chose the best model. I set <code>minsplit</code> to 2 since we
have not much data. <strong>Note:</strong> Parameters used for tuning (in this case
<code>cp</code>) need to be set using a data.frame in the argument <code>tuneGrid</code>!
Setting it in control will be ignored.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>    data <span class="op">=</span> <span class="va">_</span> ,</span>
<span>    method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="co"># we have little data</span></span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    tuneLength <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 73, 77, 75, 73, 75, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   cp    Accuracy  Kappa </span></span>
<span><span class="co">##   0.00  0.9289    0.9058</span></span>
<span><span class="co">##   0.08  0.8603    0.8179</span></span>
<span><span class="co">##   0.16  0.7296    0.6422</span></span>
<span><span class="co">##   0.22  0.6644    0.5448</span></span>
<span><span class="co">##   0.32  0.4383    0.1136</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using</span></span>
<span><span class="co">##  the largest value.</span></span>
<span><span class="co">## The final value used for the model was cp = 0.</span></span></code></pre></div>
<p><strong>Note:</strong> Train has built 10 trees using the training folds for each
value of <code>cp</code> and the reported values for accuracy and Kappa are the
averages on the validation folds.</p>
<p>A model using the best tuning parameters and using all the data supplied
to <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> is available as <code>fit$finalModel</code>.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  box.palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Gy"</span>, <span class="st">"Gn"</span>, <span class="st">"Bu"</span>, <span class="st">"Bn"</span>, <span class="st">"Or"</span>, <span class="st">"Rd"</span>, <span class="st">"Pu"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-151-1.png" width="672"></div>
<p>caret also computes variable importance. By default it uses competing
splits (splits which would be runners up, but do not get chosen by the
tree) for rpart models (see <code><a href="https://rdrr.io/pkg/caret/man/varImp.html">? varImp</a></code>). Toothed is the runner up for
many splits, but it never gets chosen!</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">## rpart variable importance</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##               Overall</span></span>
<span><span class="co">## toothedFALSE    100.0</span></span>
<span><span class="co">## feathersFALSE    79.5</span></span>
<span><span class="co">## eggsFALSE        67.7</span></span>
<span><span class="co">## milkFALSE        63.3</span></span>
<span><span class="co">## backboneFALSE    57.3</span></span>
<span><span class="co">## finsFALSE        53.5</span></span>
<span><span class="co">## hairFALSE        52.1</span></span>
<span><span class="co">## breathesFALSE    48.9</span></span>
<span><span class="co">## legs             41.4</span></span>
<span><span class="co">## tailFALSE        29.0</span></span>
<span><span class="co">## aquaticFALSE     27.5</span></span>
<span><span class="co">## airborneFALSE    26.5</span></span>
<span><span class="co">## predatorFALSE    10.6</span></span>
<span><span class="co">## venomousFALSE     1.8</span></span>
<span><span class="co">## catsizeFALSE      0.0</span></span>
<span><span class="co">## domesticFALSE     0.0</span></span></code></pre></div>
<p>Here is the variable importance without competing splits.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">fit</span>, compete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">imp</span></span>
<span><span class="co">## rpart variable importance</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##               Overall</span></span>
<span><span class="co">## milkFALSE      100.00</span></span>
<span><span class="co">## feathersFALSE   55.69</span></span>
<span><span class="co">## finsFALSE       39.45</span></span>
<span><span class="co">## aquaticFALSE    28.11</span></span>
<span><span class="co">## backboneFALSE   21.76</span></span>
<span><span class="co">## eggsFALSE       12.32</span></span>
<span><span class="co">## legs             7.28</span></span>
<span><span class="co">## tailFALSE        0.00</span></span>
<span><span class="co">## domesticFALSE    0.00</span></span>
<span><span class="co">## airborneFALSE    0.00</span></span>
<span><span class="co">## catsizeFALSE     0.00</span></span>
<span><span class="co">## toothedFALSE     0.00</span></span>
<span><span class="co">## venomousFALSE    0.00</span></span>
<span><span class="co">## hairFALSE        0.00</span></span>
<span><span class="co">## breathesFALSE    0.00</span></span>
<span><span class="co">## predatorFALSE    0.00</span></span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-153-1.png" width="672"></div>
<p><strong>Note:</strong> Not all models provide a variable importance function. In this
case caret might calculate the variable importance by itself and ignore
the model (see <code><a href="https://rdrr.io/pkg/caret/man/varImp.html">? varImp</a></code>)!</p>
<p>Now, we can estimate the generalization error of the best model on the
held out test data.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">Zoo_test</span><span class="op">)</span></span>
<span><span class="va">pred</span></span>
<span><span class="co">##  [1] mammal        bird          mollusc.et.al bird         </span></span>
<span><span class="co">##  [5] mammal        mammal        insect        bird         </span></span>
<span><span class="co">##  [9] mammal        mammal        mammal        mammal       </span></span>
<span><span class="co">## [13] bird          fish          fish          reptile      </span></span>
<span><span class="co">## [17] mammal        mollusc.et.al</span></span>
<span><span class="co">## 7 Levels: mammal bird reptile fish amphibian ... mollusc.et.al</span></span></code></pre></div>
<p>Caret’s <code><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix()</a></code> function calculates accuracy, confidence
intervals, kappa and many more evaluation metrics. You need to use
separate test data to create a confusion matrix based on the
generalization error.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pred</span>, </span>
<span>                ref <span class="op">=</span> <span class="va">Zoo_test</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mammal bird reptile fish amphibian insect</span></span>
<span><span class="co">##   mammal             8    0       0    0         0      0</span></span>
<span><span class="co">##   bird               0    4       0    0         0      0</span></span>
<span><span class="co">##   reptile            0    0       1    0         0      0</span></span>
<span><span class="co">##   fish               0    0       0    2         0      0</span></span>
<span><span class="co">##   amphibian          0    0       0    0         0      0</span></span>
<span><span class="co">##   insect             0    0       0    0         0      1</span></span>
<span><span class="co">##   mollusc.et.al      0    0       0    0         0      0</span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mollusc.et.al</span></span>
<span><span class="co">##   mammal                    0</span></span>
<span><span class="co">##   bird                      0</span></span>
<span><span class="co">##   reptile                   0</span></span>
<span><span class="co">##   fish                      0</span></span>
<span><span class="co">##   amphibian                 0</span></span>
<span><span class="co">##   insect                    0</span></span>
<span><span class="co">##   mollusc.et.al             2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##                Accuracy : 1         </span></span>
<span><span class="co">##                  95% CI : (0.815, 1)</span></span>
<span><span class="co">##     No Information Rate : 0.444     </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 4.58e-07  </span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##                   Kappa : 1         </span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: mammal Class: bird</span></span>
<span><span class="co">## Sensitivity                  1.000       1.000</span></span>
<span><span class="co">## Specificity                  1.000       1.000</span></span>
<span><span class="co">## Pos Pred Value               1.000       1.000</span></span>
<span><span class="co">## Neg Pred Value               1.000       1.000</span></span>
<span><span class="co">## Prevalence                   0.444       0.222</span></span>
<span><span class="co">## Detection Rate               0.444       0.222</span></span>
<span><span class="co">## Detection Prevalence         0.444       0.222</span></span>
<span><span class="co">## Balanced Accuracy            1.000       1.000</span></span>
<span><span class="co">##                      Class: reptile Class: fish</span></span>
<span><span class="co">## Sensitivity                  1.0000       1.000</span></span>
<span><span class="co">## Specificity                  1.0000       1.000</span></span>
<span><span class="co">## Pos Pred Value               1.0000       1.000</span></span>
<span><span class="co">## Neg Pred Value               1.0000       1.000</span></span>
<span><span class="co">## Prevalence                   0.0556       0.111</span></span>
<span><span class="co">## Detection Rate               0.0556       0.111</span></span>
<span><span class="co">## Detection Prevalence         0.0556       0.111</span></span>
<span><span class="co">## Balanced Accuracy            1.0000       1.000</span></span>
<span><span class="co">##                      Class: amphibian Class: insect</span></span>
<span><span class="co">## Sensitivity                        NA        1.0000</span></span>
<span><span class="co">## Specificity                         1        1.0000</span></span>
<span><span class="co">## Pos Pred Value                     NA        1.0000</span></span>
<span><span class="co">## Neg Pred Value                     NA        1.0000</span></span>
<span><span class="co">## Prevalence                          0        0.0556</span></span>
<span><span class="co">## Detection Rate                      0        0.0556</span></span>
<span><span class="co">## Detection Prevalence                0        0.0556</span></span>
<span><span class="co">## Balanced Accuracy                  NA        1.0000</span></span>
<span><span class="co">##                      Class: mollusc.et.al</span></span>
<span><span class="co">## Sensitivity                         1.000</span></span>
<span><span class="co">## Specificity                         1.000</span></span>
<span><span class="co">## Pos Pred Value                      1.000</span></span>
<span><span class="co">## Neg Pred Value                      1.000</span></span>
<span><span class="co">## Prevalence                          0.111</span></span>
<span><span class="co">## Detection Rate                      0.111</span></span>
<span><span class="co">## Detection Prevalence                0.111</span></span>
<span><span class="co">## Balanced Accuracy                   1.000</span></span></code></pre></div>
<p><strong>Some notes</strong></p>
<ul>
<li>Many classification algorithms and <code>train</code> in caret do not deal well
with missing values. If your classification model can deal with
missing values (e.g., <code>rpart</code>) then use <code>na.action = na.pass</code> when
you call <code>train</code> and <code>predict</code>. Otherwise, you need to remove
observations with missing values with <code>na.omit</code> or use imputation to
replace the missing values before you train the model. Make sure
that you still have enough observations left.</li>
<li>Make sure that nominal variables (this includes logical variables)
are coded as factors.</li>
<li>The class variable for train in caret cannot have level names that
are keywords in R (e.g., <code>TRUE</code> and <code>FALSE</code>). Rename them to, for
example, “yes” and “no.”</li>
<li>Make sure that nominal variables (factors) have examples for all
possible values. Some methods might have problems with variable
values without examples. You can drop empty levels using
<code>droplevels</code> or <code>factor</code>.</li>
<li>Sampling in train might create a sample that does not contain
examples for all values in a nominal (factor) variable. You will get
an error message. This most likely happens for variables which have
one very rare value. You may have to remove the variable.</li>
</ul>
</div>
<div id="pitfalls-of-model-selection-and-evaluation" class="section level2" number="3.8">
<h2>
<span class="header-section-number">3.8</span> Pitfalls of Model Selection and Evaluation<a class="anchor" aria-label="anchor" href="#pitfalls-of-model-selection-and-evaluation"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The training data and the test sets cannot overlap or we will not
evaluate the generalization performance. The training set can be come
contaminated by things like preprocessing the all the data together.</li>
<li>Do not measure the error on the training set or
use the validation error as a generalization error estimate.
Always use the generalization error on a test set!</li>
</ul>
</div>
<div id="model-comparison" class="section level2" number="3.9">
<h2>
<span class="header-section-number">3.9</span> Model Comparison<a class="anchor" aria-label="anchor" href="#model-comparison"><i class="fas fa-link"></i></a>
</h2>
<p>We will compare decision trees with a k-nearest neighbors (kNN)
classifier. We will create fixed sampling scheme (10-folds) so we
compare the different models using exactly the same folds. It is
specified as <code>trControl</code> during training.</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createFolds</a></span><span class="op">(</span><span class="va">Zoo_train</span><span class="op">$</span><span class="va">type</span>, </span>
<span>                           k <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                           returnTrain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Build models</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rpartFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        tuneLength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, </span>
<span>                                 index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> for kNN we ask <code>train</code> to scale the data using
<code>preProcess = "scale"</code>. Logicals will be used as 0-1 variables in
Euclidean distance calculation.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knnFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>        preProcess <span class="op">=</span> <span class="st">"scale"</span>,</span>
<span>          tuneLength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, </span>
<span>                                   index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Compare accuracy over all folds.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        CART <span class="op">=</span> <span class="va">rpartFit</span>,</span>
<span>        kNearestNeighbors <span class="op">=</span> <span class="va">knnFit</span></span>
<span>        <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">resamps</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## summary.resamples(object = resamps)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Models: CART, kNearestNeighbors </span></span>
<span><span class="co">## Number of resamples: 10 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy </span></span>
<span><span class="co">##                     Min. 1st Qu. Median   Mean 3rd Qu.</span></span>
<span><span class="co">## CART              0.6667   0.750 0.7778 0.7890  0.8512</span></span>
<span><span class="co">## kNearestNeighbors 0.7500   0.875 0.8990 0.9076  1.0000</span></span>
<span><span class="co">##                    Max. NA's</span></span>
<span><span class="co">## CART              0.875    0</span></span>
<span><span class="co">## kNearestNeighbors 1.000    0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Kappa </span></span>
<span><span class="co">##                     Min. 1st Qu. Median   Mean 3rd Qu.</span></span>
<span><span class="co">## CART              0.5909  0.6800 0.7188 0.7227  0.7706</span></span>
<span><span class="co">## kNearestNeighbors 0.6800  0.8315 0.8713 0.8816  1.0000</span></span>
<span><span class="co">##                     Max. NA's</span></span>
<span><span class="co">## CART              0.8298    0</span></span>
<span><span class="co">## kNearestNeighbors 1.0000    0</span></span></code></pre></div>
<p><code>caret</code> provides some visualizations. For
example, a boxplot to compare the accuracy and kappa distribution (over
the 10 folds).</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html">bwplot</a></span><span class="op">(</span><span class="va">resamps</span>, layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-160-1.png" width="672"></div>
<p>We see that kNN is performing consistently better on the folds than CART
(except for some outlier folds).</p>
<p>Find out if one models is statistically better than the other (is the
difference in accuracy is not zero).</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">difs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">resamps</span><span class="op">)</span></span>
<span><span class="va">difs</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## diff.resamples(x = resamps)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Models: CART, kNearestNeighbors </span></span>
<span><span class="co">## Metrics: Accuracy, Kappa </span></span>
<span><span class="co">## Number of differences: 1 </span></span>
<span><span class="co">## p-value adjustment: bonferroni</span></span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">difs</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## summary.diff.resamples(object = difs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## p-value adjustment: bonferroni </span></span>
<span><span class="co">## Upper diagonal: estimates of the difference</span></span>
<span><span class="co">## Lower diagonal: p-value for H0: difference = 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy </span></span>
<span><span class="co">##                   CART    kNearestNeighbors</span></span>
<span><span class="co">## CART                      -0.119           </span></span>
<span><span class="co">## kNearestNeighbors 0.00768                  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Kappa </span></span>
<span><span class="co">##                   CART    kNearestNeighbors</span></span>
<span><span class="co">## CART                      -0.159           </span></span>
<span><span class="co">## kNearestNeighbors 0.00538</span></span></code></pre></div>
<p>p-values tells you the probability of seeing an even more extreme value
(difference between accuracy) given that the null hypothesis (difference
= 0) is true. For a better classifier, the p-value should be less than
.05 or 0.01. <code>diff</code> automatically applies Bonferroni correction for
multiple comparisons. In this case, kNN seems better but the classifiers
do not perform statistically differently.</p>
</div>
<div id="feature-selection" class="section level2" number="3.10">
<h2>
<span class="header-section-number">3.10</span> Feature Selection*<a class="anchor" aria-label="anchor" href="#feature-selection"><i class="fas fa-link"></i></a>
</h2>
<p>Decision trees implicitly select features for splitting, but we can also
select features before we apply any learning algorithm.
Since different features lead to different models, choosing
the best set of features is also a type of
model selection.</p>
<p>Many feature selection methods are implemented in the FSelector package.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/larskotthoff/fselector">FSelector</a></span><span class="op">)</span></span></code></pre></div>
<div id="univariate-feature-importance-score" class="section level3" number="3.10.1">
<h3>
<span class="header-section-number">3.10.1</span> Univariate Feature Importance Score<a class="anchor" aria-label="anchor" href="#univariate-feature-importance-score"><i class="fas fa-link"></i></a>
</h3>
<p>These scores measure how related each feature is to the class variable.
For discrete features (as in our case), the chi-square statistic can be
used to derive a score.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/chi.squared.html">chi.squared</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">attr_importance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights</span></span>
<span><span class="co">## # A tibble: 16 × 2</span></span>
<span><span class="co">##    feature  attr_importance</span></span>
<span><span class="co">##    &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">##  1 feathers           1    </span></span>
<span><span class="co">##  2 milk               1    </span></span>
<span><span class="co">##  3 backbone           1    </span></span>
<span><span class="co">##  4 toothed            0.981</span></span>
<span><span class="co">##  5 eggs               0.959</span></span>
<span><span class="co">##  6 breathes           0.917</span></span>
<span><span class="co">##  7 hair               0.906</span></span>
<span><span class="co">##  8 fins               0.845</span></span>
<span><span class="co">##  9 legs               0.834</span></span>
<span><span class="co">## 10 airborne           0.818</span></span>
<span><span class="co">## 11 tail               0.779</span></span>
<span><span class="co">## 12 aquatic            0.725</span></span>
<span><span class="co">## 13 catsize            0.602</span></span>
<span><span class="co">## 14 venomous           0.520</span></span>
<span><span class="co">## 15 predator           0.374</span></span>
<span><span class="co">## 16 domestic           0.256</span></span></code></pre></div>
<p>We can plot the importance in descending order (using <code>reorder</code> to order factor
levels used by <code>ggplot</code>).</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">weights</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">attr_importance</span>, </span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">attr_importance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Importance score"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Feature"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-164-1.png" width="672"></div>
<p>Picking the best features is called the feature ranking approach.
Here we pick the 5 highest-ranked features.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/cutoff.html">cutoff.k</a></span><span class="op">(</span><span class="va">weights</span> <span class="op">|&gt;</span> </span>
<span>                   <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"feature"</span><span class="op">)</span>, </span>
<span>                   <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">subset</span></span>
<span><span class="co">## [1] "feathers" "milk"     "backbone" "toothed"  "eggs"</span></span></code></pre></div>
<p>Use only the selected features to build a model (<code>Fselector</code> provides
<code>as.simple.formula</code>).</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/as.simple.formula.html">as.simple.formula</a></span><span class="op">(</span><span class="va">subset</span>, <span class="st">"type"</span><span class="op">)</span></span>
<span><span class="va">f</span></span>
<span><span class="co">## type ~ feathers + milk + backbone + toothed + eggs</span></span>
<span><span class="co">## &lt;environment: 0x5efc043b03e0&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">m</span>, extra <span class="op">=</span> <span class="fl">2</span>, roundint <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-166-1.png" width="672"></div>
<p>There are many alternative ways to calculate univariate importance
scores (see package FSelector). Some of them (also) work for continuous
features. One example is the information gain ratio based on entropy as
used in decision tree induction.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/information.gain.html">gain.ratio</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"feature"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">attr_importance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 16 × 2</span></span>
<span><span class="co">##    feature  attr_importance</span></span>
<span><span class="co">##    &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">##  1 milk               1    </span></span>
<span><span class="co">##  2 backbone           1    </span></span>
<span><span class="co">##  3 feathers           1    </span></span>
<span><span class="co">##  4 toothed            0.959</span></span>
<span><span class="co">##  5 eggs               0.907</span></span>
<span><span class="co">##  6 breathes           0.845</span></span>
<span><span class="co">##  7 hair               0.781</span></span>
<span><span class="co">##  8 fins               0.689</span></span>
<span><span class="co">##  9 legs               0.689</span></span>
<span><span class="co">## 10 airborne           0.633</span></span>
<span><span class="co">## 11 tail               0.573</span></span>
<span><span class="co">## 12 aquatic            0.474</span></span>
<span><span class="co">## 13 venomous           0.429</span></span>
<span><span class="co">## 14 catsize            0.310</span></span>
<span><span class="co">## 15 domestic           0.115</span></span>
<span><span class="co">## 16 predator           0.110</span></span></code></pre></div>
</div>
<div id="feature-subset-selection-1" class="section level3" number="3.10.2">
<h3>
<span class="header-section-number">3.10.2</span> Feature Subset Selection<a class="anchor" aria-label="anchor" href="#feature-subset-selection-1"><i class="fas fa-link"></i></a>
</h3>
<p>Often, features are related and calculating importance for each feature
independently is not optimal. We can use greedy search heuristics. For
example <code>cfs</code> uses correlation/entropy with best first search.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/cfs.html">cfs</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="co">##  [1] "hair"     "feathers" "eggs"     "milk"     "toothed" </span></span>
<span><span class="co">##  [6] "backbone" "breathes" "fins"     "legs"     "tail"</span></span></code></pre></div>
<p>Black-box feature selection uses an evaluator function (the black box)
to calculate a score to be maximized.
This is typically the best method, since it can use the actual model
for selection.
First, we define an evaluation
function that builds a model given a subset of features and calculates a
quality score. We use here the average for 5 bootstrap samples
(<code>method = "cv"</code> can also be used instead), no tuning (to be faster),
and the average accuracy as the score.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evaluator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subset</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/FSelector/man/as.simple.formula.html">as.simple.formula</a></span><span class="op">(</span><span class="va">subset</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>          data <span class="op">=</span> <span class="va">_</span>,</span>
<span>          method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>          trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"boot"</span>, number <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>          tuneLength <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Accuracy</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Trying features:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">subset</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Accuracy:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  <span class="va">m</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Start with all features (but not the class variable <code>type</code>)</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span></span></code></pre></div>
<p>There are several (greedy) search strategies available. These run for a
while so they commented out below. Remove the comment for one at a time
to try these types of feature selection.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subset &lt;- backward.search(features, evaluator)</span></span>
<span><span class="co">#subset &lt;- forward.search(features, evaluator)</span></span>
<span><span class="co">#subset &lt;- best.first.search(features, evaluator)</span></span>
<span><span class="co">#subset &lt;- hill.climbing.search(features, evaluator)</span></span>
<span><span class="co">#subset</span></span></code></pre></div>
</div>
<div id="using-dummy-variables-for-factors" class="section level3" number="3.10.3">
<h3>
<span class="header-section-number">3.10.3</span> Using Dummy Variables for Factors<a class="anchor" aria-label="anchor" href="#using-dummy-variables-for-factors"><i class="fas fa-link"></i></a>
</h3>
<p>Nominal features (factors) are often encoded as a series of 0-1 dummy
variables. For example, let us try to predict if an animal is a predator
given the type. First we use the original encoding of type as a factor
with several values.</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_predator</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">predator</span> <span class="op">~</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_predator</span>, extra <span class="op">=</span> <span class="fl">2</span>, roundint <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-172-1.png" width="672"></div>
<p><strong>Note:</strong> Some splits use multiple values. Building the tree will become
extremely slow if a factor has many levels (different values) since the
tree has to check all possible splits into two subsets. This situation
should be avoided.</p>
<p>Convert type into a set of 0-1 dummy variables using <code>class2ind</code>. See
also <code><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">? dummyVars</a></code> in package <code>caret</code>.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Zoo_train_dummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">class2ind</a></span><span class="op">(</span><span class="va">Zoo_train</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>predator <span class="op">=</span> <span class="va">Zoo_train</span><span class="op">$</span><span class="va">predator</span><span class="op">)</span></span>
<span><span class="va">Zoo_train_dummy</span></span>
<span><span class="co">## # A tibble: 83 × 8</span></span>
<span><span class="co">##    mammal bird  reptile fish  amphibian insect mollusc.et.al</span></span>
<span><span class="co">##    &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;  &lt;fct&gt;        </span></span>
<span><span class="co">##  1 1      0     0       0     0         0      0            </span></span>
<span><span class="co">##  2 0      0     0       1     0         0      0            </span></span>
<span><span class="co">##  3 1      0     0       0     0         0      0            </span></span>
<span><span class="co">##  4 1      0     0       0     0         0      0            </span></span>
<span><span class="co">##  5 1      0     0       0     0         0      0            </span></span>
<span><span class="co">##  6 1      0     0       0     0         0      0            </span></span>
<span><span class="co">##  7 0      0     0       1     0         0      0            </span></span>
<span><span class="co">##  8 0      0     0       1     0         0      0            </span></span>
<span><span class="co">##  9 1      0     0       0     0         0      0            </span></span>
<span><span class="co">## 10 1      0     0       0     0         0      0            </span></span>
<span><span class="co">## # ℹ 73 more rows</span></span>
<span><span class="co">## # ℹ 1 more variable: predator &lt;fct&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_predator</span> <span class="op">&lt;-</span> <span class="va">Zoo_train_dummy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">predator</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">2</span>, cp <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_predator</span>, roundint <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-173-1.png" width="672"></div>
<p>Using <code>caret</code> on the original factor encoding automatically translates
factors (here type) into 0-1 dummy variables (e.g., <code>typeinsect = 0</code>).
The reason is that some models cannot directly use factors and <code>caret</code>
tries to consistently work with all of them.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">predator</span> <span class="op">~</span> <span class="va">type</span>, </span>
<span>        data <span class="op">=</span> <span class="va">_</span>, </span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">##  1 predictor</span></span>
<span><span class="co">##  2 classes: 'TRUE', 'FALSE' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Bootstrapped (25 reps) </span></span>
<span><span class="co">## Summary of sample sizes: 83, 83, 83, 83, 83, 83, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa </span></span>
<span><span class="co">##   0.5635    0.1166</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'cp' was held constant at a value of 0.01</span></span></code></pre></div>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-174-1.png" width="672"></div>
<p><em>Note:</em> To use a fixed value for the tuning parameter <code>cp</code>, we have to
create a tuning grid that only contains that value.</p>
</div>
</div>
<div id="exercises-1" class="section level2" number="3.11">
<h2>
<span class="header-section-number">3.11</span> Exercises*<a class="anchor" aria-label="anchor" href="#exercises-1"><i class="fas fa-link"></i></a>
</h2>
<p>We will use again the Palmer penguin data for the exercises.</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   species island    bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Torgersen           39.1          18.7</span></span>
<span><span class="co">## 2 Adelie  Torgersen           39.5          17.4</span></span>
<span><span class="co">## 3 Adelie  Torgersen           40.3          18  </span></span>
<span><span class="co">## 4 Adelie  Torgersen           NA            NA  </span></span>
<span><span class="co">## 5 Adelie  Torgersen           36.7          19.3</span></span>
<span><span class="co">## 6 Adelie  Torgersen           39.3          20.6</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
<p>Create a R markdown file with the code and discussion for the following below.
Remember, the complete approach is described in section <a href="classification-basic-concepts.html#hyperparameter-tuning">Hyperparameter Tuning</a>.</p>
<ol style="list-style-type: decimal">
<li>Split the data into a training and test set.</li>
<li>Create an rpart decision tree to predict the species. You will have to deal with
missing values.</li>
<li>Experiment with setting <code>minsplit</code> for rpart and make sure <code>tuneLength</code> is
at least 5.
Discuss the model selection process (hyperparameter tuning) and what final
model was chosen.</li>
<li>Visualize the tree and discuss what the splits mean.</li>
<li>Calculate the variable importance from the fitted model. What variables are
the most important? What variables do not matter?</li>
<li>Use the test set to evaluate the generalization error and accuracy.</li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data.html"><span class="header-section-number">2</span> Data</a></div>
<div class="next"><a href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#classification-basic-concepts"><span class="header-section-number">3</span> Classification: Basic Concepts</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#packages-used-in-this-chapter-1">Packages Used in this Chapter</a></li></ul>
</li>
<li><a class="nav-link" href="#basic-concepts"><span class="header-section-number">3.1</span> Basic Concepts</a></li>
<li>
<a class="nav-link" href="#general-framework-for-classification"><span class="header-section-number">3.2</span> General Framework for Classification</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#the-zoo-dataset"><span class="header-section-number">3.2.1</span> The Zoo Dataset</a></li></ul>
</li>
<li>
<a class="nav-link" href="#decision-tree-classifiers"><span class="header-section-number">3.3</span> Decision Tree Classifiers</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#create-tree"><span class="header-section-number">3.3.1</span> Create Tree</a></li>
<li><a class="nav-link" href="#make-predictions-for-new-data"><span class="header-section-number">3.3.2</span> Make Predictions for New Data</a></li>
<li><a class="nav-link" href="#manual-calculation-of-the-resubstitution-error"><span class="header-section-number">3.3.3</span> Manual Calculation of the Resubstitution Error</a></li>
<li><a class="nav-link" href="#confusion-matrix-using-caret"><span class="header-section-number">3.3.4</span> Confusion Matrix using Caret</a></li>
</ul>
</li>
<li><a class="nav-link" href="#model-overfitting"><span class="header-section-number">3.4</span> Model Overfitting</a></li>
<li><a class="nav-link" href="#model-selection"><span class="header-section-number">3.5</span> Model Selection</a></li>
<li>
<a class="nav-link" href="#model-evaluation"><span class="header-section-number">3.6</span> Model Evaluation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#holdout-method"><span class="header-section-number">3.6.1</span> Holdout Method</a></li>
<li><a class="nav-link" href="#cross-validation"><span class="header-section-number">3.6.2</span> Cross-Validation</a></li>
</ul>
</li>
<li><a class="nav-link" href="#hyperparameter-tuning"><span class="header-section-number">3.7</span> Hyperparameter Tuning</a></li>
<li><a class="nav-link" href="#pitfalls-of-model-selection-and-evaluation"><span class="header-section-number">3.8</span> Pitfalls of Model Selection and Evaluation</a></li>
<li><a class="nav-link" href="#model-comparison"><span class="header-section-number">3.9</span> Model Comparison</a></li>
<li>
<a class="nav-link" href="#feature-selection"><span class="header-section-number">3.10</span> Feature Selection*</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#univariate-feature-importance-score"><span class="header-section-number">3.10.1</span> Univariate Feature Importance Score</a></li>
<li><a class="nav-link" href="#feature-subset-selection-1"><span class="header-section-number">3.10.2</span> Feature Subset Selection</a></li>
<li><a class="nav-link" href="#using-dummy-variables-for-factors"><span class="header-section-number">3.10.3</span> Using Dummy Variables for Factors</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercises-1"><span class="header-section-number">3.11</span> Exercises*</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/blob/master/book_src/03_classification_basics.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/edit/master/book_src/03_classification_basics.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An R Companion for Introduction to Data Mining</strong>" was written by Michael Hahsler. It was last built on 2024-09-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
