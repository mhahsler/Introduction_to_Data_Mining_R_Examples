<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Regression* | An R Companion for Introduction to Data Mining</title>
<meta name="author" content="Michael Hahsler">
<meta name="description" content="This chapter introduces the regression problem and multiple linear regression. In addition, alternative models like regression trees and regularized regression are discussed. Packages Used in this...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 8 Regression* | An R Companion for Introduction to Data Mining">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="This chapter introduces the regression problem and multiple linear regression. In addition, alternative models like regression trees and regularized regression are discussed. Packages Used in this...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Regression* | An R Companion for Introduction to Data Mining">
<meta name="twitter:description" content="This chapter introduces the regression problem and multiple linear regression. In addition, alternative models like regression trees and regularized regression are discussed. Packages Used in this...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/accessible-code-block/empty-anchor.js"></script><link href="libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><link href="libs/nouislider/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider/jquery.nouislider.min.js"></script><link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize/selectize.min.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An R Companion for Introduction to Data Mining</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="" href="classification-basic-concepts.html"><span class="header-section-number">3</span> Classification: Basic Concepts</a></li>
<li><a class="" href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></li>
<li><a class="" href="association-analysis-basic-concepts.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts</a></li>
<li><a class="" href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></li>
<li><a class="" href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></li>
<li><a class="active" href="regression.html"><span class="header-section-number">8</span> Regression*</a></li>
<li><a class="" href="logistic-regression-1.html"><span class="header-section-number">9</span> Logistic Regression*</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="regression" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Regression*<a class="anchor" aria-label="anchor" href="#regression"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter introduces the regression problem
and multiple linear regression. In addition,
alternative models like regression trees and regularized regression
are discussed.</p>
<div id="packages-used-in-this-chapter-6" class="section level3 unnumbered" number="">
<h3>Packages Used in this Chapter<a class="anchor" aria-label="anchor" href="#packages-used-in-this-chapter-6"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'lars'</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">pkgs_install</span> <span class="op">&lt;-</span> <span class="va">pkgs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span></span></code></pre></div>
<p>The packages used for this chapter are:</p>
<ul>
<li>
<em>lars</em> <span class="citation">(Hastie and Efron <a href="references.html#ref-R-lars" role="doc-biblioref">2022</a>)</span>
</li>
</ul>
</div>
<div id="introduction-1" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>Classification predicts one of a small set of discrete labels (e.g., yes or no).
Regression is also a supervised learning problem, but the goal is to
predict the value of a continuous value given a set of predictors.
We start with the popular linear regression and will later discuss alternative
regression methods.</p>
<p>Linear regression models the value of a dependent variable <span class="math inline">\(y\)</span> (also called
response) as
as linear function of independent variables <span class="math inline">\(X_1, X_2, ..., X_p\)</span>
(also called regressors, predictors, exogenous variables or covariates).
Given <span class="math inline">\(n\)</span> observations the model is:
<span class="math display">\[y_i = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} + \epsilon_i \]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> is the intercept, <span class="math inline">\(\beta\)</span> is a <span class="math inline">\(p\)</span>-dimensional parameter
vector learned from the data, and <span class="math inline">\(\epsilon\)</span> is the error term
(called residuals).</p>
<p>Linear regression makes several assumptions:</p>
<ul>
<li>
<em>Weak exogeneity:</em> Predictor variables are assumed to be error free.</li>
<li>
<em>Linearity:</em> There is a linear relationship between dependent
and independent variables.</li>
<li>
<em>Homoscedasticity:</em> The variance of the error (<span class="math inline">\(\epsilon\)</span>)
does not change (increase) with the predicted value.</li>
<li>
<em>Independence of errors:</em> Errors between observations are uncorrelated.</li>
<li>
<em>No multicollinearity of predictors:</em> Predictors cannot be
perfectly correlated or the parameter vector cannot be identified. <em>Note</em>
that highly correlated predictors lead to unstable results and should be
avoided.</li>
</ul>
</div>
<div id="a-first-linear-regression-model" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> A First Linear Regression Model<a class="anchor" aria-label="anchor" href="#a-first-linear-regression-model"><i class="fas fa-link"></i></a>
</h2>
<p>Load and shuffle data (flowers are in order by species)</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/arules/man/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, col<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-392-1.png" width="672"></div>
<p>Make the data a little messy and add a useless feature</p>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>           useless <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           Species <span class="op">=</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, col<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-393-1.png" width="672"></div>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##   Sepal.Length   Sepal.Width     Petal.Length   </span></span>
<span><span class="co">##  Min.   :2.68   Min.   :0.611   Min.   :-0.713  </span></span>
<span><span class="co">##  1st Qu.:5.05   1st Qu.:2.306   1st Qu.: 1.876  </span></span>
<span><span class="co">##  Median :5.92   Median :3.171   Median : 4.102  </span></span>
<span><span class="co">##  Mean   :5.85   Mean   :3.128   Mean   : 3.781  </span></span>
<span><span class="co">##  3rd Qu.:6.70   3rd Qu.:3.945   3rd Qu.: 5.546  </span></span>
<span><span class="co">##  Max.   :8.81   Max.   :5.975   Max.   : 7.708  </span></span>
<span><span class="co">##   Petal.Width     useless           Species  </span></span>
<span><span class="co">##  Min.   :0.1   Min.   :2.92   setosa    :50  </span></span>
<span><span class="co">##  1st Qu.:0.3   1st Qu.:5.23   versicolor:50  </span></span>
<span><span class="co">##  Median :1.3   Median :5.91   virginica :50  </span></span>
<span><span class="co">##  Mean   :1.2   Mean   :5.88                  </span></span>
<span><span class="co">##  3rd Qu.:1.8   3rd Qu.:6.57                  </span></span>
<span><span class="co">##  Max.   :2.5   Max.   :8.11</span></span></code></pre></div>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##     Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">## 85         2.980       1.464        5.227         1.5</span></span>
<span><span class="co">## 104        5.096       3.044        5.187         1.8</span></span>
<span><span class="co">## 30         4.361       2.832        1.861         0.2</span></span>
<span><span class="co">## 53         8.125       2.406        5.526         1.5</span></span>
<span><span class="co">## 143        6.372       1.565        6.147         1.9</span></span>
<span><span class="co">## 142        6.526       3.697        5.708         2.3</span></span>
<span><span class="co">##     useless    Species</span></span>
<span><span class="co">## 85    5.712 versicolor</span></span>
<span><span class="co">## 104   6.569  virginica</span></span>
<span><span class="co">## 30    4.299     setosa</span></span>
<span><span class="co">## 53    6.124 versicolor</span></span>
<span><span class="co">## 143   6.553  virginica</span></span>
<span><span class="co">## 142   5.222  virginica</span></span></code></pre></div>
<p>Create some training and learning data</p>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">150</span>,<span class="op">]</span></span></code></pre></div>
<p>Can we predict Petal.Width using the other variables?</p>
<p>lm uses a formula interface see ?lm for description</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span></span>
<span>            <span class="op">+</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">useless</span>,</span>
<span>            data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">model1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + </span></span>
<span><span class="co">##     useless, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##  (Intercept)  Sepal.Length   Sepal.Width  Petal.Length  </span></span>
<span><span class="co">##     -0.20589       0.01957       0.03406       0.30814  </span></span>
<span><span class="co">##      useless  </span></span>
<span><span class="co">##      0.00392</span></span></code></pre></div>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="co">##  (Intercept) Sepal.Length  Sepal.Width Petal.Length </span></span>
<span><span class="co">##    -0.205886     0.019568     0.034062     0.308139 </span></span>
<span><span class="co">##      useless </span></span>
<span><span class="co">##     0.003917</span></span></code></pre></div>
<p>Summary shows:</p>
<ul>
<li>Which coefficients are significantly different from 0</li>
<li>R-squared (coefficient of determination): Proportion of the variability of the dependent variable explained by the model. It is better to look at the adjusted R-square (adjusted for number of dependent vars.)</li>
</ul>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + </span></span>
<span><span class="co">##     useless, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0495 -0.2033  0.0074  0.2038  0.8564 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  -0.20589    0.28723   -0.72     0.48    </span></span>
<span><span class="co">## Sepal.Length  0.01957    0.03265    0.60     0.55    </span></span>
<span><span class="co">## Sepal.Width   0.03406    0.03549    0.96     0.34    </span></span>
<span><span class="co">## Petal.Length  0.30814    0.01819   16.94   &lt;2e-16 ***</span></span>
<span><span class="co">## useless       0.00392    0.03558    0.11     0.91    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.366 on 95 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.778,  Adjusted R-squared:  0.769 </span></span>
<span><span class="co">## F-statistic: 83.4 on 4 and 95 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>Plotting the model produces diagnostic plots (see <code><a href="https://rdrr.io/r/stats/plot.lm.html">? plot.lm</a></code>). For example
to check for homoscedasticity (residual vs predicted value scatter plot should produce a close to horizontal line)
and if the residuals are approximately normally distributed (Q-Q plot should be close to the straight line).</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model1</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-397-1.png" width="672"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-397-2.png" width="672"></p>
</div>
<div id="comparing-nested-models" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Comparing Nested Models<a class="anchor" aria-label="anchor" href="#comparing-nested-models"><i class="fas fa-link"></i></a>
</h2>
<p>Here we create a simpler model by using only three predictors.</p>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> </span>
<span>               <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length, </span></span>
<span><span class="co">##     data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0440 -0.2024  0.0099  0.1998  0.8513 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   -0.1842     0.2076   -0.89     0.38    </span></span>
<span><span class="co">## Sepal.Length   0.0199     0.0323    0.62     0.54    </span></span>
<span><span class="co">## Sepal.Width    0.0339     0.0353    0.96     0.34    </span></span>
<span><span class="co">## Petal.Length   0.3080     0.0180   17.07   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.365 on 96 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.778,  Adjusted R-squared:  0.771 </span></span>
<span><span class="co">## F-statistic:  112 on 3 and 96 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>We can remove the intercept by adding <code>-1</code> to the formula.</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> </span>
<span>               <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model3</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length - </span></span>
<span><span class="co">##     1, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0310 -0.1961 -0.0051  0.2264  0.8246 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## Sepal.Length -0.00168    0.02122   -0.08     0.94    </span></span>
<span><span class="co">## Sepal.Width   0.01859    0.03073    0.61     0.55    </span></span>
<span><span class="co">## Petal.Length  0.30666    0.01796   17.07   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.364 on 97 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.938,  Adjusted R-squared:  0.936 </span></span>
<span><span class="co">## F-statistic:  486 on 3 and 97 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>here is a very simple model:</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length - 1, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.9774 -0.1957  0.0078  0.2536  0.8455 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## Petal.Length  0.31586    0.00822    38.4   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.362 on 99 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.937,  Adjusted R-squared:  0.936 </span></span>
<span><span class="co">## F-statistic: 1.47e+03 on 1 and 99 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>Compare models (Null hypothesis: all treatments=models have the same effect). <strong>Note:</strong> This only works for <em>nested models.</em> Models are nested only if one model contains all the predictors of the other model.</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span>, <span class="va">model3</span>, <span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + useless</span></span>
<span><span class="co">## Model 2: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length</span></span>
<span><span class="co">## Model 3: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length - 1</span></span>
<span><span class="co">## Model 4: Petal.Width ~ Petal.Length - 1</span></span>
<span><span class="co">##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">## 1     95 12.8                         </span></span>
<span><span class="co">## 2     96 12.8 -1   -0.0016 0.01   0.91</span></span>
<span><span class="co">## 3     97 12.9 -1   -0.1046 0.78   0.38</span></span>
<span><span class="co">## 4     99 13.0 -2   -0.1010 0.38   0.69</span></span></code></pre></div>
<p>Models 1 is not significantly better than model 2. Model 2 is not significantly better than model 3. Model 3 is not significantly better than model 4! Use model 4 (simplest model)</p>
</div>
<div id="stepwise-variable-selection" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Stepwise Variable Selection<a class="anchor" aria-label="anchor" href="#stepwise-variable-selection"><i class="fas fa-link"></i></a>
</h2>
<p>Automatically looks for the smallest AIC (Akaike information criterion)</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="va">Species</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-195.9</span></span>
<span><span class="co">## Petal.Width ~ (Sepal.Length + Sepal.Width + Petal.Length + useless + </span></span>
<span><span class="co">##     Species) - Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - useless       1       0.0 12.8 -197.9</span></span>
<span><span class="co">## - Sepal.Length  1       0.0 12.8 -197.5</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -196.9</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -195.9</span></span>
<span><span class="co">## - Petal.Length  1      38.6 51.3  -58.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-197.9</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - Sepal.Length  1       0.1 12.8 -199.5</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -198.9</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -197.9</span></span>
<span><span class="co">## - Petal.Length  1      38.7 51.5  -60.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-199.5</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Width + Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -200.4</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -199.5</span></span>
<span><span class="co">## - Petal.Length  1      44.7 57.5  -51.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-200.4</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## &lt;none&gt;                      12.9 -200.4</span></span>
<span><span class="co">## - Petal.Length  1      44.6 57.6  -53.2</span></span></code></pre></div>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.9848 -0.1873  0.0048  0.2466  0.8343 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)    0.0280     0.0743    0.38     0.71    </span></span>
<span><span class="co">## Petal.Length   0.3103     0.0169   18.38   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.364 on 98 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.775,  Adjusted R-squared:  0.773 </span></span>
<span><span class="co">## F-statistic:  338 on 1 and 98 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
</div>
<div id="modeling-with-interaction-terms" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Modeling with Interaction Terms<a class="anchor" aria-label="anchor" href="#modeling-with-interaction-terms"><i class="fas fa-link"></i></a>
</h2>
<p>What if two variables are only important together? Interaction terms
are modeled with <code>:</code> or <code>*</code> in the formula (they are literally multiplied).
See <code><a href="https://rdrr.io/r/stats/formula.html">? formula</a></code>.</p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">*</span> </span>
<span>                    <span class="va">Sepal.Width</span> <span class="op">*</span> <span class="va">Petal.Length</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-196.4</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                         Df Sum of Sq  RSS</span></span>
<span><span class="co">## &lt;none&gt;                                               11.9</span></span>
<span><span class="co">## - Sepal.Length:Sepal.Width:Petal.Length  1     0.265 12.2</span></span>
<span><span class="co">##                                          AIC</span></span>
<span><span class="co">## &lt;none&gt;                                  -196</span></span>
<span><span class="co">## - Sepal.Length:Sepal.Width:Petal.Length -196</span></span></code></pre></div>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model5</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length, </span></span>
<span><span class="co">##     data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.1064 -0.1882  0.0238  0.1767  0.8577 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                                       Estimate Std. Error</span></span>
<span><span class="co">## (Intercept)                            -2.4207     1.3357</span></span>
<span><span class="co">## Sepal.Length                            0.4484     0.2313</span></span>
<span><span class="co">## Sepal.Width                             0.5983     0.3845</span></span>
<span><span class="co">## Petal.Length                            0.7275     0.2863</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width               -0.1115     0.0670</span></span>
<span><span class="co">## Sepal.Length:Petal.Length              -0.0833     0.0477</span></span>
<span><span class="co">## Sepal.Width:Petal.Length               -0.0941     0.0850</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length   0.0201     0.0141</span></span>
<span><span class="co">##                                       t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## (Intercept)                             -1.81    0.073 .</span></span>
<span><span class="co">## Sepal.Length                             1.94    0.056 .</span></span>
<span><span class="co">## Sepal.Width                              1.56    0.123  </span></span>
<span><span class="co">## Petal.Length                             2.54    0.013 *</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width                -1.66    0.100 .</span></span>
<span><span class="co">## Sepal.Length:Petal.Length               -1.75    0.084 .</span></span>
<span><span class="co">## Sepal.Width:Petal.Length                -1.11    0.272  </span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length    1.43    0.157  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.36 on 92 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.792,  Adjusted R-squared:  0.777 </span></span>
<span><span class="co">## F-statistic: 50.2 on 7 and 92 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model5</span>, <span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length</span></span>
<span><span class="co">## Model 2: Petal.Width ~ Petal.Length - 1</span></span>
<span><span class="co">##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">## 1     92 11.9                         </span></span>
<span><span class="co">## 2     99 13.0 -7     -1.01 1.11   0.36</span></span></code></pre></div>
<p>Model 5 is not significantly better than model 4</p>
</div>
<div id="prediction" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Prediction<a class="anchor" aria-label="anchor" href="#prediction"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">##     Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">## 128        8.017       1.541        3.515         1.8</span></span>
<span><span class="co">## 92         5.268       4.064        6.064         1.4</span></span>
<span><span class="co">## 50         5.461       4.161        1.117         0.2</span></span>
<span><span class="co">## 134        6.055       2.951        4.599         1.5</span></span>
<span><span class="co">## 8          4.900       5.096        1.086         0.2</span></span>
<span><span class="co">##     useless    Species</span></span>
<span><span class="co">## 128   6.110  virginica</span></span>
<span><span class="co">## 92    4.938 versicolor</span></span>
<span><span class="co">## 50    6.373     setosa</span></span>
<span><span class="co">## 134   5.595  virginica</span></span>
<span><span class="co">## 8     7.270     setosa</span></span></code></pre></div>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">$</span><span class="va">Petal.Width</span></span>
<span><span class="co">## [1] 1.8 1.4 0.2 1.5 0.2</span></span></code></pre></div>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##    128     92     50    134      8 </span></span>
<span><span class="co">## 1.1104 1.9155 0.3529 1.4526 0.3429</span></span></code></pre></div>
<p>Calculate the root-mean-square error (RMSE): less is better</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMSE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">predicted</span>, <span class="va">true</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">predicted</span><span class="op">-</span><span class="va">true</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.3874</span></span></code></pre></div>
<p>Compare predicted vs. actual values</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span>,</span>
<span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-406-1.png" width="672"></div>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.8636</span></span></code></pre></div>
</div>
<div id="using-nominal-variables" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Using Nominal Variables<a class="anchor" aria-label="anchor" href="#using-nominal-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Dummy coding is used for factors
(i.e., levels are translated into individual 0-1 variable).
The first level of factors is automatically used as the reference and
the other levels are presented as 0-1 dummy variables called contrasts.</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">## [1] "setosa"     "versicolor" "virginica"</span></span></code></pre></div>
<p><code>model.matrix</code> is used internally to create the dummy coding.</p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##     (Intercept) Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">## 85            1        2.980       1.464        5.227</span></span>
<span><span class="co">## 104           1        5.096       3.044        5.187</span></span>
<span><span class="co">## 30            1        4.361       2.832        1.861</span></span>
<span><span class="co">## 53            1        8.125       2.406        5.526</span></span>
<span><span class="co">## 143           1        6.372       1.565        6.147</span></span>
<span><span class="co">## 142           1        6.526       3.697        5.708</span></span>
<span><span class="co">##     useless Speciesversicolor Speciesvirginica</span></span>
<span><span class="co">## 85    5.712                 1                0</span></span>
<span><span class="co">## 104   6.569                 0                1</span></span>
<span><span class="co">## 30    4.299                 0                0</span></span>
<span><span class="co">## 53    6.124                 1                0</span></span>
<span><span class="co">## 143   6.553                 0                1</span></span>
<span><span class="co">## 142   5.222                 0                1</span></span></code></pre></div>
<p>Note that there is no dummy variable for species Setosa, because it is
used as the reference. It is often useful to set the reference level.
A simple way is to use the
function <code>relevel</code> to change which factor is listed first.</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-308.4</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + useless + </span></span>
<span><span class="co">##     Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - Sepal.Length  1      0.01  3.99 -310</span></span>
<span><span class="co">## - Sepal.Width   1      0.01  3.99 -310</span></span>
<span><span class="co">## - useless       1      0.02  4.00 -310</span></span>
<span><span class="co">## &lt;none&gt;                       3.98 -308</span></span>
<span><span class="co">## - Petal.Length  1      0.47  4.45 -299</span></span>
<span><span class="co">## - Species       2      8.78 12.76 -196</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-310.2</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Width + Petal.Length + useless + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - Sepal.Width   1      0.01  4.00 -312</span></span>
<span><span class="co">## - useless       1      0.02  4.00 -312</span></span>
<span><span class="co">## &lt;none&gt;                       3.99 -310</span></span>
<span><span class="co">## - Petal.Length  1      0.49  4.48 -300</span></span>
<span><span class="co">## - Species       2      8.82 12.81 -198</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-311.9</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length + useless + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - useless       1      0.02  4.02 -313</span></span>
<span><span class="co">## &lt;none&gt;                       4.00 -312</span></span>
<span><span class="co">## - Petal.Length  1      0.48  4.48 -302</span></span>
<span><span class="co">## - Species       2      8.95 12.95 -198</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-313.4</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## &lt;none&gt;                       4.02 -313</span></span>
<span><span class="co">## - Petal.Length  1      0.50  4.52 -304</span></span>
<span><span class="co">## - Species       2      8.93 12.95 -200</span></span></code></pre></div>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length + Species, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##       (Intercept)       Petal.Length  Speciesversicolor  </span></span>
<span><span class="co">##            0.1597             0.0664             0.8938  </span></span>
<span><span class="co">##  Speciesvirginica  </span></span>
<span><span class="co">##            1.4903</span></span></code></pre></div>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model6</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length + Species, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.7208 -0.1437  0.0005  0.1254  0.5460 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)         0.1597     0.0441    3.62  0.00047 ***</span></span>
<span><span class="co">## Petal.Length        0.0664     0.0192    3.45  0.00084 ***</span></span>
<span><span class="co">## Speciesversicolor   0.8938     0.0746   11.98  &lt; 2e-16 ***</span></span>
<span><span class="co">## Speciesvirginica    1.4903     0.1020   14.61  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.205 on 96 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.93,   Adjusted R-squared:  0.928 </span></span>
<span><span class="co">## F-statistic:  427 on 3 and 96 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1885</span></span></code></pre></div>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span>,</span>
<span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-409-1.png" width="672"></div>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9696</span></span></code></pre></div>
</div>
<div id="alternative-regression-models" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Alternative Regression Models<a class="anchor" aria-label="anchor" href="#alternative-regression-models"><i class="fas fa-link"></i></a>
</h2>
<div id="regression-trees" class="section level3" number="8.8.1">
<h3>
<span class="header-section-number">8.8.1</span> Regression Trees<a class="anchor" aria-label="anchor" href="#regression-trees"><i class="fas fa-link"></i></a>
</h3>
<p>Many models we use for classification can also perform regression
to produce piece-wise predictors.
For example CART:</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="va">model7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model7</span></span>
<span><span class="co">## n= 100 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## node), split, n, deviance, yval</span></span>
<span><span class="co">##       * denotes terminal node</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1) root 100 57.5700 1.2190  </span></span>
<span><span class="co">##   2) Species=setosa 32  0.3797 0.2469 *</span></span>
<span><span class="co">##   3) Species=versicolor,virginica 68 12.7200 1.6760  </span></span>
<span><span class="co">##     6) Species=versicolor 35  1.5350 1.3310 *</span></span>
<span><span class="co">##     7) Species=virginica 33  2.6010 2.0420 *</span></span></code></pre></div>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">model7</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-410-1.png" width="672"></div>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model7</span>, <span class="va">test</span><span class="op">)</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.182</span></span></code></pre></div>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model7</span>, <span class="va">test</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-410-2.png" width="672"></div>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model7</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9717</span></span></code></pre></div>
<p><strong>Note:</strong> This is not a nested model of the linear regressions so we cannot
do ANOVA to compare the models!</p>
</div>
<div id="regularized-regression" class="section level3" number="8.8.2">
<h3>
<span class="header-section-number">8.8.2</span> Regularized Regression<a class="anchor" aria-label="anchor" href="#regularized-regression"><i class="fas fa-link"></i></a>
</h3>
<p>LASSO and LAR try to reduce the number of parameters using a
regularization term (see <code>lars</code> in package lars and <a href="https://en.wikipedia.org/wiki/Elastic_net_regularization" class="uri">https://en.wikipedia.org/wiki/Elastic_net_regularization</a>)</p>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067">lars</a></span><span class="op">)</span></span>
<span><span class="co">## Loaded lars 1.3</span></span></code></pre></div>
<p>create a design matrix (with dummy variables and interaction terms).
<code>lm</code> did this automatically for us, but for this <code>lars</code> implementation
we have to do it manually.</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Sepal.Length</span><span class="op">*</span><span class="va">Sepal.Width</span><span class="op">*</span><span class="va">Petal.Length</span> ,</span>
<span>  data <span class="op">=</span> <span class="va">train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##     (Intercept) Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">## 85            1        2.980       1.464        5.227</span></span>
<span><span class="co">## 104           1        5.096       3.044        5.187</span></span>
<span><span class="co">## 30            1        4.361       2.832        1.861</span></span>
<span><span class="co">## 53            1        8.125       2.406        5.526</span></span>
<span><span class="co">## 143           1        6.372       1.565        6.147</span></span>
<span><span class="co">## 142           1        6.526       3.697        5.708</span></span>
<span><span class="co">##     useless Speciesversicolor Speciesvirginica</span></span>
<span><span class="co">## 85    5.712                 1                0</span></span>
<span><span class="co">## 104   6.569                 0                1</span></span>
<span><span class="co">## 30    4.299                 0                0</span></span>
<span><span class="co">## 53    6.124                 1                0</span></span>
<span><span class="co">## 143   6.553                 0                1</span></span>
<span><span class="co">## 142   5.222                 0                1</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width Sepal.Length:Petal.Length</span></span>
<span><span class="co">## 85                     4.362                    15.578</span></span>
<span><span class="co">## 104                   15.511                    26.431</span></span>
<span><span class="co">## 30                    12.349                     8.114</span></span>
<span><span class="co">## 53                    19.546                    44.900</span></span>
<span><span class="co">## 143                    9.972                    39.168</span></span>
<span><span class="co">## 142                   24.126                    37.253</span></span>
<span><span class="co">##     Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 85                     7.650</span></span>
<span><span class="co">## 104                   15.787</span></span>
<span><span class="co">## 30                     5.269</span></span>
<span><span class="co">## 53                    13.294</span></span>
<span><span class="co">## 143                    9.620</span></span>
<span><span class="co">## 142                   21.103</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 85                                  22.80</span></span>
<span><span class="co">## 104                                 80.45</span></span>
<span><span class="co">## 30                                  22.98</span></span>
<span><span class="co">## 53                                 108.01</span></span>
<span><span class="co">## 143                                 61.30</span></span>
<span><span class="co">## 142                                137.72</span></span></code></pre></div>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">model_lars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lars</span><span class="op">)</span></span>
<span><span class="co">## LARS/LASSO</span></span>
<span><span class="co">## Call: lars(x = x, y = y)</span></span>
<span><span class="co">##    Df  Rss      Cp</span></span>
<span><span class="co">## 0   1 57.6 1225.20</span></span>
<span><span class="co">## 1   2 28.1  549.74</span></span>
<span><span class="co">## 2   3 11.6  172.16</span></span>
<span><span class="co">## 3   4 10.1  140.94</span></span>
<span><span class="co">## 4   5  4.2    5.49</span></span>
<span><span class="co">## 5   6  4.1    6.08</span></span>
<span><span class="co">## 6   7  4.0    5.14</span></span>
<span><span class="co">## 7   8  3.9    6.21</span></span>
<span><span class="co">## 8   9  3.9    7.94</span></span>
<span><span class="co">## 9  10  3.9    9.87</span></span>
<span><span class="co">## 10  9  3.9    7.75</span></span>
<span><span class="co">## 11 10  3.9    9.73</span></span>
<span><span class="co">## 12 11  3.9   11.58</span></span>
<span><span class="co">## 13 10  3.9    9.54</span></span>
<span><span class="co">## 14 11  3.9   11.00</span></span></code></pre></div>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_lars</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lars(x = x, y = y)</span></span>
<span><span class="co">## R-squared: 0.933 </span></span>
<span><span class="co">## Sequence of LASSO moves:</span></span>
<span><span class="co">##      Petal.Length Speciesvirginica Speciesversicolor</span></span>
<span><span class="co">## Var             4                7                 6</span></span>
<span><span class="co">## Step            1                2                 3</span></span>
<span><span class="co">##      Sepal.Width:Petal.Length</span></span>
<span><span class="co">## Var                        10</span></span>
<span><span class="co">## Step                        4</span></span>
<span><span class="co">##      Sepal.Length:Sepal.Width:Petal.Length useless</span></span>
<span><span class="co">## Var                                     11       5</span></span>
<span><span class="co">## Step                                     5       6</span></span>
<span><span class="co">##      Sepal.Width Sepal.Length:Petal.Length Sepal.Length</span></span>
<span><span class="co">## Var            3                         9            2</span></span>
<span><span class="co">## Step           7                         8            9</span></span>
<span><span class="co">##      Sepal.Width:Petal.Length Sepal.Width:Petal.Length</span></span>
<span><span class="co">## Var                       -10                       10</span></span>
<span><span class="co">## Step                       10                       11</span></span>
<span><span class="co">##      Sepal.Length:Sepal.Width Sepal.Width Sepal.Width</span></span>
<span><span class="co">## Var                         8          -3           3</span></span>
<span><span class="co">## Step                       12          13          14</span></span></code></pre></div>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_lars</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-412-1.png" width="672"></div>
<p>the plot shows how variables are added (from left to right to the model)</p>
<p>find best model (using Mallows’s Cp statistic, see <a href="https://en.wikipedia.org/wiki/Mallows's_Cp" class="uri">https://en.wikipedia.org/wiki/Mallows's_Cp</a>)</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_lars</span>, plottype <span class="op">=</span> <span class="st">"Cp"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-413-1.png" width="672"></div>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">model_lars</span><span class="op">$</span><span class="va">Cp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_lars</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span></span>
<span><span class="co">##                           (Intercept) </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                          Sepal.Length </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                           Sepal.Width </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                          Petal.Length </span></span>
<span><span class="co">##                             0.0603837 </span></span>
<span><span class="co">##                               useless </span></span>
<span><span class="co">##                            -0.0086551 </span></span>
<span><span class="co">##                     Speciesversicolor </span></span>
<span><span class="co">##                             0.8463786 </span></span>
<span><span class="co">##                      Speciesvirginica </span></span>
<span><span class="co">##                             1.4181850 </span></span>
<span><span class="co">##              Sepal.Length:Sepal.Width </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##             Sepal.Length:Petal.Length </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##              Sepal.Width:Petal.Length </span></span>
<span><span class="co">##                             0.0029688 </span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length </span></span>
<span><span class="co">##                             0.0003151</span></span></code></pre></div>
<p>make predictions</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Sepal.Length</span><span class="op">*</span><span class="va">Sepal.Width</span><span class="op">*</span><span class="va">Petal.Length</span>,</span>
<span>  data <span class="op">=</span> <span class="va">test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">## 6 </span></span>
<span><span class="co">## 7 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fraction</span></span>
<span><span class="co">##      6 </span></span>
<span><span class="co">## 0.4286 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mode</span></span>
<span><span class="co">## [1] "step"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fit</span></span>
<span><span class="co">##    128     92     50    134      8 </span></span>
<span><span class="co">## 1.8237 1.5003 0.2505 1.9300 0.2439</span></span></code></pre></div>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">$</span><span class="va">Petal.Width</span></span>
<span><span class="co">## [1] 1.8 1.4 0.2 1.5 0.2</span></span></code></pre></div>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1907</span></span></code></pre></div>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-414-1.png" width="672"></div>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9686</span></span></code></pre></div>
</div>
<div id="other-types-of-regression" class="section level3" number="8.8.3">
<h3>
<span class="header-section-number">8.8.3</span> Other Types of Regression<a class="anchor" aria-label="anchor" href="#other-types-of-regression"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Robust regression: robust against violation of assumptions like heteroscedasticity and outliers (<code>roblm</code> and <code>robglm</code> in package robustbase)</li>
<li>Generalized linear models (<code>glm</code>). An example is logistic regression discussed in the next chapter.</li>
<li>Nonlinear least squares (<code>nlm</code>)</li>
</ul>
</div>
</div>
<div id="exercises-5" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-5"><i class="fas fa-link"></i></a>
</h2>
<p>We will again use the Palmer penguin data for the exercises.</p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   species island    bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Torgersen           39.1          18.7</span></span>
<span><span class="co">## 2 Adelie  Torgersen           39.5          17.4</span></span>
<span><span class="co">## 3 Adelie  Torgersen           40.3          18  </span></span>
<span><span class="co">## 4 Adelie  Torgersen           NA            NA  </span></span>
<span><span class="co">## 5 Adelie  Torgersen           36.7          19.3</span></span>
<span><span class="co">## 6 Adelie  Torgersen           39.3          20.6</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
<p>Create an R markdown document that performs the following:</p>
<ol style="list-style-type: decimal">
<li><p>Create a linear regression model to predict the weight
of a penguin (<code>body_mass_g</code>).</p></li>
<li><p>How high is the R-squared. What does it mean.</p></li>
<li><p>What variables are significant, what are not?</p></li>
<li><p>Use stepwise variable selection to remove unnecessary variables.</p></li>
<li>
<p>Predict the weight for the following new penguin:</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_penguin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"Adelie"</span>, </span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  island <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"Dream"</span>, </span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Biscoe"</span>, <span class="st">"Dream"</span>, <span class="st">"Torgersen"</span><span class="op">)</span><span class="op">)</span>,</span>
<span> bill_length_mm <span class="op">=</span> <span class="fl">39.8</span>, </span>
<span> bill_depth_mm <span class="op">=</span> <span class="fl">19.1</span>, </span>
<span> flipper_length_mm <span class="op">=</span> <span class="fl">184</span>, </span>
<span> body_mass_g <span class="op">=</span> <span class="cn">NA</span>, </span>
<span> sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"male"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>, </span>
<span> year <span class="op">=</span> <span class="fl">2007</span></span>
<span><span class="op">)</span> </span>
<span><span class="va">new_penguin</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   species island bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Dream            39.8          19.1</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;lgl&gt;, sex &lt;fct&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
</li>
<li><p>Create a regression tree. Look at the tree and explain what it does.
Then use the regression tree to predict the weight for the above penguin.</p></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></div>
<div class="next"><a href="logistic-regression-1.html"><span class="header-section-number">9</span> Logistic Regression*</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#regression"><span class="header-section-number">8</span> Regression*</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#packages-used-in-this-chapter-6">Packages Used in this Chapter</a></li></ul>
</li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">8.1</span> Introduction</a></li>
<li><a class="nav-link" href="#a-first-linear-regression-model"><span class="header-section-number">8.2</span> A First Linear Regression Model</a></li>
<li><a class="nav-link" href="#comparing-nested-models"><span class="header-section-number">8.3</span> Comparing Nested Models</a></li>
<li><a class="nav-link" href="#stepwise-variable-selection"><span class="header-section-number">8.4</span> Stepwise Variable Selection</a></li>
<li><a class="nav-link" href="#modeling-with-interaction-terms"><span class="header-section-number">8.5</span> Modeling with Interaction Terms</a></li>
<li><a class="nav-link" href="#prediction"><span class="header-section-number">8.6</span> Prediction</a></li>
<li><a class="nav-link" href="#using-nominal-variables"><span class="header-section-number">8.7</span> Using Nominal Variables</a></li>
<li>
<a class="nav-link" href="#alternative-regression-models"><span class="header-section-number">8.8</span> Alternative Regression Models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#regression-trees"><span class="header-section-number">8.8.1</span> Regression Trees</a></li>
<li><a class="nav-link" href="#regularized-regression"><span class="header-section-number">8.8.2</span> Regularized Regression</a></li>
<li><a class="nav-link" href="#other-types-of-regression"><span class="header-section-number">8.8.3</span> Other Types of Regression</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercises-5"><span class="header-section-number">8.9</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/blob/master/book_src/91_regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/edit/master/book_src/91_regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An R Companion for Introduction to Data Mining</strong>" was written by Michael Hahsler. It was last built on 2024-09-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
