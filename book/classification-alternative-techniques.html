<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Classification: Alternative Techniques | An R Companion for Introduction to Data Mining</title>
<meta name="author" content="Michael Hahsler">
<meta name="description" content="This chapter introduces different types of classifiers. It also discusses the important problem of class imbalance in data and options to deal with it. In addition, this chapter compares visually...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 4 Classification: Alternative Techniques | An R Companion for Introduction to Data Mining">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="This chapter introduces different types of classifiers. It also discusses the important problem of class imbalance in data and options to deal with it. In addition, this chapter compares visually...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Classification: Alternative Techniques | An R Companion for Introduction to Data Mining">
<meta name="twitter:description" content="This chapter introduces different types of classifiers. It also discusses the important problem of class imbalance in data and options to deal with it. In addition, this chapter compares visually...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/accessible-code-block/empty-anchor.js"></script><link href="libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><link href="libs/nouislider/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider/jquery.nouislider.min.js"></script><link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize/selectize.min.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An R Companion for Introduction to Data Mining</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="" href="classification-basic-concepts-and-techniques.html"><span class="header-section-number">3</span> Classification: Basic Concepts and Techniques</a></li>
<li><a class="active" href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></li>
<li><a class="" href="association-analysis-basic-concepts-and-algorithms.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts and Algorithms</a></li>
<li><a class="" href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></li>
<li><a class="" href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">8</span> Regression*</a></li>
<li><a class="" href="logistic-regression-1.html"><span class="header-section-number">9</span> Logistic Regression*</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="classification-alternative-techniques" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Classification: Alternative Techniques<a class="anchor" aria-label="anchor" href="#classification-alternative-techniques"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter introduces different types of classifiers. It also
discusses the important problem of class imbalance in data and options
to deal with it. In addition, this chapter compares visually the
decision boundaries used by different algorithms. This will provide a
better understanding of the model bias that different algorithms have.</p>
<div id="packages-used-in-this-chapter-2" class="section level3 unnumbered" number="">
<h3>Packages Used in this Chapter<a class="anchor" aria-label="anchor" href="#packages-used-in-this-chapter-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"basemodels"</span>, <span class="st">"C50"</span>, <span class="st">"caret"</span>, <span class="st">"e1071"</span>, <span class="st">"keras"</span>, <span class="st">"klaR"</span>, </span>
<span>          <span class="st">"lattice"</span>, <span class="st">"MASS"</span>, <span class="st">"mlbench"</span>, <span class="st">"nnet"</span>, <span class="st">"palmerpenguins"</span>, </span>
<span>          <span class="st">"randomForest"</span>, <span class="st">"rpart"</span>, <span class="st">"RWeka"</span>, <span class="st">"scales"</span>, <span class="st">"tidyverse"</span>, </span>
<span>          <span class="st">"xgboost"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkgs_install</span> <span class="op">&lt;-</span> <span class="va">pkgs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/pkg/arules/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span></span></code></pre></div>
<p>The packages used for this chapter are: <em>basemodels</em> <span class="citation">(Chen et al. <a href="references.html#ref-R-basemodels" role="doc-biblioref">2023</a>)</span>, <em>C50</em> <span class="citation">(M. Kuhn and Quinlan <a href="references.html#ref-R-C50" role="doc-biblioref">2023</a>)</span>, <em>caret</em> <span class="citation">(M. Kuhn <a href="references.html#ref-R-caret" role="doc-biblioref">2023</a>)</span>, <em>e1071</em> <span class="citation">(Meyer et al. <a href="references.html#ref-R-e1071" role="doc-biblioref">2023</a>)</span>, <em>keras</em> <span class="citation">(Allaire and Chollet <a href="references.html#ref-R-keras" role="doc-biblioref">2024</a>)</span>, <em>klaR</em> <span class="citation">(Roever et al. <a href="references.html#ref-R-klaR" role="doc-biblioref">2023</a>)</span>, <em>lattice</em> <span class="citation">(Sarkar <a href="references.html#ref-R-lattice" role="doc-biblioref">2023</a>)</span>, <em>MASS</em> <span class="citation">(B. Ripley <a href="references.html#ref-R-MASS" role="doc-biblioref">2023</a><a href="references.html#ref-R-MASS" role="doc-biblioref">a</a>)</span>, <em>mlbench</em> <span class="citation">(Leisch and Dimitriadou <a href="references.html#ref-R-mlbench" role="doc-biblioref">2024</a>)</span>, <em>nnet</em> <span class="citation">(B. Ripley <a href="references.html#ref-R-nnet" role="doc-biblioref">2023</a><a href="references.html#ref-R-nnet" role="doc-biblioref">b</a>)</span>, <em>palmerpenguins</em> <span class="citation">(Horst, Hill, and Gorman <a href="references.html#ref-R-palmerpenguins" role="doc-biblioref">2022</a>)</span>, <em>randomForest</em> <span class="citation">(Breiman et al. <a href="references.html#ref-R-randomForest" role="doc-biblioref">2022</a>)</span>, <em>rpart</em> <span class="citation">(Therneau and Atkinson <a href="references.html#ref-R-rpart" role="doc-biblioref">2023</a>)</span>, <em>RWeka</em> <span class="citation">(Hornik <a href="references.html#ref-R-RWeka" role="doc-biblioref">2023</a>)</span>, <em>scales</em> <span class="citation">(Wickham, Pedersen, and Seidel <a href="references.html#ref-R-scales" role="doc-biblioref">2023</a>)</span>, <em>tidyverse</em> <span class="citation">(Wickham <a href="references.html#ref-R-tidyverse" role="doc-biblioref">2023</a><a href="references.html#ref-R-tidyverse" role="doc-biblioref">c</a>)</span>, <em>xgboost</em> <span class="citation">(Chen et al. <a href="references.html#ref-R-xgboost" role="doc-biblioref">2024</a>)</span></p>
</div>
<div id="types-of-classifiers" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Types of Classifiers<a class="anchor" aria-label="anchor" href="#types-of-classifiers"><i class="fas fa-link"></i></a>
</h2>
<p>Many different <a href="https://en.wikipedia.org/wiki/Supervised_learning">classification algorithms</a>
have been proposed in the literature.
In this chapter, we will apply some of the more popular methods.</p>
<div id="set-up-the-training-and-test-data" class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> Set up the Training and Test Data<a class="anchor" aria-label="anchor" href="#set-up-the-training-and-test-data"><i class="fas fa-link"></i></a>
</h3>
<p>We will use the Zoo dataset which is included in the R package <code>mlbench</code>
(you may have to install it). The Zoo dataset containing 17 (mostly
logical) variables on different 101 animals as a data frame with 17
columns (hair, feathers, eggs, milk, airborne, aquatic, predator,
toothed, backbone, breathes, venomous, fins, legs, tail, domestic,
catsize, type). We convert the data frame into a tidyverse tibble
(optional).</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Zoo</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Zoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">Zoo</span><span class="op">)</span></span>
<span><span class="va">Zoo</span></span>
<span><span class="co">## # A tibble: 101 × 17</span></span>
<span><span class="co">##    hair  feathers eggs  milk  airborne aquatic predator toothed</span></span>
<span><span class="co">##    &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt;   &lt;lgl&gt;    &lt;lgl&gt;  </span></span>
<span><span class="co">##  1 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   TRUE     TRUE   </span></span>
<span><span class="co">##  2 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   FALSE    TRUE   </span></span>
<span><span class="co">##  3 FALSE FALSE    TRUE  FALSE FALSE    TRUE    TRUE     TRUE   </span></span>
<span><span class="co">##  4 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   TRUE     TRUE   </span></span>
<span><span class="co">##  5 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   TRUE     TRUE   </span></span>
<span><span class="co">##  6 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   FALSE    TRUE   </span></span>
<span><span class="co">##  7 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   FALSE    TRUE   </span></span>
<span><span class="co">##  8 FALSE FALSE    TRUE  FALSE FALSE    TRUE    FALSE    TRUE   </span></span>
<span><span class="co">##  9 FALSE FALSE    TRUE  FALSE FALSE    TRUE    TRUE     TRUE   </span></span>
<span><span class="co">## 10 TRUE  FALSE    FALSE TRUE  FALSE    FALSE   FALSE    TRUE   </span></span>
<span><span class="co">## # ℹ 91 more rows</span></span>
<span><span class="co">## # ℹ 9 more variables: backbone &lt;lgl&gt;, breathes &lt;lgl&gt;, venomous &lt;lgl&gt;,</span></span>
<span><span class="co">## #   fins &lt;lgl&gt;, legs &lt;int&gt;, tail &lt;lgl&gt;, domestic &lt;lgl&gt;,</span></span>
<span><span class="co">## #   catsize &lt;lgl&gt;, type &lt;fct&gt;</span></span></code></pre></div>
<p>We will use the package <a href="https://topepo.github.io/caret/"><strong>caret</strong></a> to
make preparing training sets and building classification (and
regression) models easier. A great cheat sheet can be found
<a href="https://ugoproto.github.io/ugo_r_doc/pdf/caret.pdf">here</a>.</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span></code></pre></div>
<p>Multi-core support can be used for cross-validation. <strong>Note:</strong> It is
commented out here because it does not work with rJava used by the RWeka-based
classifiers
below.</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##library(doMC, quietly = TRUE)</span></span>
<span><span class="co">##registerDoMC(cores = 4)</span></span>
<span><span class="co">##getDoParWorkers()</span></span></code></pre></div>
<p>Test data is not used in the model building process and needs to be set
aside purely for testing the model after it is completely built. Here I
use 80% for training.</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inTrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Zoo</span><span class="op">$</span><span class="va">type</span>, p <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">Zoo_train</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">inTrain</span><span class="op">)</span></span>
<span><span class="va">Zoo_test</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="va">inTrain</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> is aware of the tunable hyperparameters of each method and
automatically performs model selection using a validation set.
We will use for all models the same validation sets by
creating a fixed sampling scheme (10-folds). This will help when we can compare the fitted models later.</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createFolds</a></span><span class="op">(</span><span class="va">Zoo_train</span><span class="op">$</span><span class="va">type</span>, k <span class="op">=</span> <span class="fl">10</span>, returnTrain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The fixed folds are used in <code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> with the argument
<code>trControl = trainControl(method = "cv", index = train_index))</code>. If
you don’t need fixed folds, then remove <code>index = train_index</code> in the
code below.</p>
<p>For help with building models in caret see: <code><a href="https://rdrr.io/pkg/caret/man/train.html">? train</a></code></p>
<p><strong>Note:</strong> Be careful if you have many <code>NA</code> values in your data.
<code><a href="https://rdrr.io/pkg/caret/man/train.html">train()</a></code> and cross-validation many fail in some cases. If that is the
case then you can remove features (columns) which have many <code>NA</code>s, omit
<code>NA</code>s using <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> or use imputation to replace them with
reasonable values (e.g., by the feature mean or via kNN). Highly
imbalanced datasets are also problematic since there is a chance that a
fold does not contain examples of each class leading to a hard to
understand error message.</p>
</div>
</div>
<div id="rule-based-classifier-part" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Rule-based classifier: PART<a class="anchor" aria-label="anchor" href="#rule-based-classifier-part"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rulesFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"PART"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rulesFit</span></span>
<span><span class="co">## Rule-Based Classifier </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   threshold  pruned  Accuracy  Kappa </span></span>
<span><span class="co">##   0.0100     yes     0.9567    0.9439</span></span>
<span><span class="co">##   0.0100     no      0.9467    0.9309</span></span>
<span><span class="co">##   0.1325     yes     0.9567    0.9439</span></span>
<span><span class="co">##   0.1325     no      0.9467    0.9309</span></span>
<span><span class="co">##   0.2550     yes     0.9567    0.9439</span></span>
<span><span class="co">##   0.2550     no      0.9467    0.9309</span></span>
<span><span class="co">##   0.3775     yes     0.9567    0.9439</span></span>
<span><span class="co">##   0.3775     no      0.9467    0.9309</span></span>
<span><span class="co">##   0.5000     yes     0.9567    0.9439</span></span>
<span><span class="co">##   0.5000     no      0.9467    0.9309</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final values used for the model were threshold = 0.5 and pruned</span></span>
<span><span class="co">##  = yes.</span></span></code></pre></div>
<p>The model selection results are shown in the table. This is the selected model:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rulesFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## PART decision list</span></span>
<span><span class="co">## ------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## feathersTRUE &lt;= 0 AND</span></span>
<span><span class="co">## milkTRUE &gt; 0: mammal (33.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## feathersTRUE &gt; 0: bird (16.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## backboneTRUE &lt;= 0 AND</span></span>
<span><span class="co">## airborneTRUE &lt;= 0: mollusc.et.al (9.0/1.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## airborneTRUE &lt;= 0 AND</span></span>
<span><span class="co">## finsTRUE &gt; 0: fish (11.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## airborneTRUE &gt; 0: insect (6.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## aquaticTRUE &gt; 0: amphibian (5.0/1.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## : reptile (3.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Rules  :   7</span></span></code></pre></div>
<p>PART returns a decision list, i.e., an ordered rule set. For example,
the first rule shows that an animal with no feathers but milk is a mammal.
I ordered rule sets, the decision of the first matching rule is used.</p>
</div>
<div id="nearest-neighbor-classifier" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Nearest Neighbor Classifier<a class="anchor" aria-label="anchor" href="#nearest-neighbor-classifier"><i class="fas fa-link"></i></a>
</h2>
<p>K-Nearest neighbor classifiers classify a new data point by looking at the
majority class labels of its k nearest neighbors in the training data set.
The used kNN implementation uses Euclidean distance to determine what data points
are near by, so data needs be standardized
(scaled) first. Here legs are measured between 0 and 6 while all other
variables are between 0 and 1. Scaling to z-scores can be directly performed as
preprocessing in <code>train</code> using the parameter <code>preProcess = "scale"</code>.</p>
<p>The <span class="math inline">\(k\)</span> value is typically choose as an odd number so we get a clear majority.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knnFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  preProcess <span class="op">=</span> <span class="st">"scale"</span>,</span>
<span>  tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knnFit</span></span>
<span><span class="co">## k-Nearest Neighbors </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pre-processing: scaled (16) </span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   k  Accuracy  Kappa </span></span>
<span><span class="co">##   1  0.9342    0.9158</span></span>
<span><span class="co">##   3  0.9331    0.9145</span></span>
<span><span class="co">##   5  0.9231    0.9007</span></span>
<span><span class="co">##   7  0.8981    0.8708</span></span>
<span><span class="co">##   9  0.8994    0.8676</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final value used for the model was k = 1.</span></span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knnFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## 1-nearest neighbor model</span></span>
<span><span class="co">## Training set outcome distribution:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        mammal          bird       reptile          fish     amphibian </span></span>
<span><span class="co">##            33            16             4            11             4 </span></span>
<span><span class="co">##        insect mollusc.et.al </span></span>
<span><span class="co">##             7             8</span></span></code></pre></div>
<p>kNN classifiers are lazy models meaning that instead of learning, they just
keep the complete dataset. This is why the final model just gives us a summary statistic for the class labels in the training data.</p>
</div>
<div id="naive-bayes-classifier" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Naive Bayes Classifier<a class="anchor" aria-label="anchor" href="#naive-bayes-classifier"><i class="fas fa-link"></i></a>
</h2>
<p>Caret’s train formula interface translates logicals and factors into dummy
variables which the classifier interprets as numbers so it would used a Gaussian naive Bayes estimation. To avoid this, I directly specify <code>x</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NBFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">Zoo_train</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Zoo_train</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, </span>
<span>               y <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Zoo_train</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>               method <span class="op">=</span> <span class="st">"nb"</span>,</span>
<span>               tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                                     usekernel <span class="op">=</span> <span class="cn">TRUE</span>, adjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>               trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">NBFit</span></span>
<span><span class="co">## Naive Bayes </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   fL   Accuracy  Kappa </span></span>
<span><span class="co">##   0.2  0.9453    0.9294</span></span>
<span><span class="co">##   0.5  0.9453    0.9294</span></span>
<span><span class="co">##   1.0  0.9342    0.9157</span></span>
<span><span class="co">##   5.0  0.8981    0.8697</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'usekernel' was held constant at a value of</span></span>
<span><span class="co">##  TRUE</span></span>
<span><span class="co">## Tuning parameter 'adjust' was held constant at a value of 1</span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final values used for the model were fL = 0.2, usekernel =</span></span>
<span><span class="co">##  TRUE and adjust = 1.</span></span></code></pre></div>
<p>The final model contains the prior probabilities for each class.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NBFit</span><span class="op">$</span><span class="va">finalModel</span><span class="op">$</span><span class="va">apriori</span></span>
<span><span class="co">## grouping</span></span>
<span><span class="co">##        mammal          bird       reptile          fish     amphibian </span></span>
<span><span class="co">##       0.39759       0.19277       0.04819       0.13253       0.04819 </span></span>
<span><span class="co">##        insect mollusc.et.al </span></span>
<span><span class="co">##       0.08434       0.09639</span></span></code></pre></div>
<p>And the conditional probabilities as a table for each feature. For brevity,
we only show the tables for the first three features. For example,
the condition probability
<span class="math inline">\(P(\text{hair} = \text{TRUE} | \text{class} = \text{mammal})\)</span> is
0.9641.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NBFit</span><span class="op">$</span><span class="va">finalModel</span><span class="op">$</span><span class="va">tables</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">## $hair</span></span>
<span><span class="co">##                var</span></span>
<span><span class="co">## grouping          FALSE    TRUE</span></span>
<span><span class="co">##   mammal        0.03593 0.96407</span></span>
<span><span class="co">##   bird          0.98780 0.01220</span></span>
<span><span class="co">##   reptile       0.95455 0.04545</span></span>
<span><span class="co">##   fish          0.98246 0.01754</span></span>
<span><span class="co">##   amphibian     0.95455 0.04545</span></span>
<span><span class="co">##   insect        0.43243 0.56757</span></span>
<span><span class="co">##   mollusc.et.al 0.97619 0.02381</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $feathers</span></span>
<span><span class="co">##                var</span></span>
<span><span class="co">## grouping           FALSE     TRUE</span></span>
<span><span class="co">##   mammal        0.994012 0.005988</span></span>
<span><span class="co">##   bird          0.012195 0.987805</span></span>
<span><span class="co">##   reptile       0.954545 0.045455</span></span>
<span><span class="co">##   fish          0.982456 0.017544</span></span>
<span><span class="co">##   amphibian     0.954545 0.045455</span></span>
<span><span class="co">##   insect        0.972973 0.027027</span></span>
<span><span class="co">##   mollusc.et.al 0.976190 0.023810</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $eggs</span></span>
<span><span class="co">##                var</span></span>
<span><span class="co">## grouping          FALSE    TRUE</span></span>
<span><span class="co">##   mammal        0.96407 0.03593</span></span>
<span><span class="co">##   bird          0.01220 0.98780</span></span>
<span><span class="co">##   reptile       0.27273 0.72727</span></span>
<span><span class="co">##   fish          0.01754 0.98246</span></span>
<span><span class="co">##   amphibian     0.04545 0.95455</span></span>
<span><span class="co">##   insect        0.02703 0.97297</span></span>
<span><span class="co">##   mollusc.et.al 0.14286 0.85714</span></span></code></pre></div>
</div>
<div id="bayesian-network" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Bayesian Network<a class="anchor" aria-label="anchor" href="#bayesian-network"><i class="fas fa-link"></i></a>
</h2>
<p>Bayesian networks are not covered here. R has very good
support for modeling with Bayesian Networks. An example is
the package <a href="https://www.bnlearn.com/">bnlearn</a>.</p>
</div>
<div id="logistic-regression" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Logistic regression<a class="anchor" aria-label="anchor" href="#logistic-regression"><i class="fas fa-link"></i></a>
</h2>
<p>Logistic regression is a very powerful classification method
and should always be tried as
one of the first models.
A detailed discussion with more code is available in Section
<a href="logistic-regression-1.html#logistic-regression-1">Logistic Regression*</a>.</p>
<p>Regular logistic regression predicts only one outcome coded as a
binary variable. Since we have data with several
classes, we use <a href="https://en.wikipedia.org/wiki/Multinomial_logistic_regression">multinomial logistic regression</a>,
also called a log-linear model
which is an extension of logistic regresses for multi-class problems.
Caret can use method <code>"multinom"</code> which uses an implementation
in package <code>nnet</code> for penalized multinomial regression.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logRegFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"multinom"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># suppress some output</span></span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logRegFit</span></span>
<span><span class="co">## Penalized Multinomial Regression </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   decay  Accuracy  Kappa </span></span>
<span><span class="co">##   0e+00  0.9064    0.8768</span></span>
<span><span class="co">##   1e-04  0.8842    0.8492</span></span>
<span><span class="co">##   1e-01  0.9231    0.9006</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final value used for the model was decay = 0.1.</span></span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logRegFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## nnet::multinom(formula = .outcome ~ ., data = dat, decay = param$decay, </span></span>
<span><span class="co">##     trace = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##               (Intercept) hairTRUE feathersTRUE eggsTRUE milkTRUE</span></span>
<span><span class="co">## bird             -0.33330  -1.0472       2.9696   0.8278  -1.2523</span></span>
<span><span class="co">## reptile           0.01303  -2.0808      -1.0891   0.6731  -2.1800</span></span>
<span><span class="co">## fish             -0.17462  -0.2762      -0.1135   1.8817  -1.3571</span></span>
<span><span class="co">## amphibian        -1.28295  -1.5165      -0.2698   0.6801  -1.6014</span></span>
<span><span class="co">## insect           -0.75300  -0.3903      -0.1445   0.8980  -1.0130</span></span>
<span><span class="co">## mollusc.et.al     1.52104  -1.2287      -0.2492   0.9320  -0.9035</span></span>
<span><span class="co">##               airborneTRUE aquaticTRUE predatorTRUE toothedTRUE</span></span>
<span><span class="co">## bird               1.17310     -0.1594      0.22312     -1.7846</span></span>
<span><span class="co">## reptile           -0.51796     -1.0890      0.04172     -0.2003</span></span>
<span><span class="co">## fish              -0.09009      0.5093     -0.33094      0.4118</span></span>
<span><span class="co">## amphibian         -0.36649      1.6271     -0.13993      0.7399</span></span>
<span><span class="co">## insect             1.37404     -1.0752     -1.11743     -1.1852</span></span>
<span><span class="co">## mollusc.et.al     -1.17882      0.7160      0.83070     -1.7390</span></span>
<span><span class="co">##               backboneTRUE breathesTRUE venomousTRUE  finsTRUE</span></span>
<span><span class="co">## bird                0.4736       0.1337      -0.3278 -0.545979</span></span>
<span><span class="co">## reptile             0.8968      -0.5039       1.2776 -1.192197</span></span>
<span><span class="co">## fish                0.2768      -1.9709      -0.4204  1.472416</span></span>
<span><span class="co">## amphibian           0.2557       0.4594       0.1611 -0.628746</span></span>
<span><span class="co">## insect             -1.5725       0.1341      -0.2567 -0.002527</span></span>
<span><span class="co">## mollusc.et.al      -2.6045      -0.6287       0.8411 -0.206104</span></span>
<span><span class="co">##                   legs tailTRUE domesticTRUE catsizeTRUE</span></span>
<span><span class="co">## bird          -0.59910   0.5947      0.14176     -0.1182</span></span>
<span><span class="co">## reptile       -0.24200   1.1863     -0.40893     -0.4305</span></span>
<span><span class="co">## fish          -1.15775   0.3226      0.08636     -0.3132</span></span>
<span><span class="co">## amphibian      0.09302  -1.3529     -0.40545     -1.3581</span></span>
<span><span class="co">## insect         0.59118  -1.6908     -0.24924     -1.0416</span></span>
<span><span class="co">## mollusc.et.al  0.12091  -0.7353     -0.22601     -0.7079</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual Deviance: 35.46 </span></span>
<span><span class="co">## AIC: 239.5</span></span></code></pre></div>
<p>The coefficients are log-odds ratios. A negative log-odds ratio means that the odds go down with an increase in
the value of the predictor. A predictor with a
positive log-odds ratio increases the odds. For example,
in the model above, <code>hair=TRUE</code> has a negative coefficient for
bird but <code>feathers=TRUE</code> has a large positive coefficient.</p>
</div>
<div id="artificial-neural-network-ann" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Artificial Neural Network (ANN)<a class="anchor" aria-label="anchor" href="#artificial-neural-network-ann"><i class="fas fa-link"></i></a>
</h2>
<p>Standard networks have an input layer, an output layer and in between
a single hidden layer.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nnetFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"nnet"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>    tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># no progress output</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">nnetFit</span></span>
<span><span class="co">## Neural Network </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   size  decay  Accuracy  Kappa </span></span>
<span><span class="co">##   1     0e+00  0.7475    0.6538</span></span>
<span><span class="co">##   1     1e-04  0.7125    0.5839</span></span>
<span><span class="co">##   1     1e-03  0.8758    0.8362</span></span>
<span><span class="co">##   1     1e-02  0.8036    0.7462</span></span>
<span><span class="co">##   1     1e-01  0.7339    0.6439</span></span>
<span><span class="co">##   3     0e+00  0.8483    0.7997</span></span>
<span><span class="co">##   3     1e-04  0.8383    0.7876</span></span>
<span><span class="co">##   3     1e-03  0.9106    0.8856</span></span>
<span><span class="co">##   3     1e-02  0.9231    0.8982</span></span>
<span><span class="co">##   3     1e-01  0.8758    0.8402</span></span>
<span><span class="co">##   5     0e+00  0.8969    0.8636</span></span>
<span><span class="co">##   5     1e-04  0.9108    0.8850</span></span>
<span><span class="co">##   5     1e-03  0.9331    0.9142</span></span>
<span><span class="co">##   5     1e-02  0.9456    0.9295</span></span>
<span><span class="co">##   5     1e-01  0.9106    0.8857</span></span>
<span><span class="co">##   7     0e+00  0.9108    0.8847</span></span>
<span><span class="co">##   7     1e-04  0.8953    0.8641</span></span>
<span><span class="co">##   7     1e-03  0.9119    0.8875</span></span>
<span><span class="co">##   7     1e-02  0.9331    0.9142</span></span>
<span><span class="co">##   7     1e-01  0.9331    0.9141</span></span>
<span><span class="co">##   9     0e+00  0.9175    0.8910</span></span>
<span><span class="co">##   9     1e-04  0.9053    0.8729</span></span>
<span><span class="co">##   9     1e-03  0.9219    0.9006</span></span>
<span><span class="co">##   9     1e-02  0.9231    0.9011</span></span>
<span><span class="co">##   9     1e-01  0.9231    0.9011</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final values used for the model were size = 5 and decay = 0.01.</span></span></code></pre></div>
<p>The input layer has a size of 16, one for each input feature and
the output layer has a size of 7 representing the 7 classes.
Model selection chose a network architecture with a hidden
layer with 5 units
resulting in 127 learned weights.
Since the model is considered a black-box model only the network architecture
and the used variables are shown as a summary.</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nnetFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## a 16-5-7 network with 127 weights</span></span>
<span><span class="co">## inputs: hairTRUE feathersTRUE eggsTRUE milkTRUE airborneTRUE aquaticTRUE predatorTRUE toothedTRUE backboneTRUE breathesTRUE venomousTRUE finsTRUE legs tailTRUE domesticTRUE catsizeTRUE </span></span>
<span><span class="co">## output(s): .outcome </span></span>
<span><span class="co">## options were - softmax modelling  decay=0.01</span></span></code></pre></div>
</div>
<div id="deep-learning-with-kerastensorflow" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Deep Learning with keras/tensorflow<a class="anchor" aria-label="anchor" href="#deep-learning-with-kerastensorflow"><i class="fas fa-link"></i></a>
</h2>
<p>Using deep learning requires some extra setup. It is not very helpful
for the dataset we use, but it is included here to demonstrate how to set up
and train a simple model architecture.</p>
<p>The keras package needs the packages <code>reticulate</code> and <code>tensorflow</code>. To
install keras you need to</p>
<ol style="list-style-type: decimal">
<li>have a working Python installation,</li>
<li>install the keras R package <code>install.packages("keras")</code>, and</li>
<li>install the tensorflow/keras Python modules with
<code><a href="https://tensorflow.rstudio.com/">library(keras); install_keras()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/">keras</a></span><span class="op">)</span></span></code></pre></div>
<p>Prepare the data. All data needs to be in a matrix of all
numeric/integer values. The class variable needs to be one-hot encoded and the
the <code>keras</code> function <code><a href="https://rdrr.io/pkg/keras/man/to_categorical.html">to_categorical()</a></code> expects a class index starting with 0
instead of 1.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co">##      hair feathers eggs milk airborne aquatic predator toothed</span></span>
<span><span class="co">## [1,]    1        0    0    1        0       0        0       1</span></span>
<span><span class="co">## [2,]    0        0    1    0        0       1        1       1</span></span>
<span><span class="co">## [3,]    1        0    0    1        0       0        1       1</span></span>
<span><span class="co">## [4,]    1        0    0    1        0       0        1       1</span></span>
<span><span class="co">## [5,]    1        0    0    1        0       0        0       1</span></span>
<span><span class="co">## [6,]    1        0    0    1        0       0        0       1</span></span>
<span><span class="co">##      backbone breathes venomous fins legs tail domestic catsize</span></span>
<span><span class="co">## [1,]        1        1        0    0    4    1        0       1</span></span>
<span><span class="co">## [2,]        1        0        0    1    0    1        0       0</span></span>
<span><span class="co">## [3,]        1        1        0    0    4    0        0       1</span></span>
<span><span class="co">## [4,]        1        1        0    0    4    1        0       1</span></span>
<span><span class="co">## [5,]        1        1        0    0    4    1        0       1</span></span>
<span><span class="co">## [6,]        1        1        0    0    4    1        1       1</span></span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="op">{</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co">## make index start with 0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/to_categorical.html">to_categorical</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">## [1,]    1    0    0    0    0    0    0</span></span>
<span><span class="co">## [2,]    0    0    0    1    0    0    0</span></span>
<span><span class="co">## [3,]    1    0    0    0    0    0    0</span></span>
<span><span class="co">## [4,]    1    0    0    0    0    0    0</span></span>
<span><span class="co">## [5,]    1    0    0    0    0    0    0</span></span>
<span><span class="co">## [6,]    1    0    0    0    0    0    0</span></span></code></pre></div>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="va">Zoo_test</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">Zoo_test</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="op">{</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">}</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/to_categorical.html">to_categorical</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Deep learning uses a large set of hyper-parameters. Choices are the
activation function, number of layers, number of units per layer, the
optimizer, and the type of regularization used.</p>
<p>We define here a simple network with a single dense hidden layer.
Note that in keras, we have to specify the input size in this first dense layer.
The output of the classifier is a categorical class value, therefore
we use for the output layer the softmax activation function, and for
training we specify
categorical cross-entropy as the loss function, and accuracy
as an additional metric.
Also, L2 regularization is used for the weights of the hidden layer to
reduce overfitting.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              name <span class="op">=</span> <span class="st">"single_hidden_layer_classifier"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">10</span>, activation <span class="op">=</span> <span class="st">'relu'</span>, </span>
<span>              kernel_regularizer<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/regularizer_l1.html">regularizer_l2</a></span><span class="op">(</span>l<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"hidden1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, activation <span class="op">=</span> <span class="st">'softmax'</span>, name <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span>
<span><span class="co">## Model: "single_hidden_layer_classifier"</span></span>
<span><span class="co">## ______________________________________________________________________</span></span>
<span><span class="co">##  Layer (type)                  Output Shape                Param #    </span></span>
<span><span class="co">## ======================================================================</span></span>
<span><span class="co">##  hidden1 (Dense)               (None, 10)                  170        </span></span>
<span><span class="co">##  output (Dense)                (None, 7)                   77         </span></span>
<span><span class="co">## ======================================================================</span></span>
<span><span class="co">## Total params: 247</span></span>
<span><span class="co">## Trainable params: 247</span></span>
<span><span class="co">## Non-trainable params: 0</span></span>
<span><span class="co">## ______________________________________________________________________</span></span></code></pre></div>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html">compile</a></span><span class="op">(</span>loss <span class="op">=</span> <span class="st">'categorical_crossentropy'</span>, </span>
<span>          optimizer <span class="op">=</span> <span class="st">'adam'</span>, </span>
<span>          metrics <span class="op">=</span> <span class="st">'accuracy'</span><span class="op">)</span></span></code></pre></div>
<p>For model training, we need to specify the batch size and the number of
training epochs. The fitting process can also use a fraction of the
training data for validation to provide generalization loss/accuracy.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html">fit</a></span><span class="op">(</span></span>
<span>    <span class="va">X</span>, </span>
<span>    <span class="va">y</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    epochs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    validation_split <span class="op">=</span> <span class="fl">.2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-187-1.png" width="672"></div>
<p>To create predictions from the model, we have to convert the one-hot
encoding back to class labels.</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">X_test</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>MARGIN <span class="op">=</span> <span class="fl">1</span>, FUN <span class="op">=</span> <span class="va">which.max</span><span class="op">)</span></span>
<span><span class="co">## 1/1 - 0s - 47ms/epoch - 47ms/step</span></span></code></pre></div>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pr</span>, labels <span class="op">=</span> <span class="va">class_labels</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">class_labels</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pr</span></span>
<span><span class="co">##  [1] mammal fish   fish   fish   mammal insect mammal mammal mammal</span></span>
<span><span class="co">## [10] mammal bird   mammal mammal bird   bird   bird   bird   bird  </span></span>
<span><span class="co">## 7 Levels: mammal bird reptile fish amphibian ... mollusc.et.al</span></span></code></pre></div>
</div>
<div id="support-vector-machines" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Support Vector Machines<a class="anchor" aria-label="anchor" href="#support-vector-machines"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svmFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span><span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svmLinear"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>    tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">svmFit</span></span>
<span><span class="co">## Support Vector Machines with Linear Kernel </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa </span></span>
<span><span class="co">##   0.9356    0.9173</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'C' was held constant at a value of 1</span></span></code></pre></div>
<p>We use a linear support vector machine.
Support vector machines can use kernels to create non-linear decision boundaries.
<code>method</code> above can be changed to <code>"svmPoly"</code> or <code>"svmRadial"</code> to
use kernels. The choice of kernel is typically make by experimentation.</p>
<p>The support vectors determining the decision boundary are stored in the model.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svmFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## Support Vector Machine object of class "ksvm" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## SV type: C-svc  (classification) </span></span>
<span><span class="co">##  parameter : cost C = 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Linear (vanilla) kernel function. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Support Vectors : 42 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Objective Function Value : -0.1432 -0.22 -0.1501 -0.1756 -0.0943 -0.1047 -0.2804 -0.0808 -0.1544 -0.0902 -0.1138 -0.1727 -0.5886 -0.1303 -0.1847 -0.1161 -0.0472 -0.0803 -0.125 -0.15 -0.5704 </span></span>
<span><span class="co">## Training error : 0</span></span></code></pre></div>
</div>
<div id="ensemble-methods" class="section level2" number="4.10">
<h2>
<span class="header-section-number">4.10</span> Ensemble Methods<a class="anchor" aria-label="anchor" href="#ensemble-methods"><i class="fas fa-link"></i></a>
</h2>
<p>Many ensemble methods are available in R. We only cover here code for two
popular methods.</p>
<div id="random-forest" class="section level3" number="4.10.1">
<h3>
<span class="header-section-number">4.10.1</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">randomForestFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>    tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">randomForestFit</span></span>
<span><span class="co">## Random Forest </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   mtry  Accuracy  Kappa </span></span>
<span><span class="co">##    2    0.9331    0.9136</span></span>
<span><span class="co">##    5    0.9356    0.9168</span></span>
<span><span class="co">##    9    0.9467    0.9313</span></span>
<span><span class="co">##   12    0.9467    0.9316</span></span>
<span><span class="co">##   16    0.9467    0.9311</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final value used for the model was mtry = 9.</span></span></code></pre></div>
<p>The default number of trees is 500 and
<code>mtry</code> determines the number of variables randomly sampled as candidates
at each split. This number is a tradeoff where a larger number allows each tree
to pick better splits, but a smaller
number increases the independence between trees.</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">randomForestFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##  randomForest(x = x, y = y, mtry = param$mtry) </span></span>
<span><span class="co">##                Type of random forest: classification</span></span>
<span><span class="co">##                      Number of trees: 500</span></span>
<span><span class="co">## No. of variables tried at each split: 9</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##         OOB estimate of  error rate: 7.23%</span></span>
<span><span class="co">## Confusion matrix:</span></span>
<span><span class="co">##               mammal bird reptile fish amphibian insect mollusc.et.al</span></span>
<span><span class="co">## mammal            33    0       0    0         0      0             0</span></span>
<span><span class="co">## bird               0   16       0    0         0      0             0</span></span>
<span><span class="co">## reptile            0    0       2    1         1      0             0</span></span>
<span><span class="co">## fish               0    0       0   11         0      0             0</span></span>
<span><span class="co">## amphibian          0    0       1    0         3      0             0</span></span>
<span><span class="co">## insect             0    0       0    0         0      6             1</span></span>
<span><span class="co">## mollusc.et.al      0    0       1    0         0      1             6</span></span>
<span><span class="co">##               class.error</span></span>
<span><span class="co">## mammal             0.0000</span></span>
<span><span class="co">## bird               0.0000</span></span>
<span><span class="co">## reptile            0.5000</span></span>
<span><span class="co">## fish               0.0000</span></span>
<span><span class="co">## amphibian          0.2500</span></span>
<span><span class="co">## insect             0.1429</span></span>
<span><span class="co">## mollusc.et.al      0.2500</span></span></code></pre></div>
<p>The model is a set of 500 trees and the prediction is made by applying all trees and
then using the majority vote.</p>
<p>Since random forests use bagging (bootstrap sampling to train trees),
the remaining data can be used like a test set. The resulting error
is called out-of-bag (OOB) error and gives an estimate for the
generalization error. The model above also shows the confusion matrix based on
the OOB error.</p>
</div>
<div id="gradient-boosted-decision-trees-xgboost" class="section level3" number="4.10.2">
<h3>
<span class="header-section-number">4.10.2</span> Gradient Boosted Decision Trees (xgboost)<a class="anchor" aria-label="anchor" href="#gradient-boosted-decision-trees-xgboost"><i class="fas fa-link"></i></a>
</h3>
<p>The idea of gradient boosting is to learn a base model and then to learn
successive models to predict and correct the error of all previous models.
Typically, tree models are used.</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgboostFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"xgbTree"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  tuneLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span>,</span>
<span>  tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>    nrounds <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colsample_bytree <span class="op">=</span> <span class="fl">.6</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    gamma<span class="op">=</span><span class="fl">0</span>,</span>
<span>    min_child_weight <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">.5</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xgboostFit</span></span>
<span><span class="co">## eXtreme Gradient Boosting </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa </span></span>
<span><span class="co">##   0.9442    0.9267</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'nrounds' was held constant at a value of 20</span></span>
<span><span class="co">##  a value of 1</span></span>
<span><span class="co">## Tuning parameter 'subsample' was held constant at</span></span>
<span><span class="co">##  a value of 0.5</span></span></code></pre></div>
<p>The final model is a complicated set of trees, so only some summary information
is shown.</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgboostFit</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co">## ##### xgb.Booster</span></span>
<span><span class="co">## raw: 111.6 Kb </span></span>
<span><span class="co">## call:</span></span>
<span><span class="co">##   xgboost::xgb.train(params = list(eta = param$eta, max_depth = param$max_depth, </span></span>
<span><span class="co">##     gamma = param$gamma, colsample_bytree = param$colsample_bytree, </span></span>
<span><span class="co">##     min_child_weight = param$min_child_weight, subsample = param$subsample), </span></span>
<span><span class="co">##     data = x, nrounds = param$nrounds, num_class = length(lev), </span></span>
<span><span class="co">##     objective = "multi:softprob")</span></span>
<span><span class="co">## params (as set within xgb.train):</span></span>
<span><span class="co">##   eta = "0.1", max_depth = "3", gamma = "0", colsample_bytree = "0.6", min_child_weight = "1", subsample = "0.5", num_class = "7", objective = "multi:softprob", validate_parameters = "TRUE"</span></span>
<span><span class="co">## xgb.attributes:</span></span>
<span><span class="co">##   niter</span></span>
<span><span class="co">## callbacks:</span></span>
<span><span class="co">##   cb.print.evaluation(period = print_every_n)</span></span>
<span><span class="co">## # of features: 16 </span></span>
<span><span class="co">## niter: 20</span></span>
<span><span class="co">## nfeatures : 16 </span></span>
<span><span class="co">## xNames : hairTRUE feathersTRUE eggsTRUE milkTRUE airborneTRUE aquaticTRUE predatorTRUE toothedTRUE backboneTRUE breathesTRUE venomousTRUE finsTRUE legs tailTRUE domesticTRUE catsizeTRUE </span></span>
<span><span class="co">## problemType : Classification </span></span>
<span><span class="co">## tuneValue :</span></span>
<span><span class="co">##    nrounds max_depth eta gamma colsample_bytree min_child_weight</span></span>
<span><span class="co">## 1      20         3 0.1     0              0.6                1</span></span>
<span><span class="co">##   subsample</span></span>
<span><span class="co">## 1       0.5</span></span>
<span><span class="co">## obsLevels : mammal bird reptile fish amphibian insect mollusc.et.al </span></span>
<span><span class="co">## param :</span></span>
<span><span class="co">##  list()</span></span></code></pre></div>
</div>
</div>
<div id="class-imbalance" class="section level2" number="4.11">
<h2>
<span class="header-section-number">4.11</span> Class Imbalance<a class="anchor" aria-label="anchor" href="#class-imbalance"><i class="fas fa-link"></i></a>
</h2>
<p>Classifiers have a hard time to learn from data where we have much more
observations for one class (called the majority class). This is called
the class imbalance problem.</p>
<p>Here is a very good <a href="http://www.kdnuggets.com/2016/08/learning-from-imbalanced-classes.html">article about the problem and
solutions.</a></p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Zoo</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span></code></pre></div>
<p>Class distribution</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Zoo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-196-1.png" width="672"></div>
<p>To create an imbalanced problem, we want to decide if an animal is an
reptile. First, we change the class variable to make it into a binary
reptile/no reptile classification problem. <strong>Note:</strong> We use here the
training data for testing. You should use a separate testing data set!</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Zoo_reptile</span> <span class="op">&lt;-</span> <span class="va">Zoo</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Zoo</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"reptile"</span>, </span>
<span>                       levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nonreptile"</span>, <span class="st">"reptile"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Do not forget to make the class variable a factor (a nominal variable)
or you will get a regression tree instead of a classification tree.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Zoo_reptile</span><span class="op">)</span></span>
<span><span class="co">##     hair          feathers          eggs            milk        </span></span>
<span><span class="co">##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  </span></span>
<span><span class="co">##  FALSE:58        FALSE:81        FALSE:42        FALSE:60       </span></span>
<span><span class="co">##  TRUE :43        TRUE :20        TRUE :59        TRUE :41       </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##   airborne        aquatic         predator        toothed       </span></span>
<span><span class="co">##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  </span></span>
<span><span class="co">##  FALSE:77        FALSE:65        FALSE:45        FALSE:40       </span></span>
<span><span class="co">##  TRUE :24        TRUE :36        TRUE :56        TRUE :61       </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##   backbone        breathes        venomous          fins        </span></span>
<span><span class="co">##  Mode :logical   Mode :logical   Mode :logical   Mode :logical  </span></span>
<span><span class="co">##  FALSE:18        FALSE:21        FALSE:93        FALSE:84       </span></span>
<span><span class="co">##  TRUE :83        TRUE :80        TRUE :8         TRUE :17       </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##                                                                 </span></span>
<span><span class="co">##       legs         tail          domestic        catsize       </span></span>
<span><span class="co">##  Min.   :0.00   Mode :logical   Mode :logical   Mode :logical  </span></span>
<span><span class="co">##  1st Qu.:2.00   FALSE:26        FALSE:88        FALSE:57       </span></span>
<span><span class="co">##  Median :4.00   TRUE :75        TRUE :13        TRUE :44       </span></span>
<span><span class="co">##  Mean   :2.84                                                  </span></span>
<span><span class="co">##  3rd Qu.:4.00                                                  </span></span>
<span><span class="co">##  Max.   :8.00                                                  </span></span>
<span><span class="co">##          type   </span></span>
<span><span class="co">##  nonreptile:96  </span></span>
<span><span class="co">##  reptile   : 5  </span></span>
<span><span class="co">##                 </span></span>
<span><span class="co">##                 </span></span>
<span><span class="co">##                 </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p>See if we have a class imbalance problem.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Zoo_reptile</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-199-1.png" width="672"></div>
<p>Create test and training data. I use here a 50/50 split to make sure
that the test set has some samples of the rare reptile class.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inTrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Zoo_reptile</span><span class="op">$</span><span class="va">type</span>, p <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">training_reptile</span> <span class="op">&lt;-</span> <span class="va">Zoo_reptile</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">inTrain</span><span class="op">)</span></span>
<span><span class="va">testing_reptile</span> <span class="op">&lt;-</span> <span class="va">Zoo_reptile</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="va">inTrain</span><span class="op">)</span></span></code></pre></div>
<p>the new class variable is clearly not balanced. This is a problem for
building a tree!</p>
<div id="option-1-use-the-data-as-is-and-hope-for-the-best" class="section level3" number="4.11.1">
<h3>
<span class="header-section-number">4.11.1</span> Option 1: Use the Data As Is and Hope For The Best<a class="anchor" aria-label="anchor" href="#option-1-use-the-data-as-is-and-hope-for-the-best"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">training_reptile</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info =</span></span>
<span><span class="co">## trainInfo, : There were missing values in resampled performance</span></span>
<span><span class="co">## measures.</span></span></code></pre></div>
<p><strong>Warnings:</strong> “There were missing values in resampled performance
measures.” means that some test folds did not contain examples of both
classes. This is very likely with class imbalance and small datasets.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 51 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  2 classes: 'nonreptile', 'reptile' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 46, 47, 46, 46, 45, 46, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa</span></span>
<span><span class="co">##   0.9467    0    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'cp' was held constant at a value of 0</span></span></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-202-1.png" width="672"></div>
<p>the tree predicts everything as non-reptile. Have a look at the error on
the test set.</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span><span class="op">)</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         48       2</span></span>
<span><span class="co">##   reptile             0       0</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.96          </span></span>
<span><span class="co">##                  95% CI : (0.863, 0.995)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 0.677         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0             </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 0.480         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 0.00          </span></span>
<span><span class="co">##             Specificity : 1.00          </span></span>
<span><span class="co">##          Pos Pred Value :  NaN          </span></span>
<span><span class="co">##          Neg Pred Value : 0.96          </span></span>
<span><span class="co">##              Prevalence : 0.04          </span></span>
<span><span class="co">##          Detection Rate : 0.00          </span></span>
<span><span class="co">##    Detection Prevalence : 0.00          </span></span>
<span><span class="co">##       Balanced Accuracy : 0.50          </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p>Accuracy is high, but it is exactly the same as the no-information rate
and kappa is zero. Sensitivity is also zero, meaning that we do not
identify any positive (reptile). If the cost of missing a positive is
much larger than the cost associated with misclassifying a negative,
then accuracy is not a good measure! By dealing with imbalance, we are
<strong>not</strong> concerned with accuracy, but we want to increase the
sensitivity, i.e., the chance to identify positive examples.</p>
<p><strong>Note:</strong> The positive class value (the one that you want to detect) is
set manually to reptile using <code>positive = "reptile"</code>. Otherwise
sensitivity/specificity will not be correctly calculated.</p>
</div>
<div id="option-2-balance-data-with-resampling" class="section level3" number="4.11.2">
<h3>
<span class="header-section-number">4.11.2</span> Option 2: Balance Data With Resampling<a class="anchor" aria-label="anchor" href="#option-2-balance-data-with-resampling"><i class="fas fa-link"></i></a>
</h3>
<p>We use stratified sampling with replacement (to oversample the
minority/positive class). You could also use SMOTE (in package <strong>DMwR</strong>)
or other sampling strategies (e.g., from package <strong>unbalanced</strong>). We use
50+50 observations here (<strong>Note:</strong> many samples will be chosen several
times).</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sampling</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># for repeatability</span></span>
<span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sampling/man/strata.html">strata</a></span><span class="op">(</span><span class="va">training_reptile</span>, stratanames <span class="op">=</span> <span class="st">"type"</span>, </span>
<span>             size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"srswr"</span><span class="op">)</span></span>
<span><span class="va">training_reptile_balanced</span> <span class="op">&lt;-</span> <span class="va">training_reptile</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">ID_unit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">training_reptile_balanced</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## nonreptile    reptile </span></span>
<span><span class="co">##         50         50</span></span></code></pre></div>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">training_reptile_balanced</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 100 samples</span></span>
<span><span class="co">##  16 predictor</span></span>
<span><span class="co">##   2 classes: 'nonreptile', 'reptile' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 90, 90, 90, 90, 90, 90, ... </span></span>
<span><span class="co">## Resampling results across tuning parameters:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   cp    Accuracy  Kappa</span></span>
<span><span class="co">##   0.18  0.81      0.62 </span></span>
<span><span class="co">##   0.30  0.63      0.26 </span></span>
<span><span class="co">##   0.34  0.53      0.06 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy was used to select the optimal model using the</span></span>
<span><span class="co">##  largest value.</span></span>
<span><span class="co">## The final value used for the model was cp = 0.18.</span></span></code></pre></div>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-204-1.png" width="672"></div>
<p>Check on the unbalanced testing data.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span><span class="op">)</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         19       0</span></span>
<span><span class="co">##   reptile            29       2</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.42          </span></span>
<span><span class="co">##                  95% CI : (0.282, 0.568)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 1             </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0.05          </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 2e-07         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 1.0000        </span></span>
<span><span class="co">##             Specificity : 0.3958        </span></span>
<span><span class="co">##          Pos Pred Value : 0.0645        </span></span>
<span><span class="co">##          Neg Pred Value : 1.0000        </span></span>
<span><span class="co">##              Prevalence : 0.0400        </span></span>
<span><span class="co">##          Detection Rate : 0.0400        </span></span>
<span><span class="co">##    Detection Prevalence : 0.6200        </span></span>
<span><span class="co">##       Balanced Accuracy : 0.6979        </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p><strong>Note</strong> that the accuracy is below the no information rate! However,
kappa (improvement of accuracy over randomness) and sensitivity (the
ability to identify reptiles) have increased.</p>
<p>There is a tradeoff between sensitivity and specificity (how many of the
identified animals are really reptiles) The tradeoff can be controlled
using the sample proportions. We can sample more reptiles to increase
sensitivity at the cost of lower specificity (this effect cannot be seen
in the data since the test set has only a few reptiles).</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sampling/man/strata.html">strata</a></span><span class="op">(</span><span class="va">training_reptile</span>, stratanames <span class="op">=</span> <span class="st">"type"</span>, </span>
<span>             size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"srswr"</span><span class="op">)</span></span>
<span><span class="va">training_reptile_balanced</span> <span class="op">&lt;-</span> <span class="va">training_reptile</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">ID_unit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">training_reptile_balanced</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## nonreptile    reptile </span></span>
<span><span class="co">##         50        100</span></span></code></pre></div>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">training_reptile_balanced</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span><span class="op">)</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         33       0</span></span>
<span><span class="co">##   reptile            15       2</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.7           </span></span>
<span><span class="co">##                  95% CI : (0.554, 0.821)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 1.000000      </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0.15          </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 0.000301      </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 1.000         </span></span>
<span><span class="co">##             Specificity : 0.688         </span></span>
<span><span class="co">##          Pos Pred Value : 0.118         </span></span>
<span><span class="co">##          Neg Pred Value : 1.000         </span></span>
<span><span class="co">##              Prevalence : 0.040         </span></span>
<span><span class="co">##          Detection Rate : 0.040         </span></span>
<span><span class="co">##    Detection Prevalence : 0.340         </span></span>
<span><span class="co">##       Balanced Accuracy : 0.844         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
</div>
<div id="option-3-build-a-larger-tree-and-use-predicted-probabilities" class="section level3" number="4.11.3">
<h3>
<span class="header-section-number">4.11.3</span> Option 3: Build A Larger Tree and use Predicted Probabilities<a class="anchor" aria-label="anchor" href="#option-3-build-a-larger-tree-and-use-predicted-probabilities"><i class="fas fa-link"></i></a>
</h3>
<p>Increase complexity and require less data for splitting a node. Here I
also use AUC (area under the ROC) as the tuning metric. You need to
specify the two class summary function. Note that the tree still trying
to improve accuracy on the data and not AUC! I also enable class
probabilities since I want to predict probabilities later.</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">training_reptile</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        tuneLength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>,</span>
<span>        classProbs <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co">## necessary for predict with type="prob"</span></span>
<span>        summaryFunction<span class="op">=</span><span class="va">twoClassSummary</span><span class="op">)</span>,  <span class="co">## necessary for ROC</span></span>
<span>        metric <span class="op">=</span> <span class="st">"ROC"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info =</span></span>
<span><span class="co">## trainInfo, : There were missing values in resampled performance</span></span>
<span><span class="co">## measures.</span></span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 51 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  2 classes: 'nonreptile', 'reptile' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 46, 47, 46, 46, 46, 45, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   ROC     Sens   Spec</span></span>
<span><span class="co">##   0.3583  0.975  0   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'cp' was held constant at a value of 0</span></span></code></pre></div>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-207-1.png" width="672"></div>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span><span class="op">)</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         48       2</span></span>
<span><span class="co">##   reptile             0       0</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.96          </span></span>
<span><span class="co">##                  95% CI : (0.863, 0.995)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 0.677         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0             </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 0.480         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 0.00          </span></span>
<span><span class="co">##             Specificity : 1.00          </span></span>
<span><span class="co">##          Pos Pred Value :  NaN          </span></span>
<span><span class="co">##          Neg Pred Value : 0.96          </span></span>
<span><span class="co">##              Prevalence : 0.04          </span></span>
<span><span class="co">##          Detection Rate : 0.00          </span></span>
<span><span class="co">##    Detection Prevalence : 0.00          </span></span>
<span><span class="co">##       Balanced Accuracy : 0.50          </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p><strong>Note:</strong> Accuracy is high, but it is close or below to the
no-information rate!</p>
<div id="create-a-biased-classifier" class="section level4" number="4.11.3.1">
<h4>
<span class="header-section-number">4.11.3.1</span> Create A Biased Classifier<a class="anchor" aria-label="anchor" href="#create-a-biased-classifier"><i class="fas fa-link"></i></a>
</h4>
<p>We can create a classifier which will detect more reptiles at the
expense of misclassifying non-reptiles. This is equivalent to increasing
the cost of misclassifying a reptile as a non-reptile. The usual rule is
to predict in each node the majority class from the test data in the
node. For a binary classification problem that means a probability of
&gt;50%. In the following, we reduce this threshold to 1% or more. This
means that if the new observation ends up in a leaf node with 1% or more
reptiles from training then the observation will be classified as a
reptile. The data set is small and this works better with more data.</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span><span class="co">##      nonreptile reptile</span></span>
<span><span class="co">## tuna     1.0000 0.00000</span></span>
<span><span class="co">## vole     0.9615 0.03846</span></span>
<span><span class="co">## wasp     0.5000 0.50000</span></span>
<span><span class="co">## wolf     0.9615 0.03846</span></span>
<span><span class="co">## worm     1.0000 0.00000</span></span>
<span><span class="co">## wren     0.9615 0.03846</span></span></code></pre></div>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">prob</span><span class="op">[</span>,<span class="st">"reptile"</span><span class="op">]</span><span class="op">&gt;=</span><span class="fl">0.01</span>, <span class="st">"reptile"</span>, <span class="st">"nonreptile"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pred</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         13       0</span></span>
<span><span class="co">##   reptile            35       2</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.3           </span></span>
<span><span class="co">##                  95% CI : (0.179, 0.446)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 1             </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0.029         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 9.08e-09      </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 1.0000        </span></span>
<span><span class="co">##             Specificity : 0.2708        </span></span>
<span><span class="co">##          Pos Pred Value : 0.0541        </span></span>
<span><span class="co">##          Neg Pred Value : 1.0000        </span></span>
<span><span class="co">##              Prevalence : 0.0400        </span></span>
<span><span class="co">##          Detection Rate : 0.0400        </span></span>
<span><span class="co">##    Detection Prevalence : 0.7400        </span></span>
<span><span class="co">##       Balanced Accuracy : 0.6354        </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p><strong>Note</strong> that accuracy goes down and is below the no information rate.
However, both measures are based on the idea that all errors have the
same cost. What is important is that we are now able to find more
reptiles.</p>
</div>
<div id="plot-the-roc-curve" class="section level4" number="4.11.3.2">
<h4>
<span class="header-section-number">4.11.3.2</span> Plot the ROC Curve<a class="anchor" aria-label="anchor" href="#plot-the-roc-curve"><i class="fas fa-link"></i></a>
</h4>
<p>Since we have a binary classification problem and a classifier that
predicts a probability for an observation to be a reptile, we can also
use a <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">receiver operating characteristic
(ROC)</a>
curve. For the ROC curve all different cutoff thresholds for the
probability are used and then connected with a line. The area under the
curve represents a single number for how well the classifier works (the
closer to one, the better).</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://xrobin.github.io/pROC/">"pROC"</a></span><span class="op">)</span></span>
<span><span class="co">## Type 'citation("pROC")' for a citation.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'pROC'</span></span>
<span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     cov, smooth, var</span></span></code></pre></div>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"reptile"</span>, <span class="va">prob</span><span class="op">[</span>,<span class="st">"reptile"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Setting levels: control = FALSE, case = TRUE</span></span>
<span><span class="co">## Setting direction: controls &lt; cases</span></span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## roc.default(response = testing_reptile$type == "reptile", predictor = prob[,     "reptile"])</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Data: prob[, "reptile"] in 48 controls (testing_reptile$type == "reptile" FALSE) &lt; 2 cases (testing_reptile$type == "reptile" TRUE).</span></span>
<span><span class="co">## Area under the curve: 0.766</span></span></code></pre></div>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/ggroc.html">ggroc</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-209-1.png" width="672"></div>
</div>
</div>
<div id="option-4-use-a-cost-sensitive-classifier" class="section level3" number="4.11.4">
<h3>
<span class="header-section-number">4.11.4</span> Option 4: Use a Cost-Sensitive Classifier<a class="anchor" aria-label="anchor" href="#option-4-use-a-cost-sensitive-classifier"><i class="fas fa-link"></i></a>
</h3>
<p>The implementation of CART in <code>rpart</code> can use a cost matrix for making
splitting decisions (as parameter <code>loss</code>). The matrix has the form</p>
<p>TP FP FN TN</p>
<p>TP and TN have to be 0. We make FN very expensive (100).</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0</span>,   <span class="fl">1</span>,</span>
<span>  <span class="fl">100</span>, <span class="fl">0</span></span>
<span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cost</span></span>
<span><span class="co">##      [,1] [,2]</span></span>
<span><span class="co">## [1,]    0    1</span></span>
<span><span class="co">## [2,]  100    0</span></span></code></pre></div>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">training_reptile</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        data <span class="op">=</span> <span class="va">_</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>loss <span class="op">=</span> <span class="va">cost</span><span class="op">)</span>,</span>
<span>        trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The warning “There were missing values in resampled performance
measures” means that some folds did not contain any reptiles (because of
the class imbalance) and thus the performance measures could not be
calculates.</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">## CART </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 51 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  2 classes: 'nonreptile', 'reptile' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 46, 46, 46, 45, 46, 45, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa   </span></span>
<span><span class="co">##   0.4767    -0.03039</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tuning parameter 'cp' was held constant at a value of 0</span></span></code></pre></div>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">finalModel</span>, extra <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-211-1.png" width="672"></div>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">testing_reptile</span><span class="op">)</span>,</span>
<span>                ref <span class="op">=</span> <span class="va">testing_reptile</span><span class="op">$</span><span class="va">type</span>, positive <span class="op">=</span> <span class="st">"reptile"</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Reference</span></span>
<span><span class="co">## Prediction   nonreptile reptile</span></span>
<span><span class="co">##   nonreptile         39       0</span></span>
<span><span class="co">##   reptile             9       2</span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                Accuracy : 0.82          </span></span>
<span><span class="co">##                  95% CI : (0.686, 0.914)</span></span>
<span><span class="co">##     No Information Rate : 0.96          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 0.99998       </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##                   Kappa : 0.257         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : 0.00766       </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##             Sensitivity : 1.000         </span></span>
<span><span class="co">##             Specificity : 0.812         </span></span>
<span><span class="co">##          Pos Pred Value : 0.182         </span></span>
<span><span class="co">##          Neg Pred Value : 1.000         </span></span>
<span><span class="co">##              Prevalence : 0.040         </span></span>
<span><span class="co">##          Detection Rate : 0.040         </span></span>
<span><span class="co">##    Detection Prevalence : 0.220         </span></span>
<span><span class="co">##       Balanced Accuracy : 0.906         </span></span>
<span><span class="co">##                                         </span></span>
<span><span class="co">##        'Positive' Class : reptile       </span></span>
<span><span class="co">## </span></span></code></pre></div>
<p>The high cost for false negatives results in a classifier that does not
miss any reptile.</p>
<p><strong>Note:</strong> Using a cost-sensitive classifier is often the best option.
Unfortunately, the most classification algorithms (or their
implementation) do not have the ability to consider misclassification
cost.</p>
</div>
</div>
<div id="model-comparison-1" class="section level2" number="4.12">
<h2>
<span class="header-section-number">4.12</span> Model Comparison<a class="anchor" aria-label="anchor" href="#model-comparison-1"><i class="fas fa-link"></i></a>
</h2>
<p>We first create a weak baseline model that always predicts the the majority
class mammal.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baselineFit</span> <span class="op">&lt;-</span> <span class="va">Zoo_train</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">type</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  method <span class="op">=</span> <span class="fu">basemodels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/basemodels/man/dummyClassifier.html">dummyClassifier</a></span>,</span>
<span>  data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  constant <span class="op">=</span> <span class="st">"mammal"</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, index <span class="op">=</span> <span class="va">train_index</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">baselineFit</span></span>
<span><span class="co">## dummyClassifier </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 83 samples</span></span>
<span><span class="co">## 16 predictors</span></span>
<span><span class="co">##  7 classes: 'mammal', 'bird', 'reptile', 'fish', 'amphibian', 'insect', 'mollusc.et.al' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No pre-processing</span></span>
<span><span class="co">## Resampling: Cross-Validated (10 fold) </span></span>
<span><span class="co">## Summary of sample sizes: 74, 75, 75, 75, 75, 74, ... </span></span>
<span><span class="co">## Resampling results:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Accuracy  Kappa</span></span>
<span><span class="co">##   0.4011    0</span></span></code></pre></div>
<p>The kappa of 0 clearly indicates that the baseline model has no power.</p>
<p>We collect the performance metrics from the models trained on the same
data.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  baseline <span class="op">=</span> <span class="va">baselineFit</span>,</span>
<span>  SVM <span class="op">=</span> <span class="va">svmFit</span>,</span>
<span>  KNN <span class="op">=</span> <span class="va">knnFit</span>,</span>
<span>  rules <span class="op">=</span> <span class="va">rulesFit</span>,</span>
<span>  randomForest <span class="op">=</span> <span class="va">randomForestFit</span>,</span>
<span>  xgboost <span class="op">=</span> <span class="va">xgboostFit</span>,</span>
<span>  NeuralNet <span class="op">=</span> <span class="va">nnetFit</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">resamps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## resamples.default(x = list(baseline = baselineFit, SVM = svmFit,</span></span>
<span><span class="co">##  KNN = knnFit, rules = rulesFit, randomForest =</span></span>
<span><span class="co">##  randomForestFit, xgboost = xgboostFit, NeuralNet = nnetFit))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Models: baseline, SVM, KNN, rules, randomForest, xgboost, NeuralNet </span></span>
<span><span class="co">## Number of resamples: 10 </span></span>
<span><span class="co">## Performance metrics: Accuracy, Kappa </span></span>
<span><span class="co">## Time estimates for: everything, final model fit</span></span></code></pre></div>
<p>The summary statistics shows the performance. We see that all
methods do well on this easy data set, only the baseline model performs
as expected poorly.</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">resamps</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## summary.resamples(object = resamps)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Models: baseline, SVM, KNN, rules, randomForest, xgboost, NeuralNet </span></span>
<span><span class="co">## Number of resamples: 10 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy </span></span>
<span><span class="co">##                Min. 1st Qu. Median   Mean 3rd Qu. Max. NA's</span></span>
<span><span class="co">## baseline     0.3333  0.3750  0.375 0.4011  0.4333  0.5    0</span></span>
<span><span class="co">## SVM          0.7778  0.8889  1.000 0.9356  1.0000  1.0    0</span></span>
<span><span class="co">## KNN          0.7778  0.8785  1.000 0.9342  1.0000  1.0    0</span></span>
<span><span class="co">## rules        0.7778  0.9250  1.000 0.9567  1.0000  1.0    0</span></span>
<span><span class="co">## randomForest 0.8000  0.8889  1.000 0.9467  1.0000  1.0    0</span></span>
<span><span class="co">## xgboost      0.7778  0.8917  1.000 0.9442  1.0000  1.0    0</span></span>
<span><span class="co">## NeuralNet    0.7778  0.8917  1.000 0.9456  1.0000  1.0    0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Kappa </span></span>
<span><span class="co">##                Min. 1st Qu. Median   Mean 3rd Qu. Max. NA's</span></span>
<span><span class="co">## baseline     0.0000  0.0000      0 0.0000       0    0    0</span></span>
<span><span class="co">## SVM          0.7188  0.8534      1 0.9173       1    1    0</span></span>
<span><span class="co">## KNN          0.7143  0.8459      1 0.9158       1    1    0</span></span>
<span><span class="co">## rules        0.7188  0.9026      1 0.9439       1    1    0</span></span>
<span><span class="co">## randomForest 0.7403  0.8604      1 0.9313       1    1    0</span></span>
<span><span class="co">## xgboost      0.7143  0.8491      1 0.9267       1    1    0</span></span>
<span><span class="co">## NeuralNet    0.7143  0.8644      1 0.9295       1    1    0</span></span></code></pre></div>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html">bwplot</a></span><span class="op">(</span><span class="va">resamps</span>, layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-214-1.png" width="672"></div>
<p>Perform inference about differences between models. For each metric, all
pair-wise differences are computed and tested to assess if the
difference is equal to zero. By default Bonferroni correction for
multiple comparison is used. Differences are shown in the upper triangle
and p-values are in the lower triangle.</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">difs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">resamps</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">difs</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## summary.diff.resamples(object = difs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## p-value adjustment: bonferroni </span></span>
<span><span class="co">## Upper diagonal: estimates of the difference</span></span>
<span><span class="co">## Lower diagonal: p-value for H0: difference = 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Accuracy </span></span>
<span><span class="co">##              baseline SVM      KNN      rules    randomForest</span></span>
<span><span class="co">## baseline              -0.53444 -0.53306 -0.55556 -0.54556    </span></span>
<span><span class="co">## SVM          2.76e-07           0.00139 -0.02111 -0.01111    </span></span>
<span><span class="co">## KNN          9.97e-08 1                 -0.02250 -0.01250    </span></span>
<span><span class="co">## rules        1.48e-07 1        1                  0.01000    </span></span>
<span><span class="co">## randomForest 1.26e-07 1        1        1                    </span></span>
<span><span class="co">## xgboost      1.44e-07 1        1        1        1           </span></span>
<span><span class="co">## NeuralNet    6.35e-08 1        1        1        1           </span></span>
<span><span class="co">##              xgboost  NeuralNet</span></span>
<span><span class="co">## baseline     -0.54306 -0.54444 </span></span>
<span><span class="co">## SVM          -0.00861 -0.01000 </span></span>
<span><span class="co">## KNN          -0.01000 -0.01139 </span></span>
<span><span class="co">## rules         0.01250  0.01111 </span></span>
<span><span class="co">## randomForest  0.00250  0.00111 </span></span>
<span><span class="co">## xgboost               -0.00139 </span></span>
<span><span class="co">## NeuralNet    1                 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Kappa </span></span>
<span><span class="co">##              baseline SVM      KNN      rules    randomForest</span></span>
<span><span class="co">## baseline              -0.91726 -0.91582 -0.94389 -0.93133    </span></span>
<span><span class="co">## SVM          2.46e-08           0.00145 -0.02662 -0.01406    </span></span>
<span><span class="co">## KNN          2.81e-08 1                 -0.02807 -0.01551    </span></span>
<span><span class="co">## rules        4.69e-09 1        1                  0.01256    </span></span>
<span><span class="co">## randomForest 3.88e-09 1        1        1                    </span></span>
<span><span class="co">## xgboost      8.27e-09 1        1        1        1           </span></span>
<span><span class="co">## NeuralNet    6.49e-09 1        1        1        1           </span></span>
<span><span class="co">##              xgboost  NeuralNet</span></span>
<span><span class="co">## baseline     -0.92665 -0.92946 </span></span>
<span><span class="co">## SVM          -0.00939 -0.01219 </span></span>
<span><span class="co">## KNN          -0.01083 -0.01364 </span></span>
<span><span class="co">## rules         0.01724  0.01443 </span></span>
<span><span class="co">## randomForest  0.00468  0.00187 </span></span>
<span><span class="co">## xgboost               -0.00281 </span></span>
<span><span class="co">## NeuralNet    1</span></span></code></pre></div>
<p>All perform similarly well except the baseline model (differences in the first row
are negative and the p-values in the first column are &lt;.05 indicating
that the null-hypothesis of a difference of 0 can be rejected).</p>
<p>Most models do similarly well on the data. We choose here the random
forest model and evaluate its generalization performance on the held-out
test set.</p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">randomForestFit</span>, <span class="va">Zoo_test</span><span class="op">)</span></span>
<span><span class="va">pr</span></span>
<span><span class="co">##  [1] mammal        fish          mollusc.et.al fish         </span></span>
<span><span class="co">##  [5] mammal        insect        mammal        mammal       </span></span>
<span><span class="co">##  [9] mammal        mammal        bird          mammal       </span></span>
<span><span class="co">## [13] mammal        bird          reptile       bird         </span></span>
<span><span class="co">## [17] mollusc.et.al bird         </span></span>
<span><span class="co">## 7 Levels: mammal bird reptile fish amphibian ... mollusc.et.al</span></span></code></pre></div>
<p>Calculate the confusion matrix for the held-out test data.</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">pr</span>, reference <span class="op">=</span> <span class="va">Zoo_test</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mammal bird reptile fish amphibian insect</span></span>
<span><span class="co">##   mammal             8    0       0    0         0      0</span></span>
<span><span class="co">##   bird               0    4       0    0         0      0</span></span>
<span><span class="co">##   reptile            0    0       1    0         0      0</span></span>
<span><span class="co">##   fish               0    0       0    2         0      0</span></span>
<span><span class="co">##   amphibian          0    0       0    0         0      0</span></span>
<span><span class="co">##   insect             0    0       0    0         0      1</span></span>
<span><span class="co">##   mollusc.et.al      0    0       0    0         0      0</span></span>
<span><span class="co">##                Reference</span></span>
<span><span class="co">## Prediction      mollusc.et.al</span></span>
<span><span class="co">##   mammal                    0</span></span>
<span><span class="co">##   bird                      0</span></span>
<span><span class="co">##   reptile                   0</span></span>
<span><span class="co">##   fish                      0</span></span>
<span><span class="co">##   amphibian                 0</span></span>
<span><span class="co">##   insect                    0</span></span>
<span><span class="co">##   mollusc.et.al             2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##                Accuracy : 1         </span></span>
<span><span class="co">##                  95% CI : (0.815, 1)</span></span>
<span><span class="co">##     No Information Rate : 0.444     </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : 4.58e-07  </span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##                   Kappa : 1         </span></span>
<span><span class="co">##                                     </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: mammal Class: bird Class: reptile</span></span>
<span><span class="co">## Sensitivity                  1.000       1.000         1.0000</span></span>
<span><span class="co">## Specificity                  1.000       1.000         1.0000</span></span>
<span><span class="co">## Pos Pred Value               1.000       1.000         1.0000</span></span>
<span><span class="co">## Neg Pred Value               1.000       1.000         1.0000</span></span>
<span><span class="co">## Prevalence                   0.444       0.222         0.0556</span></span>
<span><span class="co">## Detection Rate               0.444       0.222         0.0556</span></span>
<span><span class="co">## Detection Prevalence         0.444       0.222         0.0556</span></span>
<span><span class="co">## Balanced Accuracy            1.000       1.000         1.0000</span></span>
<span><span class="co">##                      Class: fish Class: amphibian Class: insect</span></span>
<span><span class="co">## Sensitivity                1.000               NA        1.0000</span></span>
<span><span class="co">## Specificity                1.000                1        1.0000</span></span>
<span><span class="co">## Pos Pred Value             1.000               NA        1.0000</span></span>
<span><span class="co">## Neg Pred Value             1.000               NA        1.0000</span></span>
<span><span class="co">## Prevalence                 0.111                0        0.0556</span></span>
<span><span class="co">## Detection Rate             0.111                0        0.0556</span></span>
<span><span class="co">## Detection Prevalence       0.111                0        0.0556</span></span>
<span><span class="co">## Balanced Accuracy          1.000               NA        1.0000</span></span>
<span><span class="co">##                      Class: mollusc.et.al</span></span>
<span><span class="co">## Sensitivity                         1.000</span></span>
<span><span class="co">## Specificity                         1.000</span></span>
<span><span class="co">## Pos Pred Value                      1.000</span></span>
<span><span class="co">## Neg Pred Value                      1.000</span></span>
<span><span class="co">## Prevalence                          0.111</span></span>
<span><span class="co">## Detection Rate                      0.111</span></span>
<span><span class="co">## Detection Prevalence                0.111</span></span>
<span><span class="co">## Balanced Accuracy                   1.000</span></span></code></pre></div>
</div>
<div id="comparing-decision-boundaries-of-popular-classification-techniques" class="section level2" number="4.13">
<h2>
<span class="header-section-number">4.13</span> Comparing Decision Boundaries of Popular Classification Techniques*<a class="anchor" aria-label="anchor" href="#comparing-decision-boundaries-of-popular-classification-techniques"><i class="fas fa-link"></i></a>
</h2>
<p>Classifiers create decision boundaries to discriminate between classes.
Different classifiers are able to create different shapes of decision
boundaries (e.g., some are strictly linear) and thus some classifiers
may perform better for certain datasets. This page visualizes the
decision boundaries found by several popular classification methods.</p>
<p>The following plot adds the decision boundary (black lines) and
classification confidence (color intensity) by evaluating the classifier
at evenly spaced grid points. Note that low resolution (to make
evaluation faster) will make the decision boundary look like it has
small steps even if it is a (straight) line.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">decisionplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span>, <span class="va">class_var</span>, </span>
<span>  <span class="va">predict_type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"prob"</span><span class="op">)</span>, <span class="va">resolution</span> <span class="op">=</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">72</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># resolution is set to 72 dpi if the image is rendered  3 inches wide. </span></span>
<span>  </span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">class_var</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">class_var</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># resubstitution accuracy</span></span>
<span>  <span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, type <span class="op">=</span> <span class="va">predict_type</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># LDA returns a list</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span> <span class="va">prediction</span> <span class="op">&lt;-</span> <span class="va">prediction</span><span class="op">$</span><span class="va">class</span></span>
<span>  <span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">prediction</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">prediction</span>, </span>
<span>                        reference <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">acc</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"Accuracy"</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># evaluate model on a grid</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">range</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">r</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span></span>
<span>  <span class="va">ys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">r</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">xs</span>, each <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ys</span>, time <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">### guess how to get class labels from predict</span></span>
<span>  <span class="co">### (unfortunately not very consistent between models)</span></span>
<span>  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">g</span>, type <span class="op">=</span> <span class="va">predict_type</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># LDA returns a list</span></span>
<span>  <span class="va">prob</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="va">prob</span> <span class="op">&lt;-</span> <span class="va">cl</span><span class="op">$</span><span class="va">posterior</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span><span class="op">$</span><span class="va">class</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">predict_type</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">g</span>, type <span class="op">=</span> <span class="va">predict_type</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># we visualize the difference in probability/score between the </span></span>
<span>  <span class="co"># winning class and the second best class.</span></span>
<span>  <span class="co"># don't use probability if predict for the classifier does not support it.</span></span>
<span>  <span class="va">max_prob</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">max_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">prob</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">sort</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">max_prob</span> <span class="op">&lt;-</span> <span class="va">max_prob</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">max_prob</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cl</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="va">cl</span>, probability <span class="op">=</span> <span class="va">max_prob</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">g</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">prediction</span>, alpha <span class="op">=</span> <span class="va">probability</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      shape <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">class_var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html">scale_alpha_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Training accuracy:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">acc</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div id="iris-dataset" class="section level3" number="4.13.1">
<h3>
<span class="header-section-number">4.13.1</span> Iris Dataset<a class="anchor" aria-label="anchor" href="#iris-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>For easier visualization, we use two dimensions of the Iris dataset.
Contour lines visualize the density like mountains on a map.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Three classes </span></span>
<span><span class="co">### (note: MASS also has a select function which hides dplyr's select)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span>, <span class="va">Species</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">## # A tibble: 150 × 3</span></span>
<span><span class="co">##    Sepal.Length Sepal.Width Species</span></span>
<span><span class="co">##           &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span><span class="co">##  1          5.1         3.5 setosa </span></span>
<span><span class="co">##  2          4.9         3   setosa </span></span>
<span><span class="co">##  3          4.7         3.2 setosa </span></span>
<span><span class="co">##  4          4.6         3.1 setosa </span></span>
<span><span class="co">##  5          5           3.6 setosa </span></span>
<span><span class="co">##  6          5.4         3.9 setosa </span></span>
<span><span class="co">##  7          4.6         3.4 setosa </span></span>
<span><span class="co">##  8          5           3.4 setosa </span></span>
<span><span class="co">##  9          4.4         2.9 setosa </span></span>
<span><span class="co">## 10          4.9         3.1 setosa </span></span>
<span><span class="co">## # ℹ 140 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"polygon"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-219-1.png" width="672"></div>
<p><em>Note:</em> There is some overplotting and you could use <code><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter()</a></code>
instead of <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>.</p>
<div id="nearest-neighbor-classifier-1" class="section level4" number="4.13.1.1">
<h4>
<span class="header-section-number">4.13.1.1</span> Nearest Neighbor Classifier<a class="anchor" aria-label="anchor" href="#nearest-neighbor-classifier-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, k <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"kNN (1 neighbor)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-220-1.png" width="672"></div>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"kNN (3 neighbor)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-220-2.png" width="672"></div>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, k <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"kNN (9 neighbor)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-220-3.png" width="672"></div>
<p>Increasing <span class="math inline">\(k\)</span> smooths the decision boundary. At <span class="math inline">\(k=1\)</span>, we see white
areas around points where flowers of two classes are in the same spot.
Here, the algorithm randomly chooses a class during prediction resulting
in the meandering decision boundary. The predictions in that area are
not stable and every time we ask for a class, we may get a different
class.</p>
</div>
<div id="naive-bayes-classifier-1" class="section level4" number="4.13.1.2">
<h4>
<span class="header-section-number">4.13.1.2</span> Naive Bayes Classifier<a class="anchor" aria-label="anchor" href="#naive-bayes-classifier-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/naiveBayes.html">naiveBayes</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>             predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Naive Bayes"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-221-1.png" width="672"></div>
</div>
<div id="linear-discriminant-analysis" class="section level4" number="4.13.1.3">
<h4>
<span class="header-section-number">4.13.1.3</span> Linear Discriminant Analysis<a class="anchor" aria-label="anchor" href="#linear-discriminant-analysis"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"LDA"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-222-1.png" width="672"></div>
</div>
<div id="multinomial-logistic-regression-implemented-in-nnet" class="section level4" number="4.13.1.4">
<h4>
<span class="header-section-number">4.13.1.4</span> Multinomial Logistic Regression (implemented in nnet)<a class="anchor" aria-label="anchor" href="#multinomial-logistic-regression-implemented-in-nnet"><i class="fas fa-link"></i></a>
</h4>
<p>Multinomial logistic regression is an extension of logistic regression
to problems with more than two classes.</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="co">## # weights:  12 (6 variable)</span></span>
<span><span class="co">## initial  value 164.791843 </span></span>
<span><span class="co">## iter  10 value 62.715967</span></span>
<span><span class="co">## iter  20 value 59.808291</span></span>
<span><span class="co">## iter  30 value 55.445984</span></span>
<span><span class="co">## iter  40 value 55.375704</span></span>
<span><span class="co">## iter  50 value 55.346472</span></span>
<span><span class="co">## iter  60 value 55.301707</span></span>
<span><span class="co">## iter  70 value 55.253532</span></span>
<span><span class="co">## iter  80 value 55.243230</span></span>
<span><span class="co">## iter  90 value 55.230241</span></span>
<span><span class="co">## iter 100 value 55.212479</span></span>
<span><span class="co">## final  value 55.212479 </span></span>
<span><span class="co">## stopped after 100 iterations</span></span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>titel <span class="op">=</span> <span class="st">"Multinomial Logistic Regression"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-223-1.png" width="672"></div>
</div>
<div id="decision-trees" class="section level4" number="4.13.1.5">
<h4>
<span class="header-section-number">4.13.1.5</span> Decision Trees<a class="anchor" aria-label="anchor" href="#decision-trees"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"CART"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-224-1.png" width="672"></div>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  control <span class="op">=</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.001</span>, minsplit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"CART (overfitting)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-224-2.png" width="672"></div>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">C50</span><span class="fu">::</span><span class="fu"><a href="https://topepo.github.io/C5.0/reference/C5.0.html">C5.0</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"C5.0"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-224-3.png" width="672"></div>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Random Forest"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-224-4.png" width="672"></div>
</div>
<div id="svm" class="section level4" number="4.13.1.6">
<h4>
<span class="header-section-number">4.13.1.6</span> SVM<a class="anchor" aria-label="anchor" href="#svm"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (linear kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-225-1.png" width="672"></div>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"radial"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (radial kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-225-2.png" width="672"></div>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"polynomial"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (polynomial kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-225-3.png" width="672"></div>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (sigmoid kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-225-4.png" width="672"></div>
</div>
<div id="single-layer-feed-forward-neural-networks" class="section level4" number="4.13.1.7">
<h4>
<span class="header-section-number">4.13.1.7</span> Single Layer Feed-forward Neural Networks<a class="anchor" aria-label="anchor" href="#single-layer-feed-forward-neural-networks"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">1</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var  <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (1 neuron)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-226-1.png" width="672"></div>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">2</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var  <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (2 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-226-2.png" width="672"></div>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">4</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var  <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (4 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-226-3.png" width="672"></div>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">10</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var  <span class="op">=</span> <span class="st">"Species"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (10 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-226-4.png" width="672"></div>
</div>
</div>
<div id="circle-dataset" class="section level3" number="4.13.2">
<h3>
<span class="header-section-number">4.13.2</span> Circle Dataset<a class="anchor" aria-label="anchor" href="#circle-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>This set is not linearly separable!</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">mlbench</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.circle.html">mlbench.circle</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">###x &lt;- mlbench::mlbench.cassini(500)</span></span>
<span><span class="co">###x &lt;- mlbench::mlbench.spirals(500, sd = .1)</span></span>
<span><span class="co">###x &lt;- mlbench::mlbench.smiley(500)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">## # A tibble: 500 × 3</span></span>
<span><span class="co">##          x       y class</span></span>
<span><span class="co">##      &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;</span></span>
<span><span class="co">##  1 -0.344   0.448  1    </span></span>
<span><span class="co">##  2  0.518   0.915  2    </span></span>
<span><span class="co">##  3 -0.772  -0.0913 1    </span></span>
<span><span class="co">##  4  0.382   0.412  1    </span></span>
<span><span class="co">##  5  0.0328  0.438  1    </span></span>
<span><span class="co">##  6 -0.865  -0.354  2    </span></span>
<span><span class="co">##  7  0.477   0.640  2    </span></span>
<span><span class="co">##  8  0.167  -0.809  2    </span></span>
<span><span class="co">##  9 -0.568  -0.281  1    </span></span>
<span><span class="co">## 10 -0.488   0.638  2    </span></span>
<span><span class="co">## # ℹ 490 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-227-1.png" width="672"></div>
<div id="nearest-neighbor-classifier-2" class="section level4" number="4.13.2.1">
<h4>
<span class="header-section-number">4.13.2.1</span> Nearest Neighbor Classifier<a class="anchor" aria-label="anchor" href="#nearest-neighbor-classifier-2"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, k <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"kNN (1 neighbor)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-228-1.png" width="672"></div>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"kNN (10 neighbor)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-228-2.png" width="672"></div>
</div>
<div id="naive-bayes-classifier-2" class="section level4" number="4.13.2.2">
<h4>
<span class="header-section-number">4.13.2.2</span> Naive Bayes Classifier<a class="anchor" aria-label="anchor" href="#naive-bayes-classifier-2"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/naiveBayes.html">naiveBayes</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"naive Bayes"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-229-1.png" width="672"></div>
</div>
<div id="linear-discriminant-analysis-1" class="section level4" number="4.13.2.3">
<h4>
<span class="header-section-number">4.13.2.3</span> Linear Discriminant Analysis<a class="anchor" aria-label="anchor" href="#linear-discriminant-analysis-1"><i class="fas fa-link"></i></a>
</h4>
<p>LDA cannot find a good model since the true decision boundary is not
linear.</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"LDA"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-230-1.png" width="672"></div>
</div>
<div id="logistic-regression-implemented-in-nnet" class="section level4" number="4.13.2.4">
<h4>
<span class="header-section-number">4.13.2.4</span> Logistic Regression (implemented in nnet)<a class="anchor" aria-label="anchor" href="#logistic-regression-implemented-in-nnet"><i class="fas fa-link"></i></a>
</h4>
<p>Multinomial logistic regression is an extension of logistic regression
to problems with more than two classes. It also tries to find a linear
decision boundary.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="co">## # weights:  4 (3 variable)</span></span>
<span><span class="co">## initial  value 346.573590 </span></span>
<span><span class="co">## final  value 346.308371 </span></span>
<span><span class="co">## converged</span></span></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>titel <span class="op">=</span> <span class="st">"Multinomial Logistic Regression"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-231-1.png" width="672"></div>
</div>
<div id="decision-trees-1" class="section level4" number="4.13.2.5">
<h4>
<span class="header-section-number">4.13.2.5</span> Decision Trees<a class="anchor" aria-label="anchor" href="#decision-trees-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"CART"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-232-1.png" width="672"></div>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>,</span>
<span>  control <span class="op">=</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.001</span>, minsplit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"CART (overfitting)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-232-2.png" width="672"></div>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">C50</span><span class="fu">::</span><span class="fu"><a href="https://topepo.github.io/C5.0/reference/C5.0.html">C5.0</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"C5.0"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-232-3.png" width="672"></div>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></span>
<span><span class="co">## randomForest 4.7-1.1</span></span>
<span><span class="co">## Type rfNews() to see new features/changes/bug fixes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'randomForest'</span></span>
<span><span class="co">## The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     combine</span></span>
<span><span class="co">## The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     margin</span></span></code></pre></div>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Random Forest"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-232-4.png" width="672"></div>
</div>
<div id="svm-1" class="section level4" number="4.13.2.6">
<h4>
<span class="header-section-number">4.13.2.6</span> SVM<a class="anchor" aria-label="anchor" href="#svm-1"><i class="fas fa-link"></i></a>
</h4>
<p>Linear SVM does not work for this data.</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (linear kernel)"</span><span class="op">)</span></span>
<span><span class="co">## Warning: Computation failed in `stat_contour()`.</span></span>
<span><span class="co">## Caused by error in `if (zero_range(range)) ...`:</span></span>
<span><span class="co">## ! missing value where TRUE/FALSE needed</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-233-1.png" width="672"></div>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"radial"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (radial kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-233-2.png" width="672"></div>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"polynomial"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (polynomial kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-233-3.png" width="672"></div>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, kernel <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"SVM (sigmoid kernel)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-233-4.png" width="672"></div>
</div>
<div id="single-layer-feed-forward-neural-networks-1" class="section level4" number="4.13.2.7">
<h4>
<span class="header-section-number">4.13.2.7</span> Single Layer Feed-forward Neural Networks<a class="anchor" aria-label="anchor" href="#single-layer-feed-forward-neural-networks-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">1</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (1 neuron)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-234-1.png" width="672"></div>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">2</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (2 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-234-2.png" width="672"></div>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">4</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (4 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-234-3.png" width="672"></div>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">_</span>, size <span class="op">=</span> <span class="fl">10</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">decisionplot</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, class_var <span class="op">=</span> <span class="st">"class"</span>, </span>
<span>  predict_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NN (10 neurons)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-234-4.png" width="672"></div>
</div>
</div>
</div>
<div id="more-information-on-classification-with-r" class="section level2" number="4.14">
<h2>
<span class="header-section-number">4.14</span> More Information on Classification with R<a class="anchor" aria-label="anchor" href="#more-information-on-classification-with-r"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Package caret: <a href="http://topepo.github.io/caret/index.html" class="uri">http://topepo.github.io/caret/index.html</a>
</li>
<li>Tidymodels (machine learning with tidyverse):
<a href="https://www.tidymodels.org/" class="uri">https://www.tidymodels.org/</a>
</li>
<li>R taskview on machine learning:
<a href="http://cran.r-project.org/web/views/MachineLearning.html" class="uri">http://cran.r-project.org/web/views/MachineLearning.html</a>
</li>
</ul>
</div>
<div id="exercises-2" class="section level2" number="4.15">
<h2>
<span class="header-section-number">4.15</span> Exercises*<a class="anchor" aria-label="anchor" href="#exercises-2"><i class="fas fa-link"></i></a>
</h2>
<p>We will again use the Palmer penguin data for the exercises.</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   species island    bill_length_mm bill_depth_mm flipper_length_mm</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Torgersen           39.1          18.7               181</span></span>
<span><span class="co">## 2 Adelie  Torgersen           39.5          17.4               186</span></span>
<span><span class="co">## 3 Adelie  Torgersen           40.3          18                 195</span></span>
<span><span class="co">## 4 Adelie  Torgersen           NA            NA                  NA</span></span>
<span><span class="co">## 5 Adelie  Torgersen           36.7          19.3               193</span></span>
<span><span class="co">## 6 Adelie  Torgersen           39.3          20.6               190</span></span>
<span><span class="co">## # ℹ 3 more variables: body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
<p>Create a R markdown file with the code and do the following below.</p>
<ol style="list-style-type: decimal">
<li>Apply at least 3 different classification models to the data.</li>
<li>Compare the models and a simple baseline model. Which model
performs the best? Does it perform significantly better than the other
models?</li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="classification-basic-concepts-and-techniques.html"><span class="header-section-number">3</span> Classification: Basic Concepts and Techniques</a></div>
<div class="next"><a href="association-analysis-basic-concepts-and-algorithms.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts and Algorithms</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#classification-alternative-techniques"><span class="header-section-number">4</span> Classification: Alternative Techniques</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#packages-used-in-this-chapter-2">Packages Used in this Chapter</a></li></ul>
</li>
<li>
<a class="nav-link" href="#types-of-classifiers"><span class="header-section-number">4.1</span> Types of Classifiers</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#set-up-the-training-and-test-data"><span class="header-section-number">4.1.1</span> Set up the Training and Test Data</a></li></ul>
</li>
<li><a class="nav-link" href="#rule-based-classifier-part"><span class="header-section-number">4.2</span> Rule-based classifier: PART</a></li>
<li><a class="nav-link" href="#nearest-neighbor-classifier"><span class="header-section-number">4.3</span> Nearest Neighbor Classifier</a></li>
<li><a class="nav-link" href="#naive-bayes-classifier"><span class="header-section-number">4.4</span> Naive Bayes Classifier</a></li>
<li><a class="nav-link" href="#bayesian-network"><span class="header-section-number">4.5</span> Bayesian Network</a></li>
<li><a class="nav-link" href="#logistic-regression"><span class="header-section-number">4.6</span> Logistic regression</a></li>
<li><a class="nav-link" href="#artificial-neural-network-ann"><span class="header-section-number">4.7</span> Artificial Neural Network (ANN)</a></li>
<li><a class="nav-link" href="#deep-learning-with-kerastensorflow"><span class="header-section-number">4.8</span> Deep Learning with keras/tensorflow</a></li>
<li><a class="nav-link" href="#support-vector-machines"><span class="header-section-number">4.9</span> Support Vector Machines</a></li>
<li>
<a class="nav-link" href="#ensemble-methods"><span class="header-section-number">4.10</span> Ensemble Methods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#random-forest"><span class="header-section-number">4.10.1</span> Random Forest</a></li>
<li><a class="nav-link" href="#gradient-boosted-decision-trees-xgboost"><span class="header-section-number">4.10.2</span> Gradient Boosted Decision Trees (xgboost)</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#class-imbalance"><span class="header-section-number">4.11</span> Class Imbalance</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#option-1-use-the-data-as-is-and-hope-for-the-best"><span class="header-section-number">4.11.1</span> Option 1: Use the Data As Is and Hope For The Best</a></li>
<li><a class="nav-link" href="#option-2-balance-data-with-resampling"><span class="header-section-number">4.11.2</span> Option 2: Balance Data With Resampling</a></li>
<li><a class="nav-link" href="#option-3-build-a-larger-tree-and-use-predicted-probabilities"><span class="header-section-number">4.11.3</span> Option 3: Build A Larger Tree and use Predicted Probabilities</a></li>
<li><a class="nav-link" href="#option-4-use-a-cost-sensitive-classifier"><span class="header-section-number">4.11.4</span> Option 4: Use a Cost-Sensitive Classifier</a></li>
</ul>
</li>
<li><a class="nav-link" href="#model-comparison-1"><span class="header-section-number">4.12</span> Model Comparison</a></li>
<li>
<a class="nav-link" href="#comparing-decision-boundaries-of-popular-classification-techniques"><span class="header-section-number">4.13</span> Comparing Decision Boundaries of Popular Classification Techniques*</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#iris-dataset"><span class="header-section-number">4.13.1</span> Iris Dataset</a></li>
<li><a class="nav-link" href="#circle-dataset"><span class="header-section-number">4.13.2</span> Circle Dataset</a></li>
</ul>
</li>
<li><a class="nav-link" href="#more-information-on-classification-with-r"><span class="header-section-number">4.14</span> More Information on Classification with R</a></li>
<li><a class="nav-link" href="#exercises-2"><span class="header-section-number">4.15</span> Exercises*</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/blob/master/book_src/04_classification_alternative.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/edit/master/book_src/04_classification_alternative.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An R Companion for Introduction to Data Mining</strong>" was written by Michael Hahsler. It was last built on 2024-06-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
