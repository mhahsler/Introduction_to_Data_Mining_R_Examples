<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>B Regression | An R Companion for Introduction to Data Mining</title>
<meta name="author" content="Michael Hahsler">
<meta name="description" content="Regression is an important statistical method that is covered the freely available Appendix D of the data mining textbook. In this extra chapter, we introduce the regression problem and multiple...">
<meta name="generator" content="bookdown 0.44 with bs4_book()">
<meta property="og:title" content="B Regression | An R Companion for Introduction to Data Mining">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="Regression is an important statistical method that is covered the freely available Appendix D of the data mining textbook. In this extra chapter, we introduce the regression problem and multiple...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="B Regression | An R Companion for Introduction to Data Mining">
<meta name="twitter:description" content="Regression is an important statistical method that is covered the freely available Appendix D of the data mining textbook. In this extra chapter, we introduce the regression problem and multiple...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><link href="libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><link href="libs/nouislider/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider/jquery.nouislider.min.js"></script><link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize/selectize.min.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An R Companion for Introduction to Data Mining</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data.html"><span class="header-section-number">2</span> Data</a></li>
<li><a class="" href="classification-basic-concepts.html"><span class="header-section-number">3</span> Classification: Basic Concepts</a></li>
<li><a class="" href="classification-alternative-techniques.html"><span class="header-section-number">4</span> Classification: Alternative Techniques</a></li>
<li><a class="" href="association-analysis-basic-concepts.html"><span class="header-section-number">5</span> Association Analysis: Basic Concepts</a></li>
<li><a class="" href="association-analysis-advanced-concepts.html"><span class="header-section-number">6</span> Association Analysis: Advanced Concepts</a></li>
<li><a class="" href="cluster-analysis.html"><span class="header-section-number">7</span> Cluster Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="data-exploration-and-visualization.html"><span class="header-section-number">A</span> Data Exploration and Visualization</a></li>
<li><a class="active" href="appendix_regression.html"><span class="header-section-number">B</span> Regression</a></li>
<li><a class="" href="appendix_logistic_regression.html"><span class="header-section-number">C</span> Logistic Regression</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="appendix_regression" class="section level1" number="9">
<h1>
<span class="header-section-number">B</span> Regression<a class="anchor" aria-label="anchor" href="#appendix_regression"><i class="fas fa-link"></i></a>
</h1>
<p>Regression is an important statistical method that is covered
the freely available <a href="https://mhahsler.github.io/Introduction_to_Data_Mining_R_Examples/DM_chapters/appendices_2ed.pdf">Appendix D</a>
of the data mining textbook.</p>
<p>In this extra chapter, we introduce the regression problem
and multiple linear regression. In addition,
alternative models like regression trees and regularized regression
are discussed.</p>
<div id="packages-used-in-this-chapter-7" class="section level3 unnumbered">
<h3>Packages Used in this Chapter<a class="anchor" aria-label="anchor" href="#packages-used-in-this-chapter-7"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'lars'</span>, <span class="st">'rpart'</span>, <span class="st">'rpart.plot'</span>, <span class="st">'nnet'</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">pkgs_install</span> <span class="op">&lt;-</span> <span class="va">pkgs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pkgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkgs_install</span><span class="op">)</span></span></code></pre></div>
<p>The packages used for this chapter are:</p>
<ul>
<li>
<em>lars</em> <span class="citation">(<a href="references.html#ref-R-lars">Hastie and Efron 2022</a>)</span>
</li>
<li>
<em>nnet</em> <span class="citation">(<a href="references.html#ref-R-nnet">Ripley 2025</a>)</span>
</li>
<li>
<em>rpart</em> <span class="citation">(<a href="references.html#ref-R-rpart">Therneau and Atkinson 2025</a>)</span>
</li>
<li>
<em>rpart.plot</em> <span class="citation">(<a href="references.html#ref-R-rpart.plot">Milborrow 2025</a>)</span>
</li>
</ul>
</div>
<div id="introduction-1" class="section level2" number="9.1">
<h2>
<span class="header-section-number">B.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>Recall that classification predicts one of a small set of discrete (i.e., nominal) labels (e.g., yes or no,
small, medium or large).
Regression is also a supervised learning problem, but the goal is to
predict the value of a continuous value given a set of predictors.
We start with the popular linear regression and will later discuss alternative
regression methods.</p>
<p>Linear regression models the value of a dependent variable <span class="math inline">\(y\)</span> (also called
the response) as
as linear function of independent variables <span class="math inline">\(X_1, X_2, ..., X_p\)</span>
(also called the regressors, predictors, exogenous variables, explanatory variables,
or covariates).
If we use more than one explanatory variable, then we often call this
multiple or multivariate linear regression.
The linear regression model is:
<span class="math display">\[\hat{y}_i = f(\mathbf{x}_i) = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} + \epsilon_i = \beta_0 + \sum_{j = 1}^p{\left(\beta_jx_{ij}\right) + \epsilon_i},\]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> is the intercept, <span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(p+1\)</span>-dimensional parameter
vector learned from the data, and <span class="math inline">\(\epsilon\)</span> is the error term
(called the residuals). This is often also written in vector notation as
<span class="math display">\[\hat{\mathbf{y}} = \mathbf{X} \boldsymbol{\beta} + \epsilon,\]</span>
where <span class="math inline">\(\hat{\mathbf{y}}\)</span>
and <span class="math inline">\(\boldsymbol{\beta}\)</span> are vectors and <span class="math inline">\(\mathbf{X}\)</span> is the matrix
with the covariates (called the design matrix).</p>
<p>The error that is often minimized in regression problems is the squared error defined
as:</p>
<p><span class="math display">\[SE= \sum_i (y_i - f(\mathbf{x}_i))^2\]</span></p>
<p>The parameter vector is found by minimizing the squared error the training data.</p>
<p>Linear regression makes several assumptions that should be checked:</p>
<ul>
<li>
<em>Linearity:</em> There is a linear relationship between dependent
and independent variables.</li>
<li>
<em>Homoscedasticity:</em> The variance of the error (<span class="math inline">\(\epsilon\)</span>)
does not change (increase) with the predicted value.</li>
<li>
<em>Independence of errors:</em> Errors between observations are uncorrelated.</li>
<li>
<em>No multicollinearity of predictors:</em> Predictors cannot be
perfectly correlated or the parameter vector cannot be identified. <em>Note</em>
that highly correlated predictors lead to unstable results and should be
avoided using, e.g., variable selection.</li>
</ul>
</div>
<div id="a-first-linear-regression-model" class="section level2" number="9.2">
<h2>
<span class="header-section-number">B.2</span> A First Linear Regression Model<a class="anchor" aria-label="anchor" href="#a-first-linear-regression-model"><i class="fas fa-link"></i></a>
</h2>
<p>We will use the Iris dataset and try to predict
the <code>Petal.Width</code> using the other variables. We first
load and shuffle data since the flowers in the dataset are in order by species.</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/arules/man/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, col<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-412-1.png" width="672"></div>
<p>The Iris data is very clean, so we make the data a little messy by adding a random error
to each variable and introduce a useless, completely random feature.</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>           useless <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, </span>
<span>           Species <span class="op">=</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, col<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-413-1.png" width="672"></div>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##   Sepal.Length   Sepal.Width     Petal.Length   </span></span>
<span><span class="co">##  Min.   :2.68   Min.   :0.611   Min.   :-0.713  </span></span>
<span><span class="co">##  1st Qu.:5.05   1st Qu.:2.306   1st Qu.: 1.876  </span></span>
<span><span class="co">##  Median :5.92   Median :3.171   Median : 4.102  </span></span>
<span><span class="co">##  Mean   :5.85   Mean   :3.128   Mean   : 3.781  </span></span>
<span><span class="co">##  3rd Qu.:6.70   3rd Qu.:3.945   3rd Qu.: 5.546  </span></span>
<span><span class="co">##  Max.   :8.81   Max.   :5.975   Max.   : 7.708  </span></span>
<span><span class="co">##   Petal.Width     useless           Species  </span></span>
<span><span class="co">##  Min.   :0.1   Min.   :2.92   setosa    :50  </span></span>
<span><span class="co">##  1st Qu.:0.3   1st Qu.:5.23   versicolor:50  </span></span>
<span><span class="co">##  Median :1.3   Median :5.91   virginica :50  </span></span>
<span><span class="co">##  Mean   :1.2   Mean   :5.88                  </span></span>
<span><span class="co">##  3rd Qu.:1.8   3rd Qu.:6.56                  </span></span>
<span><span class="co">##  Max.   :2.5   Max.   :8.11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##     Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">## 85         2.980       1.464        5.227         1.5</span></span>
<span><span class="co">## 104        5.096       3.044        5.187         1.8</span></span>
<span><span class="co">## 30         4.361       2.832        1.861         0.2</span></span>
<span><span class="co">## 53         8.125       2.406        5.526         1.5</span></span>
<span><span class="co">## 143        6.372       1.565        6.147         1.9</span></span>
<span><span class="co">## 142        6.526       3.697        5.708         2.3</span></span>
<span><span class="co">##     useless    Species</span></span>
<span><span class="co">## 85    5.712 versicolor</span></span>
<span><span class="co">## 104   6.569  virginica</span></span>
<span><span class="co">## 30    4.299     setosa</span></span>
<span><span class="co">## 53    6.124 versicolor</span></span>
<span><span class="co">## 143   6.553  virginica</span></span>
<span><span class="co">## 142   5.222  virginica</span></span></code></pre></div>
<p>We split the data into training and test data. Since the data is shuffled, we
effectively perform holdout sampling. This is often not done in
statistical applications, but we use the machine learning approach here.</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">150</span>,<span class="op">]</span></span></code></pre></div>
<p>Linear regression is done in R using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> (linear model) function which is
part of the R core package <code>stats</code>.
Like other modeling functions in R, <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> uses a formula interface. Here we create a formula
to predict <code>Petal.Width</code> by all other variables other than <code>Species</code>.</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span></span>
<span>            <span class="op">+</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">useless</span>,</span>
<span>            data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">model1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + </span></span>
<span><span class="co">##     useless, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##  (Intercept)  Sepal.Length   Sepal.Width  Petal.Length  </span></span>
<span><span class="co">##     -0.20589       0.01957       0.03406       0.30814  </span></span>
<span><span class="co">##      useless  </span></span>
<span><span class="co">##      0.00392</span></span></code></pre></div>
<p>The result is a model with the fitted <span class="math inline">\(\beta\)</span> coefficients. More information can
be displayed using the summary function.</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + </span></span>
<span><span class="co">##     useless, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0495 -0.2033  0.0074  0.2038  0.8564 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  -0.20589    0.28723   -0.72     0.48    </span></span>
<span><span class="co">## Sepal.Length  0.01957    0.03265    0.60     0.55    </span></span>
<span><span class="co">## Sepal.Width   0.03406    0.03549    0.96     0.34    </span></span>
<span><span class="co">## Petal.Length  0.30814    0.01819   16.94   &lt;2e-16 ***</span></span>
<span><span class="co">## useless       0.00392    0.03558    0.11     0.91    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.366 on 95 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.778,  Adjusted R-squared:  0.769 </span></span>
<span><span class="co">## F-statistic: 83.4 on 4 and 95 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>The summary shows:</p>
<ul>
<li>Which coefficients are significantly different from 0. Here only <code>Petal.Length</code>
is significant and the coefficient for <code>useless</code> is very close to 0.
Look at the scatter plot matrix above and see why this is the case.</li>
<li>R-squared (coefficient of determination): Proportion (in the range <span class="math inline">\([0,1]\)</span>) of the variability of
the dependent variable explained by the model. It is better to look at the
adjusted R-square (adjusted for number of dependent variables). Typically,
an R-squared of greater than <span class="math inline">\(0.7\)</span> is considered good, but this is just a rule of thumb and
we should rather use a test set for evaluation.</li>
</ul>
<p>Plotting the model produces diagnostic plots (see <code>plot.lm()</code>). For example,
to check that the error term has a mean of 0 and is homoscedastic,
the residual vs. predicted value scatter plot
should have a red line that stays clode to 0 and
not look like a funnel where they are increasing when the fitted values increase.
To check if the residuals are approximately normally distributed,
the Q-Q plot should be close to the straight diagonal line.</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model1</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-417-1.png" width="672"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-417-2.png" width="672"></p>
<p>In this case, the two plots look fine.</p>
</div>
<div id="comparing-nested-models" class="section level2" number="9.3">
<h2>
<span class="header-section-number">B.3</span> Comparing Nested Models<a class="anchor" aria-label="anchor" href="#comparing-nested-models"><i class="fas fa-link"></i></a>
</h2>
<p>Here we perform model selection to compare several linear models.
Nested means that all models use a subset of the same set of features.
We create a simpler model by removing the feature useless from the model above.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> </span>
<span>               <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length, </span></span>
<span><span class="co">##     data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0440 -0.2024  0.0099  0.1998  0.8513 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)   -0.1842     0.2076   -0.89     0.38    </span></span>
<span><span class="co">## Sepal.Length   0.0199     0.0323    0.62     0.54    </span></span>
<span><span class="co">## Sepal.Width    0.0339     0.0353    0.96     0.34    </span></span>
<span><span class="co">## Petal.Length   0.3080     0.0180   17.07   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.365 on 96 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.778,  Adjusted R-squared:  0.771 </span></span>
<span><span class="co">## F-statistic:  112 on 3 and 96 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>We can remove the intercept by adding <code>-1</code> to the formula.</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> </span>
<span>               <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model3</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length - </span></span>
<span><span class="co">##     1, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.0310 -0.1961 -0.0051  0.2264  0.8246 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## Sepal.Length -0.00168    0.02122   -0.08     0.94    </span></span>
<span><span class="co">## Sepal.Width   0.01859    0.03073    0.61     0.55    </span></span>
<span><span class="co">## Petal.Length  0.30666    0.01796   17.07   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.364 on 97 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.938,  Adjusted R-squared:  0.936 </span></span>
<span><span class="co">## F-statistic:  486 on 3 and 97 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>Here is a very simple model.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length - 1, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.9774 -0.1957  0.0078  0.2536  0.8455 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## Petal.Length  0.31586    0.00822    38.4   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.362 on 99 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.937,  Adjusted R-squared:  0.936 </span></span>
<span><span class="co">## F-statistic: 1.47e+03 on 1 and 99 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>We need a statistical test to compare all these nested models. The appropriate test is called
<a href="https://en.wikipedia.org/wiki/Analysis_of_variance">ANOVA</a> (analysis of variance)
which is a generalization of the t-test to check if all the treatments
(i.e., models) have the same effect.
<strong>Important note:</strong> This only works for <em>nested models.</em> Models are nested only if one model contains all the predictors of the other model.</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span>, <span class="va">model3</span>, <span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + useless</span></span>
<span><span class="co">## Model 2: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length</span></span>
<span><span class="co">## Model 3: Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length - 1</span></span>
<span><span class="co">## Model 4: Petal.Width ~ Petal.Length - 1</span></span>
<span><span class="co">##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">## 1     95 12.8                         </span></span>
<span><span class="co">## 2     96 12.8 -1   -0.0016 0.01   0.91</span></span>
<span><span class="co">## 3     97 12.9 -1   -0.1046 0.78   0.38</span></span>
<span><span class="co">## 4     99 13.0 -2   -0.1010 0.38   0.69</span></span></code></pre></div>
<p>Models 1 is not significantly better than model 2. Model 2 is not significantly better than model 3. Model 3 is not significantly better than model 4! Use model 4, the simplest model.
See <code>anova.lm()</code> for the manual page for ANOVA for linear models.</p>
</div>
<div id="stepwise-variable-selection" class="section level2" number="9.4">
<h2>
<span class="header-section-number">B.4</span> Stepwise Variable Selection<a class="anchor" aria-label="anchor" href="#stepwise-variable-selection"><i class="fas fa-link"></i></a>
</h2>
<p>Stepwise variable section performs backward (or forward) model selection for linear models
and uses the smallest AIC (<a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike information criterion</a>) to decide
what variable to remove and when to stop.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="va">Species</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-195.9</span></span>
<span><span class="co">## Petal.Width ~ (Sepal.Length + Sepal.Width + Petal.Length + useless + </span></span>
<span><span class="co">##     Species) - Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - useless       1       0.0 12.8 -197.9</span></span>
<span><span class="co">## - Sepal.Length  1       0.0 12.8 -197.5</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -196.9</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -195.9</span></span>
<span><span class="co">## - Petal.Length  1      38.6 51.3  -58.7</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-197.9</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - Sepal.Length  1       0.1 12.8 -199.5</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -198.9</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -197.9</span></span>
<span><span class="co">## - Petal.Length  1      38.7 51.5  -60.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-199.5</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Width + Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## - Sepal.Width   1       0.1 12.9 -200.4</span></span>
<span><span class="co">## &lt;none&gt;                      12.8 -199.5</span></span>
<span><span class="co">## - Petal.Length  1      44.7 57.5  -51.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-200.4</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq  RSS    AIC</span></span>
<span><span class="co">## &lt;none&gt;                      12.9 -200.4</span></span>
<span><span class="co">## - Petal.Length  1      44.6 57.6  -53.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.9848 -0.1873  0.0048  0.2466  0.8343 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)    0.0280     0.0743    0.38     0.71    </span></span>
<span><span class="co">## Petal.Length   0.3103     0.0169   18.38   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.364 on 98 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.775,  Adjusted R-squared:  0.773 </span></span>
<span><span class="co">## F-statistic:  338 on 1 and 98 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>Each table represents one step and shows the AIC when each variable is removed and
the one with the smallest AIC (in the first table <code>useless</code>) is removed. It stops
with a small model that only uses <code>Petal.Length</code>.</p>
</div>
<div id="modeling-with-interaction-terms" class="section level2" number="9.5">
<h2>
<span class="header-section-number">B.5</span> Modeling with Interaction Terms<a class="anchor" aria-label="anchor" href="#modeling-with-interaction-terms"><i class="fas fa-link"></i></a>
</h2>
<p>Linear regression models the effect of each predictor separately
using a <span class="math inline">\(\beta\)</span> coefficient.
What if two variables are only important together?
This is called an interaction between predictors and is modeled using
interaction terms.
In R’s <code><a href="https://rdrr.io/r/stats/formula.html">formula()</a></code> we can use <code>:</code> and <code>*</code>
to specify interactions. For linear regression, an interaction
means that a new predictor is created by multiplying the two original
predictors.</p>
<p>We can create a model with an interaction terms between <code>Sepal.Length</code>, <code>Sepal.Width</code> and
<code>Petal.Length</code>.</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">*</span> </span>
<span>                    <span class="va">Sepal.Width</span> <span class="op">*</span> <span class="va">Petal.Length</span>,</span>
<span>             data <span class="op">=</span> <span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-196.4</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                         Df Sum of Sq  RSS</span></span>
<span><span class="co">## &lt;none&gt;                                               11.9</span></span>
<span><span class="co">## - Sepal.Length:Sepal.Width:Petal.Length  1     0.265 12.2</span></span>
<span><span class="co">##                                          AIC</span></span>
<span><span class="co">## &lt;none&gt;                                  -196</span></span>
<span><span class="co">## - Sepal.Length:Sepal.Width:Petal.Length -196</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model5</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length, </span></span>
<span><span class="co">##     data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -1.1064 -0.1882  0.0238  0.1767  0.8577 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                                       Estimate Std. Error</span></span>
<span><span class="co">## (Intercept)                            -2.4207     1.3357</span></span>
<span><span class="co">## Sepal.Length                            0.4484     0.2313</span></span>
<span><span class="co">## Sepal.Width                             0.5983     0.3845</span></span>
<span><span class="co">## Petal.Length                            0.7275     0.2863</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width               -0.1115     0.0670</span></span>
<span><span class="co">## Sepal.Length:Petal.Length              -0.0833     0.0477</span></span>
<span><span class="co">## Sepal.Width:Petal.Length               -0.0941     0.0850</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length   0.0201     0.0141</span></span>
<span><span class="co">##                                       t value Pr(&gt;|t|)  </span></span>
<span><span class="co">## (Intercept)                             -1.81    0.073 .</span></span>
<span><span class="co">## Sepal.Length                             1.94    0.056 .</span></span>
<span><span class="co">## Sepal.Width                              1.56    0.123  </span></span>
<span><span class="co">## Petal.Length                             2.54    0.013 *</span></span>
<span><span class="co">## Sepal.Length:Sepal.Width                -1.66    0.100 .</span></span>
<span><span class="co">## Sepal.Length:Petal.Length               -1.75    0.084 .</span></span>
<span><span class="co">## Sepal.Width:Petal.Length                -1.11    0.272  </span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length    1.43    0.157  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.36 on 92 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.792,  Adjusted R-squared:  0.777 </span></span>
<span><span class="co">## F-statistic: 50.2 on 7 and 92 DF,  p-value: &lt;2e-16</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model5</span>, <span class="va">model4</span><span class="op">)</span></span>
<span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: Petal.Width ~ Sepal.Length * Sepal.Width * Petal.Length</span></span>
<span><span class="co">## Model 2: Petal.Width ~ Petal.Length - 1</span></span>
<span><span class="co">##   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">## 1     92 11.9                         </span></span>
<span><span class="co">## 2     99 13.0 -7     -1.01 1.11   0.36</span></span></code></pre></div>
<p>Some interaction terms are significant in the new model, but ANOVA shows that
model 5 is not significantly better than model 4</p>
</div>
<div id="prediction" class="section level2" number="9.6">
<h2>
<span class="header-section-number">B.6</span> Prediction<a class="anchor" aria-label="anchor" href="#prediction"><i class="fas fa-link"></i></a>
</h2>
<p>We preform here a prediction for the held out test set.</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">##     Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">## 128        8.017       1.541        3.515         1.8</span></span>
<span><span class="co">## 92         5.268       4.064        6.064         1.4</span></span>
<span><span class="co">## 50         5.461       4.161        1.117         0.2</span></span>
<span><span class="co">## 134        6.055       2.951        4.599         1.5</span></span>
<span><span class="co">## 8          4.900       5.096        1.086         0.2</span></span>
<span><span class="co">##     useless    Species</span></span>
<span><span class="co">## 128   6.110  virginica</span></span>
<span><span class="co">## 92    4.938 versicolor</span></span>
<span><span class="co">## 50    6.373     setosa</span></span>
<span><span class="co">## 134   5.595  virginica</span></span>
<span><span class="co">## 8     7.270     setosa</span></span>
<span><span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">$</span><span class="va">Petal.Width</span></span>
<span><span class="co">## [1] 1.8 1.4 0.2 1.5 0.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##    128     92     50    134      8 </span></span>
<span><span class="co">## 1.1104 1.9155 0.3529 1.4526 0.3429</span></span></code></pre></div>
<p>The most used error measure for regression is the
<a href="https://en.wikipedia.org/wiki/Root_mean_square_deviation">RMSE</a>
root-mean-square error.</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMSE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">predicted</span>, <span class="va">true</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">predicted</span><span class="op">-</span><span class="va">true</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.3874</span></span></code></pre></div>
<p>We can also visualize the quality of the prediction using a simple scatter plot of
predicted vs. actual values.</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span>,</span>
<span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-426-1.png" width="672"></div>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.8636</span></span></code></pre></div>
<p>Perfect predictions would be on the red line, the farther they are away,
the larger the error.</p>
</div>
<div id="using-nominal-variables" class="section level2" number="9.7">
<h2>
<span class="header-section-number">B.7</span> Using Nominal Variables<a class="anchor" aria-label="anchor" href="#using-nominal-variables"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Dummy_variable_(statistics)">Dummy variables</a> also
called one-hot encoding in machine learning is used for factors
(i.e., levels are translated into individual 0-1 variable).
The first level of factors is automatically used as the reference and
the other levels are presented as 0-1 dummy variables called contrasts.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">## [1] "setosa"     "versicolor" "virginica"</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> is used internally to create dummy variables when the design matrix
for the regression is created..</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##     (Intercept) Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">## 85            1        2.980       1.464        5.227</span></span>
<span><span class="co">## 104           1        5.096       3.044        5.187</span></span>
<span><span class="co">## 30            1        4.361       2.832        1.861</span></span>
<span><span class="co">## 53            1        8.125       2.406        5.526</span></span>
<span><span class="co">## 143           1        6.372       1.565        6.147</span></span>
<span><span class="co">## 142           1        6.526       3.697        5.708</span></span>
<span><span class="co">##     useless Speciesversicolor Speciesvirginica</span></span>
<span><span class="co">## 85    5.712                 1                0</span></span>
<span><span class="co">## 104   6.569                 0                1</span></span>
<span><span class="co">## 30    4.299                 0                0</span></span>
<span><span class="co">## 53    6.124                 1                0</span></span>
<span><span class="co">## 143   6.553                 0                1</span></span>
<span><span class="co">## 142   5.222                 0                1</span></span></code></pre></div>
<p>Note that there is no dummy variable for species Setosa, because it is
used as the reference (when the other two dummy variables are 0).
It is often useful to set the reference level.
A simple way is to use the
function <code><a href="https://rdrr.io/r/stats/relevel.html">relevel()</a></code> to change which factor is listed first.</p>
<p>Let us perform model selection using AIC on the training data and then evaluate
the final model on the held out test set to estimate the generalization error.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Start:  AIC=-308.4</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Length + Sepal.Width + Petal.Length + useless + </span></span>
<span><span class="co">##     Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - Sepal.Length  1      0.01  3.99 -310</span></span>
<span><span class="co">## - Sepal.Width   1      0.01  3.99 -310</span></span>
<span><span class="co">## - useless       1      0.02  4.00 -310</span></span>
<span><span class="co">## &lt;none&gt;                       3.98 -308</span></span>
<span><span class="co">## - Petal.Length  1      0.47  4.45 -299</span></span>
<span><span class="co">## - Species       2      8.78 12.76 -196</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-310.2</span></span>
<span><span class="co">## Petal.Width ~ Sepal.Width + Petal.Length + useless + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - Sepal.Width   1      0.01  4.00 -312</span></span>
<span><span class="co">## - useless       1      0.02  4.00 -312</span></span>
<span><span class="co">## &lt;none&gt;                       3.99 -310</span></span>
<span><span class="co">## - Petal.Length  1      0.49  4.48 -300</span></span>
<span><span class="co">## - Species       2      8.82 12.81 -198</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-311.9</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length + useless + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## - useless       1      0.02  4.02 -313</span></span>
<span><span class="co">## &lt;none&gt;                       4.00 -312</span></span>
<span><span class="co">## - Petal.Length  1      0.48  4.48 -302</span></span>
<span><span class="co">## - Species       2      8.95 12.95 -198</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Step:  AIC=-313.4</span></span>
<span><span class="co">## Petal.Width ~ Petal.Length + Species</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Df Sum of Sq   RSS  AIC</span></span>
<span><span class="co">## &lt;none&gt;                       4.02 -313</span></span>
<span><span class="co">## - Petal.Length  1      0.50  4.52 -304</span></span>
<span><span class="co">## - Species       2      8.93 12.95 -200</span></span>
<span><span class="va">model6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length + Species, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##       (Intercept)       Petal.Length  Speciesversicolor  </span></span>
<span><span class="co">##            0.1597             0.0664             0.8938  </span></span>
<span><span class="co">##  Speciesvirginica  </span></span>
<span><span class="co">##            1.4903</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model6</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = Petal.Width ~ Petal.Length + Species, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -0.7208 -0.1437  0.0005  0.1254  0.5460 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)         0.1597     0.0441    3.62  0.00047 ***</span></span>
<span><span class="co">## Petal.Length        0.0664     0.0192    3.45  0.00084 ***</span></span>
<span><span class="co">## Speciesversicolor   0.8938     0.0746   11.98  &lt; 2e-16 ***</span></span>
<span><span class="co">## Speciesvirginica    1.4903     0.1020   14.61  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  </span></span>
<span><span class="co">## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.205 on 96 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.93,   Adjusted R-squared:  0.928 </span></span>
<span><span class="co">## F-statistic:  427 on 3 and 96 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1885</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span>,</span>
<span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-430-1.png" width="672"></div>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model6</span>, <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9696</span></span></code></pre></div>
<p>We see that the <code>Species</code> variable provides information to improve the regression model.</p>
</div>
<div id="alternative-regression-models" class="section level2" number="9.8">
<h2>
<span class="header-section-number">B.8</span> Alternative Regression Models<a class="anchor" aria-label="anchor" href="#alternative-regression-models"><i class="fas fa-link"></i></a>
</h2>
<div id="regression-trees" class="section level3" number="9.8.1">
<h3>
<span class="header-section-number">B.8.1</span> Regression Trees<a class="anchor" aria-label="anchor" href="#regression-trees"><i class="fas fa-link"></i></a>
</h3>
<p>Many models used for classification can also perform regression.
For example CART implemented in rpart performs regression
by estimating a value for each leaf note.
Regression is always performed by <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart()</a></code> when the response variable
is not a <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>.</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model7</span></span>
<span><span class="co">## n= 100 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## node), split, n, deviance, yval</span></span>
<span><span class="co">##       * denotes terminal node</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1) root 100 57.5700 1.2190  </span></span>
<span><span class="co">##   2) Species=setosa 32  0.3797 0.2469 *</span></span>
<span><span class="co">##   3) Species=versicolor,virginica 68 12.7200 1.6760  </span></span>
<span><span class="co">##     6) Species=versicolor 35  1.5350 1.3310 *</span></span>
<span><span class="co">##     7) Species=virginica 33  2.6010 2.0420 *</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">model7</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-431-1.png" width="672">
The regression tree shows the predicted value in as the top number in the node.
Also, remember that tree-based models automatically variable selection
by choosing the splits.</div>
<p>Let’s evaluate the regression tree by calculating the RMSE.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model7</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="va">pred</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.182</span></span></code></pre></div>
<p>And visualize the quality.</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="va">pred</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-433-1.png" width="672"></div>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9717</span></span></code></pre></div>
<p>The plot and the correlation coefficient indicate that the model is very good.
In the plot we see an important property of this method which is that it predicts
exactly the same value when the data falls in the same leaf node.</p>
</div>
<div id="regularized-regression" class="section level3" number="9.8.2">
<h3>
<span class="header-section-number">B.8.2</span> Regularized Regression<a class="anchor" aria-label="anchor" href="#regularized-regression"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">LASSO</a> (least absolute shrinkage and selection operator)
uses L1 regularization to reduce to perform automatic variable selection.
The regularization adds a penalty for the L1 norm of the parameter vector <span class="math inline">\(\boldsymbol{\beta}\)</span> (i.e., the summ of all
parameter values)
to the optimization. Increasing the weight of this penalty term (the weight is called <span class="math inline">\(\lambda\)</span>)
results in more and more weights being pushed to 0 which effectively reduces the number of
parameters used in the regression.
An implementation called
the <a href="https://en.wikipedia.org/wiki/Elastic_net_regularization">elastic net</a>
is available as the function <code><a href="https://rdrr.io/pkg/lars/man/lars.html">lars()</a></code> in package <code>lars</code>.</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067">lars</a></span><span class="op">)</span></span>
<span><span class="co">## Loaded lars 1.3</span></span></code></pre></div>
<p>We create a design matrix (with dummy variables and interaction terms).
<code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> did this automatically for us, but for this <code><a href="https://rdrr.io/pkg/lars/man/lars.html">lars()</a></code> implementation
we have to do it manually.</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Sepal.Length</span><span class="op">*</span><span class="va">Sepal.Width</span><span class="op">*</span><span class="va">Petal.Length</span> ,</span>
<span>  data <span class="op">=</span> <span class="va">train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##     (Intercept) Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">## 85            1        2.980       1.464        5.227</span></span>
<span><span class="co">## 104           1        5.096       3.044        5.187</span></span>
<span><span class="co">## 30            1        4.361       2.832        1.861</span></span>
<span><span class="co">## 53            1        8.125       2.406        5.526</span></span>
<span><span class="co">## 143           1        6.372       1.565        6.147</span></span>
<span><span class="co">## 142           1        6.526       3.697        5.708</span></span>
<span><span class="co">##     useless Speciesversicolor Speciesvirginica</span></span>
<span><span class="co">## 85    5.712                 1                0</span></span>
<span><span class="co">## 104   6.569                 0                1</span></span>
<span><span class="co">## 30    4.299                 0                0</span></span>
<span><span class="co">## 53    6.124                 1                0</span></span>
<span><span class="co">## 143   6.553                 0                1</span></span>
<span><span class="co">## 142   5.222                 0                1</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width Sepal.Length:Petal.Length</span></span>
<span><span class="co">## 85                     4.362                    15.578</span></span>
<span><span class="co">## 104                   15.511                    26.431</span></span>
<span><span class="co">## 30                    12.349                     8.114</span></span>
<span><span class="co">## 53                    19.546                    44.900</span></span>
<span><span class="co">## 143                    9.972                    39.168</span></span>
<span><span class="co">## 142                   24.126                    37.253</span></span>
<span><span class="co">##     Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 85                     7.650</span></span>
<span><span class="co">## 104                   15.787</span></span>
<span><span class="co">## 30                     5.269</span></span>
<span><span class="co">## 53                    13.294</span></span>
<span><span class="co">## 143                    9.620</span></span>
<span><span class="co">## 142                   21.103</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 85                                  22.80</span></span>
<span><span class="co">## 104                                 80.45</span></span>
<span><span class="co">## 30                                  22.98</span></span>
<span><span class="co">## 53                                 108.01</span></span>
<span><span class="co">## 143                                 61.30</span></span>
<span><span class="co">## 142                                137.72</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_lars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_lars</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-436-1.png" width="672"></div>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_lars</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lars(x = x, y = y)</span></span>
<span><span class="co">## R-squared: 0.933</span></span>
<span><span class="co">## Warning in seq.default(along = actions): partial argument</span></span>
<span><span class="co">## match of 'along' to 'along.with'</span></span>
<span><span class="co">## Sequence of LASSO moves:</span></span>
<span><span class="co">##      Petal.Length Speciesvirginica Speciesversicolor</span></span>
<span><span class="co">## Var             4                7                 6</span></span>
<span><span class="co">## Step            1                2                 3</span></span>
<span><span class="co">##      Sepal.Width:Petal.Length</span></span>
<span><span class="co">## Var                        10</span></span>
<span><span class="co">## Step                        4</span></span>
<span><span class="co">##      Sepal.Length:Sepal.Width:Petal.Length useless</span></span>
<span><span class="co">## Var                                     11       5</span></span>
<span><span class="co">## Step                                     5       6</span></span>
<span><span class="co">##      Sepal.Width Sepal.Length:Petal.Length Sepal.Length</span></span>
<span><span class="co">## Var            3                         9            2</span></span>
<span><span class="co">## Step           7                         8            9</span></span>
<span><span class="co">##      Sepal.Width:Petal.Length Sepal.Width:Petal.Length</span></span>
<span><span class="co">## Var                       -10                       10</span></span>
<span><span class="co">## Step                       10                       11</span></span>
<span><span class="co">##      Sepal.Length:Sepal.Width Sepal.Width Sepal.Width</span></span>
<span><span class="co">## Var                         8          -3           3</span></span>
<span><span class="co">## Step                       12          13          14</span></span></code></pre></div>
<p>The fitted model’s plot shows how variables are added (from left to right to the model).
The text output shoes that <code>Petal.Length</code> is the most important variable added to the model in step 1.
Then <code>Speciesvirginica</code> is added and so on.
This creates a sequence of nested models where one variable is added at a time.
To select the best model <a href="https://en.wikipedia.org/wiki/Mallows's_Cp">Mallows’s Cp statistic</a>
can be used.</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_lars</span>, plottype <span class="op">=</span> <span class="st">"Cp"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-437-1.png" width="672"></div>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">model_lars</span><span class="op">$</span><span class="va">Cp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_lars</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span></span>
<span><span class="co">##                           (Intercept) </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                          Sepal.Length </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                           Sepal.Width </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##                          Petal.Length </span></span>
<span><span class="co">##                             0.0603837 </span></span>
<span><span class="co">##                               useless </span></span>
<span><span class="co">##                            -0.0086551 </span></span>
<span><span class="co">##                     Speciesversicolor </span></span>
<span><span class="co">##                             0.8463786 </span></span>
<span><span class="co">##                      Speciesvirginica </span></span>
<span><span class="co">##                             1.4181850 </span></span>
<span><span class="co">##              Sepal.Length:Sepal.Width </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##             Sepal.Length:Petal.Length </span></span>
<span><span class="co">##                             0.0000000 </span></span>
<span><span class="co">##              Sepal.Width:Petal.Length </span></span>
<span><span class="co">##                             0.0029688 </span></span>
<span><span class="co">## Sepal.Length:Sepal.Width:Petal.Length </span></span>
<span><span class="co">##                             0.0003151</span></span></code></pre></div>
<p>The variables that are not selected have a <span class="math inline">\(\beta\)</span> coefficient of 0.</p>
<p>To make predictions with this model, we first have to convert the test data
into a design matrix with the dummy variables and interaction terms.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Sepal.Length</span><span class="op">*</span><span class="va">Sepal.Width</span><span class="op">*</span><span class="va">Petal.Length</span>,</span>
<span>  data <span class="op">=</span> <span class="va">test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x_test</span><span class="op">)</span></span>
<span><span class="co">##     (Intercept) Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">## 128           1        8.017       1.541        3.515</span></span>
<span><span class="co">## 92            1        5.268       4.064        6.064</span></span>
<span><span class="co">## 50            1        5.461       4.161        1.117</span></span>
<span><span class="co">## 134           1        6.055       2.951        4.599</span></span>
<span><span class="co">## 8             1        4.900       5.096        1.086</span></span>
<span><span class="co">## 58            1        5.413       4.728        5.990</span></span>
<span><span class="co">##     useless Speciesversicolor Speciesvirginica</span></span>
<span><span class="co">## 128   6.110                 0                1</span></span>
<span><span class="co">## 92    4.938                 1                0</span></span>
<span><span class="co">## 50    6.373                 0                0</span></span>
<span><span class="co">## 134   5.595                 0                1</span></span>
<span><span class="co">## 8     7.270                 0                0</span></span>
<span><span class="co">## 58    7.092                 1                0</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width Sepal.Length:Petal.Length</span></span>
<span><span class="co">## 128                    12.35                    28.182</span></span>
<span><span class="co">## 92                     21.41                    31.944</span></span>
<span><span class="co">## 50                     22.72                     6.102</span></span>
<span><span class="co">## 134                    17.87                    27.847</span></span>
<span><span class="co">## 8                      24.97                     5.319</span></span>
<span><span class="co">## 58                     25.59                    32.424</span></span>
<span><span class="co">##     Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 128                    5.417</span></span>
<span><span class="co">## 92                    24.647</span></span>
<span><span class="co">## 50                     4.649</span></span>
<span><span class="co">## 134                   13.572</span></span>
<span><span class="co">## 8                      5.531</span></span>
<span><span class="co">## 58                    28.323</span></span>
<span><span class="co">##     Sepal.Length:Sepal.Width:Petal.Length</span></span>
<span><span class="co">## 128                                 43.43</span></span>
<span><span class="co">## 92                                 129.83</span></span>
<span><span class="co">## 50                                  25.39</span></span>
<span><span class="co">## 134                                 82.19</span></span>
<span><span class="co">## 8                                   27.10</span></span>
<span><span class="co">## 58                                 153.31</span></span></code></pre></div>
<p>Now we can compute the predictions.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">## 6 </span></span>
<span><span class="co">## 7 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fraction</span></span>
<span><span class="co">##      6 </span></span>
<span><span class="co">## 0.4286 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mode</span></span>
<span><span class="co">## [1] "step"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fit</span></span>
<span><span class="co">##    128     92     50    134      8 </span></span>
<span><span class="co">## 1.8237 1.5003 0.2505 1.9300 0.2439</span></span></code></pre></div>
<p>The prediction is the <code>fit</code> element. We can calculate the RMSE.</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lars</span>, <span class="va">x_test</span>, s <span class="op">=</span> <span class="va">best</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="va">pred</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1907</span></span></code></pre></div>
<p>And visualize the prediction.</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, </span>
<span>     <span class="va">pred</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-441-1.png" width="672"></div>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>,</span>
<span>    <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.9686</span></span></code></pre></div>
<p>The model shows good predictive power on the test set.</p>
</div>
<div id="anns" class="section level3" number="9.8.3">
<h3>
<span class="header-section-number">B.8.3</span> ANNs<a class="anchor" aria-label="anchor" href="#anns"><i class="fas fa-link"></i></a>
</h3>
<p>Regression can be performed using <a href="https://en.wikipedia.org/wiki/Neural_network_(machine_learning)">artificial neural networks</a>
with typically a linear final layer.
We will create a network using a single hidden layer
with 3 neurons (a manually tuned hyper parameter) and a linear output layer (set via <code>linout</code>).</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_nnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span>, size <span class="op">=</span> <span class="fl">3</span>, linout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## # weights:  25</span></span>
<span><span class="co">## initial  value 82.633473 </span></span>
<span><span class="co">## iter  10 value 14.094963</span></span>
<span><span class="co">## iter  20 value 3.767394</span></span>
<span><span class="co">## iter  30 value 3.372093</span></span>
<span><span class="co">## iter  40 value 3.264074</span></span>
<span><span class="co">## iter  50 value 3.224384</span></span>
<span><span class="co">## iter  60 value 3.201191</span></span>
<span><span class="co">## iter  70 value 3.182708</span></span>
<span><span class="co">## iter  80 value 3.117583</span></span>
<span><span class="co">## iter  90 value 3.087831</span></span>
<span><span class="co">## iter 100 value 3.009898</span></span>
<span><span class="co">## final  value 3.009898 </span></span>
<span><span class="co">## stopped after 100 iterations</span></span>
<span><span class="va">model_nnet</span></span>
<span><span class="co">## a 6-3-1 network with 25 weights</span></span>
<span><span class="co">## inputs: Sepal.Length Sepal.Width Petal.Length useless Speciesversicolor Speciesvirginica </span></span>
<span><span class="co">## output(s): Petal.Width </span></span>
<span><span class="co">## options were - linear output units</span></span></code></pre></div>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_nnet</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html">RMSE</a></span><span class="op">(</span><span class="va">pred</span>, <span class="va">test</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.2322</span></span></code></pre></div>
<p>And visualize the quality.</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="va">pred</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"actual"</span>, ylab <span class="op">=</span> <span class="st">"predicted"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="R-Companion-Data-Mining_files/figure-html/unnamed-chunk-444-1.png" width="672"></div>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="st">"Petal.Width"</span><span class="op">]</span>, <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">##        [,1]</span></span>
<span><span class="co">## [1,] 0.9546</span></span></code></pre></div>
<p><em>Note:</em> It is often necessary to scale the inputs to the ANN so it can learn effectively.
It is very popular to scale all inputs
to the ranges <span class="math inline">\([0,1]\)</span> or <span class="math inline">\([-1,1]\)</span>. The ranges of the Iris dataset are fine, so
there was no need for scaling.</p>
</div>
<div id="other-types-of-regression" class="section level3" number="9.8.4">
<h3>
<span class="header-section-number">B.8.4</span> Other Types of Regression<a class="anchor" aria-label="anchor" href="#other-types-of-regression"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Robust regression: robust against violation of assumptions like heteroscedasticity and outliers
(<code>robustbase::roblm()</code> and <code>robustbase::robglm</code>)</li>
<li>Generalized linear models (<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>). An example is logistic regression discussed in the next chapter.</li>
<li>Nonlinear least squares (<code><a href="https://rdrr.io/r/stats/nlm.html">nlm()</a></code>).</li>
</ul>
</div>
</div>
<div id="exercises-6" class="section level2" number="9.9">
<h2>
<span class="header-section-number">B.9</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-6"><i class="fas fa-link"></i></a>
</h2>
<p>We will again use the Palmer penguin data for the exercises.</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   species island    bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Torgersen           39.1          18.7</span></span>
<span><span class="co">## 2 Adelie  Torgersen           39.5          17.4</span></span>
<span><span class="co">## 3 Adelie  Torgersen           40.3          18  </span></span>
<span><span class="co">## 4 Adelie  Torgersen           NA            NA  </span></span>
<span><span class="co">## 5 Adelie  Torgersen           36.7          19.3</span></span>
<span><span class="co">## 6 Adelie  Torgersen           39.3          20.6</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;dbl&gt;, sex &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
<p>Create an R markdown document that performs the following:</p>
<ol style="list-style-type: decimal">
<li><p>Create a linear regression model to predict the weight
of a penguin (<code>body_mass_g</code>).</p></li>
<li><p>How high is the R-squared. What does it mean.</p></li>
<li><p>What variables are significant, what are not?</p></li>
<li><p>Use stepwise variable selection to remove unnecessary variables.</p></li>
<li>
<p>Predict the weight for the following new penguin:</p>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_penguin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"Adelie"</span>, </span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span>, <span class="st">"Gentoo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  island <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"Dream"</span>, </span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Biscoe"</span>, <span class="st">"Dream"</span>, <span class="st">"Torgersen"</span><span class="op">)</span><span class="op">)</span>,</span>
<span> bill_length_mm <span class="op">=</span> <span class="fl">39.8</span>, </span>
<span> bill_depth_mm <span class="op">=</span> <span class="fl">19.1</span>, </span>
<span> flipper_length_mm <span class="op">=</span> <span class="fl">184</span>, </span>
<span> body_mass_g <span class="op">=</span> <span class="cn">NA</span>, </span>
<span> sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">"male"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>, </span>
<span> year <span class="op">=</span> <span class="fl">2007</span></span>
<span><span class="op">)</span> </span>
<span><span class="va">new_penguin</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   species island bill_length_mm bill_depth_mm</span></span>
<span><span class="co">##   &lt;fct&gt;   &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Adelie  Dream            39.8          19.1</span></span>
<span><span class="co">## # ℹ 4 more variables: flipper_length_mm &lt;dbl&gt;,</span></span>
<span><span class="co">## #   body_mass_g &lt;lgl&gt;, sex &lt;fct&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
</li>
<li><p>Create a regression tree. Look at the tree and explain what it does.
Then use the regression tree to predict the weight for the above penguin.</p></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-exploration-and-visualization.html"><span class="header-section-number">A</span> Data Exploration and Visualization</a></div>
<div class="next"><a href="appendix_logistic_regression.html"><span class="header-section-number">C</span> Logistic Regression</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#appendix_regression"><span class="header-section-number">B</span> Regression</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#packages-used-in-this-chapter-7">Packages Used in this Chapter</a></li></ul>
</li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">B.1</span> Introduction</a></li>
<li><a class="nav-link" href="#a-first-linear-regression-model"><span class="header-section-number">B.2</span> A First Linear Regression Model</a></li>
<li><a class="nav-link" href="#comparing-nested-models"><span class="header-section-number">B.3</span> Comparing Nested Models</a></li>
<li><a class="nav-link" href="#stepwise-variable-selection"><span class="header-section-number">B.4</span> Stepwise Variable Selection</a></li>
<li><a class="nav-link" href="#modeling-with-interaction-terms"><span class="header-section-number">B.5</span> Modeling with Interaction Terms</a></li>
<li><a class="nav-link" href="#prediction"><span class="header-section-number">B.6</span> Prediction</a></li>
<li><a class="nav-link" href="#using-nominal-variables"><span class="header-section-number">B.7</span> Using Nominal Variables</a></li>
<li>
<a class="nav-link" href="#alternative-regression-models"><span class="header-section-number">B.8</span> Alternative Regression Models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#regression-trees"><span class="header-section-number">B.8.1</span> Regression Trees</a></li>
<li><a class="nav-link" href="#regularized-regression"><span class="header-section-number">B.8.2</span> Regularized Regression</a></li>
<li><a class="nav-link" href="#anns"><span class="header-section-number">B.8.3</span> ANNs</a></li>
<li><a class="nav-link" href="#other-types-of-regression"><span class="header-section-number">B.8.4</span> Other Types of Regression</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercises-6"><span class="header-section-number">B.9</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/blob/master/book_src/91_regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mhahsler/Introduction_to_Data_Mining_R_Examples/edit/master/book_src/91_regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An R Companion for Introduction to Data Mining</strong>" was written by Michael Hahsler. It was last built on 2025-09-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
